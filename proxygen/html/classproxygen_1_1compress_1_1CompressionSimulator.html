<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: proxygen::compress::CompressionSimulator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classproxygen_1_1compress_1_1CompressionSimulator.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classproxygen_1_1compress_1_1CompressionSimulator-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">proxygen::compress::CompressionSimulator Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a18003fe5998e7271d2c818bec436ee52"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a18003fe5998e7271d2c818bec436ee52">CompressionSimulator</a> (<a class="el" href="structproxygen_1_1compress_1_1SimParams.html">SimParams</a> p)</td></tr>
<tr class="separator:a18003fe5998e7271d2c818bec436ee52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a669fd5e309fe7b672d0a192039782b9a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a669fd5e309fe7b672d0a192039782b9a">readInputFromFileAndSchedule</a> (const std::string &amp;filename)</td></tr>
<tr class="separator:a669fd5e309fe7b672d0a192039782b9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b756a2a20de3ecd7f2fd00c995b78d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a5b756a2a20de3ecd7f2fd00c995b78d6">run</a> ()</td></tr>
<tr class="separator:a5b756a2a20de3ecd7f2fd00c995b78d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a884a49adac43a3f563dc5d09b15de14a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a884a49adac43a3f563dc5d09b15de14a">flushSchemePackets</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme)</td></tr>
<tr class="separator:a884a49adac43a3f563dc5d09b15de14a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbe2351c3837f1532bedee587d37d4b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#adbe2351c3837f1532bedee587d37d4b0">flushPacket</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme)</td></tr>
<tr class="separator:adbe2351c3837f1532bedee587d37d4b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ae5507a6cc20d0189a91a840c1e9650ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae5507a6cc20d0189a91a840c1e9650ea">flushRequests</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme)</td></tr>
<tr class="separator:ae5507a6cc20d0189a91a840c1e9650ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63980bd7582703dfdd89aa3fffdc93ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a63980bd7582703dfdd89aa3fffdc93ff">setupRequest</a> (uint16_t seqn, <a class="el" href="classproxygen_1_1HTTPMessage.html">HTTPMessage</a> &amp;&amp;msg, std::chrono::milliseconds encodeDelay)</td></tr>
<tr class="separator:a63980bd7582703dfdd89aa3fffdc93ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d2618417295b3be19f67d35d8f974af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1d2618417295b3be19f67d35d8f974af">getScheme</a> (folly::StringPiece host)</td></tr>
<tr class="separator:a1d2618417295b3be19f67d35d8f974af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8be7f9576f03cd8f562ebb0755cd8d69"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a8be7f9576f03cd8f562ebb0755cd8d69">makeScheme</a> ()</td></tr>
<tr class="separator:a8be7f9576f03cd8f562ebb0755cd8d69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a566957fa4b7a925f5cae7660b4ed24b9"><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="structproxygen_1_1compress_1_1FrameFlags.html">FrameFlags</a>, std::unique_ptr&lt; folly::IOBuf &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a566957fa4b7a925f5cae7660b4ed24b9">encode</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme, bool newPacket, uint16_t seqn)</td></tr>
<tr class="separator:a566957fa4b7a925f5cae7660b4ed24b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38bef8da0daefefa016062dfc5374f11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a38bef8da0daefefa016062dfc5374f11">decodePacket</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme, std::list&lt; <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html#ada50eb60ed8ed86791a59ef612fe1d69">CompressionScheme::BlockInfo</a> &gt; &amp;blocks)</td></tr>
<tr class="separator:a38bef8da0daefefa016062dfc5374f11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae82cb6f93c12771defb01fe392d12639"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae82cb6f93c12771defb01fe392d12639">decode</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme, <a class="el" href="structproxygen_1_1compress_1_1FrameFlags.html">FrameFlags</a> <a class="el" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>, std::unique_ptr&lt; folly::IOBuf &gt; encodedReq, <a class="el" href="classproxygen_1_1compress_1_1SimStreamingCallback.html">SimStreamingCallback</a> &amp;cb)</td></tr>
<tr class="separator:ae82cb6f93c12771defb01fe392d12639"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac04f1b78922a01355be9bc27d20455a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a> (folly::Function&lt; void()&gt; f, std::chrono::milliseconds ms)</td></tr>
<tr class="separator:ac04f1b78922a01355be9bc27d20455a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d9e755a51c6b580b6c793bbdd0e72d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a6d9e755a51c6b580b6c793bbdd0e72d9">sendAck</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme, std::unique_ptr&lt; <a class="el" href="structproxygen_1_1compress_1_1CompressionScheme_1_1Ack.html">CompressionScheme::Ack</a> &gt; ack)</td></tr>
<tr class="separator:a6d9e755a51c6b580b6c793bbdd0e72d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1edc5901ae87a12da5851a6a238293fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1edc5901ae87a12da5851a6a238293fc">recvAck</a> (<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *scheme, std::unique_ptr&lt; <a class="el" href="structproxygen_1_1compress_1_1CompressionScheme_1_1Ack.html">CompressionScheme::Ack</a> &gt; ack)</td></tr>
<tr class="separator:a1edc5901ae87a12da5851a6a238293fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0d6d728f67553cdfa0149c7bc7e634f"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#af0d6d728f67553cdfa0149c7bc7e634f">deliveryDelay</a> ()</td></tr>
<tr class="separator:af0d6d728f67553cdfa0149c7bc7e634f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee96fdc737e78658a558b44c877bca6d"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aee96fdc737e78658a558b44c877bca6d">rtt</a> ()</td></tr>
<tr class="separator:aee96fdc737e78658a558b44c877bca6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac277f5cf3c36830948b344ecad58db3e"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac277f5cf3c36830948b344ecad58db3e">one_half_rtt</a> ()</td></tr>
<tr class="separator:ac277f5cf3c36830948b344ecad58db3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c93f855c37efddfc1468a754aca7539"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a5c93f855c37efddfc1468a754aca7539">rxmitDelay</a> ()</td></tr>
<tr class="separator:a5c93f855c37efddfc1468a754aca7539"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c5b3ac32f847eb57ffa25b48bbc938a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a8c5b3ac32f847eb57ffa25b48bbc938a">loss</a> ()</td></tr>
<tr class="separator:a8c5b3ac32f847eb57ffa25b48bbc938a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1946a350f39d75b58da56fcf21080b08"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1946a350f39d75b58da56fcf21080b08">delayed</a> ()</td></tr>
<tr class="separator:a1946a350f39d75b58da56fcf21080b08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17527a82237c46d5d9968605cefe2aee"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a17527a82237c46d5d9968605cefe2aee">extraDelay</a> ()</td></tr>
<tr class="separator:a17527a82237c46d5d9968605cefe2aee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3aa2b684f8d8a8aad6850bfafa94c29"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa3aa2b684f8d8a8aad6850bfafa94c29">minOOOThresh</a> ()</td></tr>
<tr class="separator:aa3aa2b684f8d8a8aad6850bfafa94c29"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a9513db1985327332e7a9e87f708fa899"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structproxygen_1_1compress_1_1SimParams.html">SimParams</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a></td></tr>
<tr class="separator:a9513db1985327332e7a9e87f708fa899"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3715b92b4caff88ff3cf9ca77f954b7"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classproxygen_1_1HTTPMessage.html">proxygen::HTTPMessage</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">requests_</a></td></tr>
<tr class="separator:ad3715b92b4caff88ff3cf9ca77f954b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5749fb27acd9bfcb3cf75032e7103fb"><td class="memItemLeft" align="right" valign="top">folly::EventBase&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">eventBase_</a></td></tr>
<tr class="separator:ac5749fb27acd9bfcb3cf75032e7103fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53051171a9727bfeb9f1566814b64b60"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; std::string, std::unique_ptr&lt; <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">domains_</a></td></tr>
<tr class="separator:a53051171a9727bfeb9f1566814b64b60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c6e0687998c74788b4a21c4edcff6d8"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classproxygen_1_1compress_1_1SimStreamingCallback.html">SimStreamingCallback</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">callbacks_</a></td></tr>
<tr class="separator:a4c6e0687998c74788b4a21c4edcff6d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae668782e2b26f9ca6dd1cd8f5c6d5cc7"><td class="memItemLeft" align="right" valign="top">folly::Random::DefaultGenerator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">rng_</a></td></tr>
<tr class="separator:ae668782e2b26f9ca6dd1cd8f5c6d5cc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa38d3dd39bf4ad68347a3668899aa9ed"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structproxygen_1_1compress_1_1SimStats.html">SimStats</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a></td></tr>
<tr class="separator:aa38d3dd39bf4ad68347a3668899aa9ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00023">23</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a18003fe5998e7271d2c818bec436ee52"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">proxygen::compress::CompressionSimulator::CompressionSimulator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structproxygen_1_1compress_1_1SimParams.html">SimParams</a>&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00025">25</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

<p>References <a class="el" href="CompressionSimulator_8cpp_source.html#l00306">decode()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00313">decodePacket()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00392">delayed()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00354">deliveryDelay()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00286">encode()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00396">extraDelay()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00186">flushPacket()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00103">flushRequests()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00202">flushSchemePackets()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00252">getScheme()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00388">loss()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00272">makeScheme()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00401">minOOOThresh()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00379">one_half_rtt()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00036">readInputFromFileAndSchedule()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00349">recvAck()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00375">rtt()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00073">run()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00383">rxmitDelay()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00331">scheduleEvent()</a>, <a class="el" href="CompressionSimulator_8cpp_source.html#l00336">sendAck()</a>, and <a class="el" href="CompressionSimulator_8cpp_source.html#l00137">setupRequest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                                             : <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>(p) {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  }</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ae82cb6f93c12771defb01fe392d12639"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::decode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structproxygen_1_1compress_1_1FrameFlags.html">FrameFlags</a>&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; folly::IOBuf &gt;&#160;</td>
          <td class="paramname"><em>encodedReq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1SimStreamingCallback.html">SimStreamingCallback</a> &amp;&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00306">306</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html#ac5ddabc82889df4797e1e869dc32e4e2">proxygen::compress::CompressionScheme::decode()</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                                            {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ac5ddabc82889df4797e1e869dc32e4e2">decode</a>(flags, std::move(encodedReq), <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>, cb);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_ac5ddabc82889df4797e1e869dc32e4e2"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#ac5ddabc82889df4797e1e869dc32e4e2">proxygen::compress::CompressionScheme::decode</a></div><div class="ttdeci">virtual void decode(FrameFlags flags, std::unique_ptr&lt; folly::IOBuf &gt; encodedReq, SimStats &amp;stats, SimStreamingCallback &amp;cb)=0</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a38bef8da0daefefa016062dfc5374f11"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::decodePacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::list&lt; <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html#ada50eb60ed8ed86791a59ef612fe1d69">CompressionScheme::BlockInfo</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>blocks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00313">313</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="TestUtil_8cpp_source.html#l00095">proxygen::hpack::decode()</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                                 {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  VLOG(1) &lt;&lt; <span class="stringliteral">&quot;decode packet with &quot;</span> &lt;&lt; blocks.size() &lt;&lt; <span class="stringliteral">&quot; blocks&quot;</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">while</span> (!blocks.empty()) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">auto</span> encodeRes = &amp;blocks.front();</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// TODO(ckrasic) - to get packet coordination correct, could plumb</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// through &quot;start of packet&quot; flag here.  Probably not worth it,</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// since it seems to make only a very small difference (about a</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// 0.1% compressiondifference on my facebook har).</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae82cb6f93c12771defb01fe392d12639">decode</a>(scheme,</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;           std::get&lt;0&gt;(*encodeRes),</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;           std::move(std::get&lt;2&gt;(*encodeRes)),</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;           *std::get&lt;3&gt;(*encodeRes));</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    blocks.pop_front();</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae82cb6f93c12771defb01fe392d12639"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae82cb6f93c12771defb01fe392d12639">proxygen::compress::CompressionSimulator::decode</a></div><div class="ttdeci">void decode(CompressionScheme *scheme, FrameFlags flags, std::unique_ptr&lt; folly::IOBuf &gt; encodedReq, SimStreamingCallback &amp;cb)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00306">CompressionSimulator.cpp:306</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1946a350f39d75b58da56fcf21080b08"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool proxygen::compress::CompressionSimulator::delayed </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00392">392</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                   {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">return</span> Random::randDouble01(<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">rng_</a>) &lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a7ab6d4daecf594eaefe13312c527f102">delayProbability</a>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a7ab6d4daecf594eaefe13312c527f102"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a7ab6d4daecf594eaefe13312c527f102">proxygen::compress::SimParams::delayProbability</a></div><div class="ttdeci">double delayProbability</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00033">CompressionTypes.h:33</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae668782e2b26f9ca6dd1cd8f5c6d5cc7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">proxygen::compress::CompressionSimulator::rng_</a></div><div class="ttdeci">folly::Random::DefaultGenerator rng_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00071">CompressionSimulator.h:71</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af0d6d728f67553cdfa0149c7bc7e634f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds proxygen::compress::CompressionSimulator::deliveryDelay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00354">354</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                                          {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  std::chrono::milliseconds delay = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac277f5cf3c36830948b344ecad58db3e">one_half_rtt</a>();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a8c5b3ac32f847eb57ffa25b48bbc938a">loss</a>()) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a7985f6c5121e808734cf9c10d8516c24">packetLosses</a>++;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a>([] { VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Packet lost!&quot;</span>; }, delay);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    std::chrono::milliseconds rxmit = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a5c93f855c37efddfc1468a754aca7539">rxmitDelay</a>();</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    delay += rxmit;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a>(</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        [rxmit] {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Packet loss detected, retransmitting with additional &quot;</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                  &lt;&lt; rxmit.count();</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        },</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        delay - <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac277f5cf3c36830948b344ecad58db3e">one_half_rtt</a>());</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1946a350f39d75b58da56fcf21080b08">delayed</a>()) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a>([] { VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Packet delayed in network&quot;</span>; }, delay);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    delay += <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a17527a82237c46d5d9968605cefe2aee">extraDelay</a>();</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">return</span> delay;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a1946a350f39d75b58da56fcf21080b08"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1946a350f39d75b58da56fcf21080b08">proxygen::compress::CompressionSimulator::delayed</a></div><div class="ttdeci">bool delayed()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00392">CompressionSimulator.cpp:392</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a7985f6c5121e808734cf9c10d8516c24"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a7985f6c5121e808734cf9c10d8516c24">proxygen::compress::SimStats::packetLosses</a></div><div class="ttdeci">uint64_t packetLosses</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00044">CompressionTypes.h:44</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac277f5cf3c36830948b344ecad58db3e"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac277f5cf3c36830948b344ecad58db3e">proxygen::compress::CompressionSimulator::one_half_rtt</a></div><div class="ttdeci">std::chrono::milliseconds one_half_rtt()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00379">CompressionSimulator.cpp:379</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a8c5b3ac32f847eb57ffa25b48bbc938a"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a8c5b3ac32f847eb57ffa25b48bbc938a">proxygen::compress::CompressionSimulator::loss</a></div><div class="ttdeci">bool loss()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00388">CompressionSimulator.cpp:388</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a5c93f855c37efddfc1468a754aca7539"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a5c93f855c37efddfc1468a754aca7539">proxygen::compress::CompressionSimulator::rxmitDelay</a></div><div class="ttdeci">std::chrono::milliseconds rxmitDelay()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00383">CompressionSimulator.cpp:383</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac04f1b78922a01355be9bc27d20455a7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">proxygen::compress::CompressionSimulator::scheduleEvent</a></div><div class="ttdeci">void scheduleEvent(folly::Function&lt; void()&gt; f, std::chrono::milliseconds ms)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00331">CompressionSimulator.cpp:331</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a17527a82237c46d5d9968605cefe2aee"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a17527a82237c46d5d9968605cefe2aee">proxygen::compress::CompressionSimulator::extraDelay</a></div><div class="ttdeci">std::chrono::milliseconds extraDelay()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00396">CompressionSimulator.cpp:396</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a566957fa4b7a925f5cae7660b4ed24b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="structproxygen_1_1compress_1_1FrameFlags.html">FrameFlags</a>, unique_ptr&lt; IOBuf &gt; &gt; proxygen::compress::CompressionSimulator::encode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>newPacket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>seqn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00286">286</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html#a4e013945112c438374a2cb99eb753d67">proxygen::compress::CompressionScheme::encode()</a>, and <a class="el" href="CompressionUtils_8cpp_source.html#l00083">proxygen::compress::prepareMessageForCompression()</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                                               {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  VLOG(1) &lt;&lt; <span class="stringliteral">&quot;Start encoding request=&quot;</span> &lt;&lt; index;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// vector to hold cookie crumbs</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  vector&lt;string&gt; cookies;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  vector&lt;compress::Header&gt; allHeaders = <a class="code" href="namespaceproxygen_1_1compress.html#a87be4e4c674336304ac9c82b0e244685">prepareMessageForCompression</a>(</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">requests_</a>[index], cookies);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keyword">auto</span> before = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">uncompressed</a>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">auto</span> res = scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a4e013945112c438374a2cb99eb753d67">encode</a>(newPacket, std::move(allHeaders), <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  VLOG(1) &lt;&lt; <span class="stringliteral">&quot;Encoded request=&quot;</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot; for host=&quot;</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">requests_</a>[index].getHeaders().getSingleOrEmpty(HTTP_HEADER_HOST)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; orig size=&quot;</span> &lt;&lt; (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">uncompressed</a> - before)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; block size=&quot;</span> &lt;&lt; res.second-&gt;computeChainDataLength()</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; cumulative bytes=&quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5cf35c268868a68c901e6282f5efd158">compressed</a></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; cumulative compression ratio=&quot;</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          &lt;&lt; int(100 - <span class="keywordtype">double</span>(100 * <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5cf35c268868a68c901e6282f5efd158">compressed</a>) / <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">uncompressed</a>);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div><div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a5e6232fed235cd5c07f867cc03162607"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">proxygen::compress::SimStats::uncompressed</a></div><div class="ttdeci">uint64_t uncompressed</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00047">CompressionTypes.h:47</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a5cf35c268868a68c901e6282f5efd158"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a5cf35c268868a68c901e6282f5efd158">proxygen::compress::SimStats::compressed</a></div><div class="ttdeci">uint64_t compressed</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00048">CompressionTypes.h:48</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a4e013945112c438374a2cb99eb753d67"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a4e013945112c438374a2cb99eb753d67">proxygen::compress::CompressionScheme::encode</a></div><div class="ttdeci">virtual std::pair&lt; FrameFlags, std::unique_ptr&lt; folly::IOBuf &gt; &gt; encode(bool newPacket, std::vector&lt; compress::Header &gt; allHeaders, SimStats &amp;stats)=0</div></div>
<div class="ttc" id="namespaceproxygen_1_1compress_html_a87be4e4c674336304ac9c82b0e244685"><div class="ttname"><a href="namespaceproxygen_1_1compress.html#a87be4e4c674336304ac9c82b0e244685">proxygen::compress::prepareMessageForCompression</a></div><div class="ttdeci">std::vector&lt; compress::Header &gt; prepareMessageForCompression(const HTTPMessage &amp;msg, std::vector&lt; string &gt; &amp;cookies)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionUtils_8cpp_source.html#l00083">CompressionUtils.cpp:83</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ad3715b92b4caff88ff3cf9ca77f954b7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">proxygen::compress::CompressionSimulator::requests_</a></div><div class="ttdeci">std::vector&lt; proxygen::HTTPMessage &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00066">CompressionSimulator.h:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a17527a82237c46d5d9968605cefe2aee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds proxygen::compress::CompressionSimulator::extraDelay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00396">396</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                                       {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  uint32_t ms = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a0b6509e0db5dc9cae69598a18022fc60">maxDelay</a>.count() * Random::randDouble01(<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">rng_</a>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">return</span> std::chrono::milliseconds(ms);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;}</div><div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a0b6509e0db5dc9cae69598a18022fc60"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a0b6509e0db5dc9cae69598a18022fc60">proxygen::compress::SimParams::maxDelay</a></div><div class="ttdeci">std::chrono::milliseconds maxDelay</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00034">CompressionTypes.h:34</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae668782e2b26f9ca6dd1cd8f5c6d5cc7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">proxygen::compress::CompressionSimulator::rng_</a></div><div class="ttdeci">folly::Random::DefaultGenerator rng_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00071">CompressionSimulator.h:71</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adbe2351c3837f1532bedee587d37d4b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::flushPacket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00186">186</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="CompressionScheme_8h_source.html#l00079">proxygen::compress::CompressionScheme::decodeDelay</a>, <a class="el" href="CompressionScheme_8h_source.html#l00070">proxygen::compress::CompressionScheme::packetBlocks</a>, and <a class="el" href="CompressionScheme_8h_source.html#l00078">proxygen::compress::CompressionScheme::packetBytes</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                                                {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span> (scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">packetBlocks</a>.empty()) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#ab2e8dceeec812bc692731823c9599813">packets</a>++;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  VLOG(1) &lt;&lt; <span class="stringliteral">&quot;schedule decode for &quot;</span> &lt;&lt; scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">packetBlocks</a>.size()</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; blocks at &quot;</span> &lt;&lt; scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">decodeDelay</a>.count();</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a>(</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      {[<span class="keyword">this</span>, scheme, blocks = std::move(scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">packetBlocks</a>)]() <span class="keyword">mutable</span> {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a38bef8da0daefefa016062dfc5374f11">decodePacket</a>(scheme, blocks);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      }},</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">decodeDelay</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a4f71fa1ca3db61ad6b7aa4a078bb8b76">packetBytes</a> = 0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_af6fb1e0f08c33671a116f4fe85d4ebe1"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">proxygen::compress::CompressionScheme::packetBlocks</a></div><div class="ttdeci">std::list&lt; BlockInfo &gt; packetBlocks</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00070">CompressionScheme.h:70</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a38bef8da0daefefa016062dfc5374f11"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a38bef8da0daefefa016062dfc5374f11">proxygen::compress::CompressionSimulator::decodePacket</a></div><div class="ttdeci">void decodePacket(CompressionScheme *scheme, std::list&lt; CompressionScheme::BlockInfo &gt; &amp;blocks)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00313">CompressionSimulator.cpp:313</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a4f71fa1ca3db61ad6b7aa4a078bb8b76"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a4f71fa1ca3db61ad6b7aa4a078bb8b76">proxygen::compress::CompressionScheme::packetBytes</a></div><div class="ttdeci">size_t packetBytes</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00078">CompressionScheme.h:78</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac04f1b78922a01355be9bc27d20455a7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">proxygen::compress::CompressionSimulator::scheduleEvent</a></div><div class="ttdeci">void scheduleEvent(folly::Function&lt; void()&gt; f, std::chrono::milliseconds ms)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00331">CompressionSimulator.cpp:331</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a7941a48e560dae88e07d62943dc4da7a"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">proxygen::compress::CompressionScheme::decodeDelay</a></div><div class="ttdeci">std::chrono::milliseconds decodeDelay</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00079">CompressionScheme.h:79</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_ab2e8dceeec812bc692731823c9599813"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#ab2e8dceeec812bc692731823c9599813">proxygen::compress::SimStats::packets</a></div><div class="ttdeci">uint64_t packets</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00049">CompressionTypes.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae5507a6cc20d0189a91a840c1e9650ea"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::flushRequests </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00103">103</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="CompressionScheme_8h_source.html#l00081">proxygen::compress::CompressionScheme::packetIndices</a>, and <a class="el" href="CompressionScheme_8h_source.html#l00076">proxygen::compress::CompressionScheme::prev</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                                                  {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  VLOG(5) &lt;&lt; <span class="stringliteral">&quot;schedule encode for &quot;</span> &lt;&lt; scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a625e785dd8c5fa8aa84d686739d604ec">packetIndices</a>.size()</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; blocks at &quot;</span> &lt;&lt; scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a2a356966d15ef97cdda9c121985f84dd">prev</a>.count();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// Flush previous train</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a>(</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      [<span class="keyword">this</span>, scheme, indices = std::move(scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a625e785dd8c5fa8aa84d686739d604ec">packetIndices</a>)]() <span class="keyword">mutable</span> {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        bool newPacket = true;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        while (!indices.empty()) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          int16_t index = indices.front();</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;          indices.pop_front();</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          auto schemeIndex = scheme-&gt;index;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;          auto encodeRes = encode(scheme, newPacket, index);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;          FrameFlags flags = encodeRes.first;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;          bool allowOOO = flags.allowOOO;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          if (schemeIndex &lt; minOOOThresh()) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            allowOOO = false;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            auto ack = scheme-&gt;getAck(schemeIndex);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            if (ack) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;              scheme-&gt;recvAck(std::move(ack));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          stats_.allowedOOO += (allowOOO) ? 1 : 0;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;          flags.allowOOO = allowOOO;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;          scheme-&gt;encodedBlocks.emplace_back(flags,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                             newPacket,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                             std::move(encodeRes.second),</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                             &amp;callbacks_[index]);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;          newPacket = false;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">eventBase_</a>.runInLoop(scheme, <span class="keyword">true</span>);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      },</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a2a356966d15ef97cdda9c121985f84dd">prev</a>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a2a356966d15ef97cdda9c121985f84dd"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a2a356966d15ef97cdda9c121985f84dd">proxygen::compress::CompressionScheme::prev</a></div><div class="ttdeci">std::chrono::milliseconds prev</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00076">CompressionScheme.h:76</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac5749fb27acd9bfcb3cf75032e7103fb"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">proxygen::compress::CompressionSimulator::eventBase_</a></div><div class="ttdeci">folly::EventBase eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00067">CompressionSimulator.h:67</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a625e785dd8c5fa8aa84d686739d604ec"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a625e785dd8c5fa8aa84d686739d604ec">proxygen::compress::CompressionScheme::packetIndices</a></div><div class="ttdeci">std::list&lt; uint16_t &gt; packetIndices</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00081">CompressionScheme.h:81</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac04f1b78922a01355be9bc27d20455a7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">proxygen::compress::CompressionSimulator::scheduleEvent</a></div><div class="ttdeci">void scheduleEvent(folly::Function&lt; void()&gt; f, std::chrono::milliseconds ms)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00331">CompressionSimulator.cpp:331</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a884a49adac43a3f563dc5d09b15de14a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::flushSchemePackets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00202">202</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="CompressionScheme_8h_source.html#l00079">proxygen::compress::CompressionScheme::decodeDelay</a>, <a class="el" href="CompressionScheme_8h_source.html#l00068">proxygen::compress::CompressionScheme::encodedBlocks</a>, <a class="el" href="CompressionScheme_8h_source.html#l00070">proxygen::compress::CompressionScheme::packetBlocks</a>, and <a class="el" href="CompressionScheme_8h_source.html#l00078">proxygen::compress::CompressionScheme::packetBytes</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                                       {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  CHECK(!scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.empty());</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  VLOG(2) &lt;&lt; <span class="stringliteral">&quot;Flushing &quot;</span> &lt;&lt; scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.size() &lt;&lt; <span class="stringliteral">&quot; requests&quot;</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// tracks the number of bytes in the current simulated packet</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keyword">auto</span> encodeRes = &amp;scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.front();</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">bool</span> newPacket = std::get&lt;1&gt;(*encodeRes);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">size_t</span> headerBlockBytesRemaining =</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      std::get&lt;2&gt;(*encodeRes)-&gt;computeChainDataLength();</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  std::chrono::milliseconds packetDelay = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#af0d6d728f67553cdfa0149c7bc7e634f">deliveryDelay</a>();</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">decodeDelay</a> = packetDelay;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (newPacket) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#adbe2351c3837f1532bedee587d37d4b0">flushPacket</a>(scheme);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    newPacket = <span class="keyword">false</span>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// precondition packetBytes &lt; kMTU</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">if</span> (scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a4f71fa1ca3db61ad6b7aa4a078bb8b76">packetBytes</a> + headerBlockBytesRemaining &gt;= kMTU) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="comment">// Header block filled current packet, triggering a flush</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      VLOG(2) &lt;&lt; <span class="stringliteral">&quot;Request(s) spanned multiple packets&quot;</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      newPacket = <span class="keyword">true</span>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a4f71fa1ca3db61ad6b7aa4a078bb8b76">packetBytes</a> += headerBlockBytesRemaining;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    headerBlockBytesRemaining -=</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        std::min(headerBlockBytesRemaining, kMTU - scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a4f71fa1ca3db61ad6b7aa4a078bb8b76">packetBytes</a>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (headerBlockBytesRemaining == 0) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="comment">// Move from the first element of encodedBlocks to the last</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="comment">// element of packetBlocks.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">packetBlocks</a>.splice(scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">packetBlocks</a>.end(),</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                  scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                  scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.begin());</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordflow">if</span> (scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.empty()) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="comment">// All done</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="comment">// Grab the next request</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      encodeRes = &amp;scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.front();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      newPacket = std::get&lt;1&gt;(*encodeRes);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      headerBlockBytesRemaining =</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;          std::get&lt;2&gt;(*encodeRes)-&gt;computeChainDataLength();</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (newPacket) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      packetDelay = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#af0d6d728f67553cdfa0149c7bc7e634f">deliveryDelay</a>();</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">decodeDelay</a> = std::max(scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">decodeDelay</a>, packetDelay);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#adbe2351c3837f1532bedee587d37d4b0">flushPacket</a>(scheme);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  CHECK(scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">encodedBlocks</a>.empty());</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_af6fb1e0f08c33671a116f4fe85d4ebe1"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#af6fb1e0f08c33671a116f4fe85d4ebe1">proxygen::compress::CompressionScheme::packetBlocks</a></div><div class="ttdeci">std::list&lt; BlockInfo &gt; packetBlocks</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00070">CompressionScheme.h:70</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a4f71fa1ca3db61ad6b7aa4a078bb8b76"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a4f71fa1ca3db61ad6b7aa4a078bb8b76">proxygen::compress::CompressionScheme::packetBytes</a></div><div class="ttdeci">size_t packetBytes</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00078">CompressionScheme.h:78</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_af0d6d728f67553cdfa0149c7bc7e634f"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#af0d6d728f67553cdfa0149c7bc7e634f">proxygen::compress::CompressionSimulator::deliveryDelay</a></div><div class="ttdeci">std::chrono::milliseconds deliveryDelay()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00354">CompressionSimulator.cpp:354</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a7941a48e560dae88e07d62943dc4da7a"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a7941a48e560dae88e07d62943dc4da7a">proxygen::compress::CompressionScheme::decodeDelay</a></div><div class="ttdeci">std::chrono::milliseconds decodeDelay</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00079">CompressionScheme.h:79</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_ab9712b0de439245609196d02570ae20e"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#ab9712b0de439245609196d02570ae20e">proxygen::compress::CompressionScheme::encodedBlocks</a></div><div class="ttdeci">std::list&lt; BlockInfo &gt; encodedBlocks</div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00068">CompressionScheme.h:68</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_adbe2351c3837f1532bedee587d37d4b0"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#adbe2351c3837f1532bedee587d37d4b0">proxygen::compress::CompressionSimulator::flushPacket</a></div><div class="ttdeci">void flushPacket(CompressionScheme *scheme)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00186">CompressionSimulator.cpp:186</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1d2618417295b3be19f67d35d8f974af"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> * proxygen::compress::CompressionSimulator::getScheme </td>
          <td>(</td>
          <td class="paramtype">folly::StringPiece&#160;</td>
          <td class="paramname"><em>host</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00252">252</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                                     {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">string</span> blended(<span class="stringliteral">&quot;\&quot;Facebook\&quot;&quot;</span>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#aa3f2bd9da4405f9d388c57f37d507175">blend</a> &amp;&amp;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      (domain.endsWith(<span class="stringliteral">&quot;facebook.com&quot;</span>) || domain.endsWith(<span class="stringliteral">&quot;fbcdn.net&quot;</span>))) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    domain = blended;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keyword">auto</span> it = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">domains_</a>.find(domain.str());</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a>* scheme = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">if</span> (it == <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">domains_</a>.end()) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Creating scheme for domain=&quot;</span> &lt;&lt; domain;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keyword">auto</span> schemePtr = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a8be7f9576f03cd8f562ebb0755cd8d69">makeScheme</a>();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    scheme = schemePtr.get();</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">domains_</a>.emplace(domain.str(), std::move(schemePtr));</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    scheme = it-&gt;second.get();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">return</span> scheme;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a8be7f9576f03cd8f562ebb0755cd8d69"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a8be7f9576f03cd8f562ebb0755cd8d69">proxygen::compress::CompressionSimulator::makeScheme</a></div><div class="ttdeci">std::unique_ptr&lt; CompressionScheme &gt; makeScheme()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00272">CompressionSimulator.cpp:272</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_aa3f2bd9da4405f9d388c57f37d507175"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#aa3f2bd9da4405f9d388c57f37d507175">proxygen::compress::SimParams::blend</a></div><div class="ttdeci">bool blend</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00036">CompressionTypes.h:36</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a53051171a9727bfeb9f1566814b64b60"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">proxygen::compress::CompressionSimulator::domains_</a></div><div class="ttdeci">std::unordered_map&lt; std::string, std::unique_ptr&lt; CompressionScheme &gt; &gt; domains_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00069">CompressionSimulator.h:69</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html">proxygen::compress::CompressionScheme</a></div><div class="ttdef"><b>Definition:</b> <a href="CompressionScheme_8h_source.html#l00020">CompressionScheme.h:20</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8c5b3ac32f847eb57ffa25b48bbc938a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool proxygen::compress::CompressionSimulator::loss </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00388">388</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">return</span> Random::randDouble01(<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">rng_</a>) &lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a019a47cce4dde2409ff6796d3e648d85">lossProbability</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae668782e2b26f9ca6dd1cd8f5c6d5cc7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">proxygen::compress::CompressionSimulator::rng_</a></div><div class="ttdeci">folly::Random::DefaultGenerator rng_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00071">CompressionSimulator.h:71</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a019a47cce4dde2409ff6796d3e648d85"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a019a47cce4dde2409ff6796d3e648d85">proxygen::compress::SimParams::lossProbability</a></div><div class="ttdeci">double lossProbability</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00032">CompressionTypes.h:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8be7f9576f03cd8f562ebb0755cd8d69"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unique_ptr&lt; <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> &gt; proxygen::compress::CompressionSimulator::makeScheme </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00272">272</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                                               {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a9a24d6755cb25f8530ab3c44d8acea2a">type</a>) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2a722622dacf22345d7f65d96d10d5d1ae">SchemeType::QPACK</a>:</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">return</span> make_unique&lt;QPACKScheme&gt;(<span class="keyword">this</span>, <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a6b9b7dfedc868076f81acac8b56e643a">tableSize</a>,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                      <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a1aba8e1f730b3bdaf46a6f9df4a9e475">maxBlocking</a>);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2a3b78b53f7b985978b86a572e04bb4f9c">SchemeType::QMIN</a>:</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">return</span> make_unique&lt;QMINScheme&gt;(<span class="keyword">this</span>, <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a6b9b7dfedc868076f81acac8b56e643a">tableSize</a>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2abeeb357da92a0c9056f9e9f91fc48938">SchemeType::HPACK</a>:</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">return</span> make_unique&lt;HPACKScheme&gt;(<span class="keyword">this</span>, <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a6b9b7dfedc868076f81acac8b56e643a">tableSize</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;Bad scheme&quot;</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="ttc" id="namespaceproxygen_1_1compress_html_adb2f38c607bc534e811b122dbed14ef2a722622dacf22345d7f65d96d10d5d1ae"><div class="ttname"><a href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2a722622dacf22345d7f65d96d10d5d1ae">proxygen::compress::SchemeType::QPACK</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a6b9b7dfedc868076f81acac8b56e643a"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a6b9b7dfedc868076f81acac8b56e643a">proxygen::compress::SimParams::tableSize</a></div><div class="ttdeci">uint32_t tableSize</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00038">CompressionTypes.h:38</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a9a24d6755cb25f8530ab3c44d8acea2a"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a9a24d6755cb25f8530ab3c44d8acea2a">proxygen::compress::SimParams::type</a></div><div class="ttdeci">SchemeType type</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00029">CompressionTypes.h:29</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a1aba8e1f730b3bdaf46a6f9df4a9e475"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a1aba8e1f730b3bdaf46a6f9df4a9e475">proxygen::compress::SimParams::maxBlocking</a></div><div class="ttdeci">uint32_t maxBlocking</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00039">CompressionTypes.h:39</a></div></div>
<div class="ttc" id="namespaceproxygen_1_1compress_html_adb2f38c607bc534e811b122dbed14ef2abeeb357da92a0c9056f9e9f91fc48938"><div class="ttname"><a href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2abeeb357da92a0c9056f9e9f91fc48938">proxygen::compress::SchemeType::HPACK</a></div></div>
<div class="ttc" id="namespaceproxygen_1_1compress_html_adb2f38c607bc534e811b122dbed14ef2a3b78b53f7b985978b86a572e04bb4f9c"><div class="ttname"><a href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2a3b78b53f7b985978b86a572e04bb4f9c">proxygen::compress::SchemeType::QMIN</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa3aa2b684f8d8a8aad6850bfafa94c29"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t proxygen::compress::CompressionSimulator::minOOOThresh </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00401">401</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                            {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#ab708af9d091677dfd8bd47f5a0d87801">minOOOThresh</a>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_ab708af9d091677dfd8bd47f5a0d87801"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#ab708af9d091677dfd8bd47f5a0d87801">proxygen::compress::SimParams::minOOOThresh</a></div><div class="ttdeci">uint16_t minOOOThresh</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00035">CompressionTypes.h:35</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac277f5cf3c36830948b344ecad58db3e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds proxygen::compress::CompressionSimulator::one_half_rtt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00379">379</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                                         {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a950fd3d1438d5099147bc911c049e272">rtt</a> / 2;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a950fd3d1438d5099147bc911c049e272"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a950fd3d1438d5099147bc911c049e272">proxygen::compress::SimParams::rtt</a></div><div class="ttdeci">std::chrono::milliseconds rtt</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00031">CompressionTypes.h:31</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a669fd5e309fe7b672d0a192039782b9a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool proxygen::compress::CompressionSimulator::readInputFromFileAndSchedule </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00036">36</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="namespaceproxygen.html#ab18179a16a0bebed81cf3f62dff11064abb1ca97ec761fc37101737ba0aa2e7c5">proxygen::ERROR</a>, <a class="el" href="HTTPMessage_8h_source.html#l00629">proxygen::HTTPMessage::getStartTime()</a>, <a class="el" href="Time_8h_source.html#l00085">proxygen::millisecondsBetween()</a>, and <a class="el" href="HTTPArchive_8h_source.html#l00024">proxygen::HTTPArchive::requests</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>, and <a class="el" href="Main_8cpp_source.html#l00039">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                            {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  unique_ptr&lt;HTTPArchive&gt; har;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    har = <a class="code" href="classproxygen_1_1HTTPArchive.html#ade6002df68c6f60ec8a96d24262cf248">HTTPArchive::fromFile</a>(kTestDir + filename);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    LOG(ERROR) &lt;&lt; folly::exceptionStr(ex);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  }</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (!har || har-&gt;<a class="code" href="classproxygen_1_1HTTPArchive.html#a3b0e159ff83d50caf77b1dd29dd3c868">requests</a>.size() == 0) {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  }</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">// Sort by start time (har ordered by finish time?)</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  std::sort(har-&gt;<a class="code" href="classproxygen_1_1HTTPArchive.html#a3b0e159ff83d50caf77b1dd29dd3c868">requests</a>.begin(),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            har-&gt;<a class="code" href="classproxygen_1_1HTTPArchive.html#a3b0e159ff83d50caf77b1dd29dd3c868">requests</a>.end(),</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            [](<span class="keyword">const</span> <a class="code" href="classproxygen_1_1HTTPMessage.html">HTTPMessage</a>&amp; a, <span class="keyword">const</span> <a class="code" href="classproxygen_1_1HTTPMessage.html">HTTPMessage</a>&amp; b) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;              <span class="keywordflow">return</span> a.<a class="code" href="classproxygen_1_1HTTPMessage.html#ad50401dd7754119846424e9b26434976">getStartTime</a>() &lt; b.getStartTime();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            });</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="namespaceproxygen.html#ab1ccd825f69c99dd89b92765687b8d27">TimePoint</a> last = har-&gt;<a class="code" href="classproxygen_1_1HTTPArchive.html#a3b0e159ff83d50caf77b1dd29dd3c868">requests</a>[0].getStartTime();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  std::chrono::milliseconds cumulativeDelay(0);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  uint16_t index = 0;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classproxygen_1_1HTTPMessage.html">HTTPMessage</a>&amp; msg : har-&gt;<a class="code" href="classproxygen_1_1HTTPArchive.html#a3b0e159ff83d50caf77b1dd29dd3c868">requests</a>) {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">auto</span> delayFromPrevious = <a class="code" href="namespaceproxygen.html#ae94f36adf5ce28528d9e34c9ba9cc5f8">millisecondsBetween</a>(msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#ad50401dd7754119846424e9b26434976">getStartTime</a>(), last);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// If there was a quiescent gap in the HAR of at least some value, shrink</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// it so the test doesn&#39;t last forever</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> (delayFromPrevious &gt; std::chrono::milliseconds(1000)) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      delayFromPrevious = std::chrono::milliseconds(1000);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    last = msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#ad50401dd7754119846424e9b26434976">getStartTime</a>();</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    cumulativeDelay += delayFromPrevious;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a63980bd7582703dfdd89aa3fffdc93ff">setupRequest</a>(index++, std::move(msg), cumulativeDelay);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; kv : <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">domains_</a>) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae5507a6cc20d0189a91a840c1e9650ea">flushRequests</a>(kv.second.get());</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div><div class="ttc" id="namespaceproxygen_html_ae94f36adf5ce28528d9e34c9ba9cc5f8"><div class="ttname"><a href="namespaceproxygen.html#ae94f36adf5ce28528d9e34c9ba9cc5f8">proxygen::millisecondsBetween</a></div><div class="ttdeci">std::chrono::milliseconds millisecondsBetween(std::chrono::time_point&lt; ClockType &gt; finish, std::chrono::time_point&lt; ClockType &gt; start)</div><div class="ttdef"><b>Definition:</b> <a href="Time_8h_source.html#l00085">Time.h:85</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a53051171a9727bfeb9f1566814b64b60"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">proxygen::compress::CompressionSimulator::domains_</a></div><div class="ttdeci">std::unordered_map&lt; std::string, std::unique_ptr&lt; CompressionScheme &gt; &gt; domains_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00069">CompressionSimulator.h:69</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPMessage_html_ad50401dd7754119846424e9b26434976"><div class="ttname"><a href="classproxygen_1_1HTTPMessage.html#ad50401dd7754119846424e9b26434976">proxygen::HTTPMessage::getStartTime</a></div><div class="ttdeci">TimePoint getStartTime() const </div><div class="ttdef"><b>Definition:</b> <a href="HTTPMessage_8h_source.html#l00629">HTTPMessage.h:629</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a63980bd7582703dfdd89aa3fffdc93ff"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a63980bd7582703dfdd89aa3fffdc93ff">proxygen::compress::CompressionSimulator::setupRequest</a></div><div class="ttdeci">void setupRequest(uint16_t seqn, HTTPMessage &amp;&amp;msg, std::chrono::milliseconds encodeDelay)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00137">CompressionSimulator.cpp:137</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPArchive_html_ade6002df68c6f60ec8a96d24262cf248"><div class="ttname"><a href="classproxygen_1_1HTTPArchive.html#ade6002df68c6f60ec8a96d24262cf248">proxygen::HTTPArchive::fromFile</a></div><div class="ttdeci">static std::unique_ptr&lt; HTTPArchive &gt; fromFile(const std::string &amp;filename)</div><div class="ttdef"><b>Definition:</b> <a href="HTTPArchive_8cpp_source.html#l00148">HTTPArchive.cpp:148</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae5507a6cc20d0189a91a840c1e9650ea"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae5507a6cc20d0189a91a840c1e9650ea">proxygen::compress::CompressionSimulator::flushRequests</a></div><div class="ttdeci">void flushRequests(CompressionScheme *scheme)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00103">CompressionSimulator.cpp:103</a></div></div>
<div class="ttc" id="namespaceproxygen_html_ab1ccd825f69c99dd89b92765687b8d27"><div class="ttname"><a href="namespaceproxygen.html#ab1ccd825f69c99dd89b92765687b8d27">proxygen::TimePoint</a></div><div class="ttdeci">SteadyClock::time_point TimePoint</div><div class="ttdef"><b>Definition:</b> <a href="Time_8h_source.html#l00025">Time.h:25</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPArchive_html_a3b0e159ff83d50caf77b1dd29dd3c868"><div class="ttname"><a href="classproxygen_1_1HTTPArchive.html#a3b0e159ff83d50caf77b1dd29dd3c868">proxygen::HTTPArchive::requests</a></div><div class="ttdeci">std::vector&lt; HTTPMessage &gt; requests</div><div class="ttdef"><b>Definition:</b> <a href="HTTPArchive_8h_source.html#l00024">HTTPArchive.h:24</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPMessage_html"><div class="ttname"><a href="classproxygen_1_1HTTPMessage.html">proxygen::HTTPMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="HTTPMessage_8h_source.html#l00039">HTTPMessage.h:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1edc5901ae87a12da5851a6a238293fc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::recvAck </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="structproxygen_1_1compress_1_1CompressionScheme_1_1Ack.html">CompressionScheme::Ack</a> &gt;&#160;</td>
          <td class="paramname"><em>ack</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00349">349</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>References <a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html#a8b5b9dbfd8f08e0dfdc6415e7432ddbf">proxygen::compress::CompressionScheme::recvAck()</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                                                         {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  scheme-&gt;<a class="code" href="classproxygen_1_1compress_1_1CompressionScheme.html#a8b5b9dbfd8f08e0dfdc6415e7432ddbf">recvAck</a>(std::move(ack));</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionScheme_html_a8b5b9dbfd8f08e0dfdc6415e7432ddbf"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionScheme.html#a8b5b9dbfd8f08e0dfdc6415e7432ddbf">proxygen::compress::CompressionScheme::recvAck</a></div><div class="ttdeci">virtual void recvAck(std::unique_ptr&lt; Ack &gt;)=0</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aee96fdc737e78658a558b44c877bca6d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds proxygen::compress::CompressionSimulator::rtt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00375">375</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                                {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a950fd3d1438d5099147bc911c049e272">rtt</a>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a950fd3d1438d5099147bc911c049e272"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a950fd3d1438d5099147bc911c049e272">proxygen::compress::SimParams::rtt</a></div><div class="ttdeci">std::chrono::milliseconds rtt</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00031">CompressionTypes.h:31</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5b756a2a20de3ecd7f2fd00c995b78d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00073">73</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>, and <a class="el" href="Main_8cpp_source.html#l00039">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                               {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#ifndef HAVE_REAL_QMIN</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#a9a24d6755cb25f8530ab3c44d8acea2a">type</a> == <a class="code" href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2a3b78b53f7b985978b86a572e04bb4f9c">SchemeType::QMIN</a>) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;QMIN not available&quot;</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Starting run&quot;</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">eventBase_</a>.loop();</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  uint32_t holBlockCount = 0;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; scheme : <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">domains_</a>) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    holBlockCount += scheme.second-&gt;getHolBlockCount();</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;Complete&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nStats:&quot;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;               <span class="stringliteral">&quot;\nSeed: &quot;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#ac39b8b8125137f1a6717715d15c0f9e3">seed</a> &lt;&lt; <span class="stringliteral">&quot;\nBlocks sent: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">requests_</a>.size()</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nAllowed OOO: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a49558095f027205213e7303eda1a9a46">allowedOOO</a></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nPackets: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#ab2e8dceeec812bc692731823c9599813">packets</a></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nPacket Losses: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a7985f6c5121e808734cf9c10d8516c24">packetLosses</a></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nHOL Block Count: &quot;</span> &lt;&lt; holBlockCount</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nHOL Delay (ms): &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a79ab4a5373197e07c1869f6e7d8fe518">holDelay</a>.count()</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nMax Queue Buffer Bytes: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#af398c13ba74d5502e5b5e8407309f67c">maxQueueBufferBytes</a></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nUncompressed Bytes: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">uncompressed</a></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nCompressed Bytes: &quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5cf35c268868a68c901e6282f5efd158">compressed</a></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\nCompression Ratio: &quot;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            &lt;&lt; int(100 - <span class="keywordtype">double</span>(100 * <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5cf35c268868a68c901e6282f5efd158">compressed</a>) / <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">uncompressed</a>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a5e6232fed235cd5c07f867cc03162607"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a5e6232fed235cd5c07f867cc03162607">proxygen::compress::SimStats::uncompressed</a></div><div class="ttdeci">uint64_t uncompressed</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00047">CompressionTypes.h:47</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a5cf35c268868a68c901e6282f5efd158"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a5cf35c268868a68c901e6282f5efd158">proxygen::compress::SimStats::compressed</a></div><div class="ttdeci">uint64_t compressed</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00048">CompressionTypes.h:48</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_ac39b8b8125137f1a6717715d15c0f9e3"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#ac39b8b8125137f1a6717715d15c0f9e3">proxygen::compress::SimParams::seed</a></div><div class="ttdeci">int64_t seed</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00030">CompressionTypes.h:30</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a7985f6c5121e808734cf9c10d8516c24"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a7985f6c5121e808734cf9c10d8516c24">proxygen::compress::SimStats::packetLosses</a></div><div class="ttdeci">uint64_t packetLosses</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00044">CompressionTypes.h:44</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a79ab4a5373197e07c1869f6e7d8fe518"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a79ab4a5373197e07c1869f6e7d8fe518">proxygen::compress::SimStats::holDelay</a></div><div class="ttdeci">std::chrono::milliseconds holDelay</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00046">CompressionTypes.h:46</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a9513db1985327332e7a9e87f708fa899"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">proxygen::compress::CompressionSimulator::params_</a></div><div class="ttdeci">SimParams params_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00065">CompressionSimulator.h:65</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a53051171a9727bfeb9f1566814b64b60"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a53051171a9727bfeb9f1566814b64b60">proxygen::compress::CompressionSimulator::domains_</a></div><div class="ttdeci">std::unordered_map&lt; std::string, std::unique_ptr&lt; CompressionScheme &gt; &gt; domains_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00069">CompressionSimulator.h:69</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimParams_html_a9a24d6755cb25f8530ab3c44d8acea2a"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimParams.html#a9a24d6755cb25f8530ab3c44d8acea2a">proxygen::compress::SimParams::type</a></div><div class="ttdeci">SchemeType type</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00029">CompressionTypes.h:29</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac5749fb27acd9bfcb3cf75032e7103fb"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">proxygen::compress::CompressionSimulator::eventBase_</a></div><div class="ttdeci">folly::EventBase eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00067">CompressionSimulator.h:67</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a49558095f027205213e7303eda1a9a46"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a49558095f027205213e7303eda1a9a46">proxygen::compress::SimStats::allowedOOO</a></div><div class="ttdeci">uint64_t allowedOOO</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00043">CompressionTypes.h:43</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ad3715b92b4caff88ff3cf9ca77f954b7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">proxygen::compress::CompressionSimulator::requests_</a></div><div class="ttdeci">std::vector&lt; proxygen::HTTPMessage &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00066">CompressionSimulator.h:66</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_af398c13ba74d5502e5b5e8407309f67c"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#af398c13ba74d5502e5b5e8407309f67c">proxygen::compress::SimStats::maxQueueBufferBytes</a></div><div class="ttdeci">uint64_t maxQueueBufferBytes</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00045">CompressionTypes.h:45</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_ab2e8dceeec812bc692731823c9599813"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#ab2e8dceeec812bc692731823c9599813">proxygen::compress::SimStats::packets</a></div><div class="ttdeci">uint64_t packets</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00049">CompressionTypes.h:49</a></div></div>
<div class="ttc" id="namespaceproxygen_1_1compress_html_adb2f38c607bc534e811b122dbed14ef2a3b78b53f7b985978b86a572e04bb4f9c"><div class="ttname"><a href="namespaceproxygen_1_1compress.html#adb2f38c607bc534e811b122dbed14ef2a3b78b53f7b985978b86a572e04bb4f9c">proxygen::compress::SchemeType::QMIN</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5c93f855c37efddfc1468a754aca7539"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds proxygen::compress::CompressionSimulator::rxmitDelay </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00383">383</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                                       {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  uint32_t ms = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aee96fdc737e78658a558b44c877bca6d">rtt</a>().count() * Random::randDouble(1.1, 2, <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">rng_</a>);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">return</span> std::chrono::milliseconds(ms);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aee96fdc737e78658a558b44c877bca6d"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aee96fdc737e78658a558b44c877bca6d">proxygen::compress::CompressionSimulator::rtt</a></div><div class="ttdeci">std::chrono::milliseconds rtt()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00375">CompressionSimulator.cpp:375</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae668782e2b26f9ca6dd1cd8f5c6d5cc7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae668782e2b26f9ca6dd1cd8f5c6d5cc7">proxygen::compress::CompressionSimulator::rng_</a></div><div class="ttdeci">folly::Random::DefaultGenerator rng_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00071">CompressionSimulator.h:71</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac04f1b78922a01355be9bc27d20455a7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::scheduleEvent </td>
          <td>(</td>
          <td class="paramtype">folly::Function&lt; void()&gt;&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>ms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00331">331</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                                                   {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">eventBase_</a>.runAfterDelay(std::move(f), ms.count());</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac5749fb27acd9bfcb3cf75032e7103fb"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac5749fb27acd9bfcb3cf75032e7103fb">proxygen::compress::CompressionSimulator::eventBase_</a></div><div class="ttdeci">folly::EventBase eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00067">CompressionSimulator.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6d9e755a51c6b580b6c793bbdd0e72d9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::sendAck </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a> *&#160;</td>
          <td class="paramname"><em>scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="structproxygen_1_1compress_1_1CompressionScheme_1_1Ack.html">CompressionScheme::Ack</a> &gt;&#160;</td>
          <td class="paramname"><em>ack</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00336">336</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                                                         {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">if</span> (!ack) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// An ack is a packet</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#ab2e8dceeec812bc692731823c9599813">packets</a>++;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">scheduleEvent</a>([a = std::move(ack),</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                 <span class="keyword">this</span>,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                 scheme]() <span class="keyword">mutable</span> { <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1edc5901ae87a12da5851a6a238293fc">recvAck</a>(scheme, std::move(a)); },</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#af0d6d728f67553cdfa0149c7bc7e634f">deliveryDelay</a>());</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ac04f1b78922a01355be9bc27d20455a7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ac04f1b78922a01355be9bc27d20455a7">proxygen::compress::CompressionSimulator::scheduleEvent</a></div><div class="ttdeci">void scheduleEvent(folly::Function&lt; void()&gt; f, std::chrono::milliseconds ms)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00331">CompressionSimulator.cpp:331</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_af0d6d728f67553cdfa0149c7bc7e634f"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#af0d6d728f67553cdfa0149c7bc7e634f">proxygen::compress::CompressionSimulator::deliveryDelay</a></div><div class="ttdeci">std::chrono::milliseconds deliveryDelay()</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00354">CompressionSimulator.cpp:354</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a1edc5901ae87a12da5851a6a238293fc"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1edc5901ae87a12da5851a6a238293fc">proxygen::compress::CompressionSimulator::recvAck</a></div><div class="ttdeci">void recvAck(CompressionScheme *scheme, std::unique_ptr&lt; CompressionScheme::Ack &gt; ack)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00349">CompressionSimulator.cpp:349</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_ab2e8dceeec812bc692731823c9599813"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#ab2e8dceeec812bc692731823c9599813">proxygen::compress::SimStats::packets</a></div><div class="ttdeci">uint64_t packets</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00049">CompressionTypes.h:49</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a63980bd7582703dfdd89aa3fffdc93ff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::compress::CompressionSimulator::setupRequest </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>seqn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1HTTPMessage.html">HTTPMessage</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>encodeDelay</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8cpp_source.html#l00137">137</a> of file <a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a>.</p>

<p>Referenced by <a class="el" href="CompressionSimulator_8h_source.html#l00025">CompressionSimulator()</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                                                           {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// Normalize to relative paths</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; query = msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#a59ed36062deb67b794a6f947dc67008a">getQueryString</a>();</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordflow">if</span> (query.empty()) {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#a0753ce8ab4cdd78cb5b8f4a97180e75b">setURL</a>(msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#ae5544cbbbf768fee05903ac69cdc9172">getPath</a>());</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#a0753ce8ab4cdd78cb5b8f4a97180e75b">setURL</a>(folly::to&lt;string&gt;(msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#ae5544cbbbf768fee05903ac69cdc9172">getPath</a>(), <span class="stringliteral">&quot;?&quot;</span>, query));</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keyword">auto</span> scheme = <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1d2618417295b3be19f67d35d8f974af">getScheme</a>(msg.<a class="code" href="classproxygen_1_1HTTPMessage.html#a2ba4953e1ab061fe5eb68af08e684772">getHeaders</a>().<a class="code" href="classproxygen_1_1HTTPHeaders.html#aa14bc0e99fc0ebe98fb95b7cff1bb598">getSingleOrEmpty</a>(HTTP_HEADER_HOST));</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">requests_</a>.emplace_back(msg);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keyword">auto</span> decodeCompleteCB =</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      [index, <span class="keyword">this</span>, scheme](std::chrono::milliseconds holDelay) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// record processed timestamp</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        CHECK(!<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">callbacks_</a>[index].getResult().hasError());</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        DCHECK_EQ(<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">requests_</a>[index], *<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">callbacks_</a>[index].getResult().value());</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a79ab4a5373197e07c1869f6e7d8fe518">holDelay</a> += holDelay;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        VLOG(1) &lt;&lt; <span class="stringliteral">&quot;Finished decoding request=&quot;</span> &lt;&lt; index</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; with holDelay=&quot;</span> &lt;&lt; holDelay.count()</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; cumulative HoL delay=&quot;</span> &lt;&lt; <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">stats_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimStats.html#a79ab4a5373197e07c1869f6e7d8fe518">holDelay</a>.count();</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">callbacks_</a>[index].acknowledge) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;          <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a6d9e755a51c6b580b6c793bbdd0e72d9">sendAck</a>(scheme, scheme-&gt;getAck(<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">callbacks_</a>[index].seqn));</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      };</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">callbacks_</a>.emplace_back(index, decodeCompleteCB);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// Assume that all packets with same encodeDelay will form a packet</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="comment">// train.  Encode them as a group, so can we can emulate packet</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">// boundaries more realistically, telling the encoder which blocks</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">// start such trains.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">if</span> (scheme-&gt;packetIndices.size() &gt; 0) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keyword">auto</span> delayFromPrevious = encodeDelay - scheme-&gt;prev;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    VLOG(1) &lt;&lt; <span class="stringliteral">&quot;request &quot;</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">&quot; delay &quot;</span> &lt;&lt; delayFromPrevious.count();</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (delayFromPrevious &gt; std::chrono::milliseconds(1)) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae5507a6cc20d0189a91a840c1e9650ea">flushRequests</a>(scheme);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  scheme-&gt;prev = encodeDelay;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  scheme-&gt;packetIndices.push_back(index);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div><div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a4c6e0687998c74788b4a21c4edcff6d8"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a4c6e0687998c74788b4a21c4edcff6d8">proxygen::compress::CompressionSimulator::callbacks_</a></div><div class="ttdeci">std::vector&lt; SimStreamingCallback &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00070">CompressionSimulator.h:70</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPMessage_html_ae5544cbbbf768fee05903ac69cdc9172"><div class="ttname"><a href="classproxygen_1_1HTTPMessage.html#ae5544cbbbf768fee05903ac69cdc9172">proxygen::HTTPMessage::getPath</a></div><div class="ttdeci">const std::string &amp; getPath() const </div><div class="ttdef"><b>Definition:</b> <a href="HTTPMessage_8h_source.html#l00215">HTTPMessage.h:215</a></div></div>
<div class="ttc" id="structproxygen_1_1compress_1_1SimStats_html_a79ab4a5373197e07c1869f6e7d8fe518"><div class="ttname"><a href="structproxygen_1_1compress_1_1SimStats.html#a79ab4a5373197e07c1869f6e7d8fe518">proxygen::compress::SimStats::holDelay</a></div><div class="ttdeci">std::chrono::milliseconds holDelay</div><div class="ttdef"><b>Definition:</b> <a href="CompressionTypes_8h_source.html#l00046">CompressionTypes.h:46</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPMessage_html_a59ed36062deb67b794a6f947dc67008a"><div class="ttname"><a href="classproxygen_1_1HTTPMessage.html#a59ed36062deb67b794a6f947dc67008a">proxygen::HTTPMessage::getQueryString</a></div><div class="ttdeci">const std::string &amp; getQueryString() const </div><div class="ttdef"><b>Definition:</b> <a href="HTTPMessage_8h_source.html#l00222">HTTPMessage.h:222</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_aa38d3dd39bf4ad68347a3668899aa9ed"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#aa38d3dd39bf4ad68347a3668899aa9ed">proxygen::compress::CompressionSimulator::stats_</a></div><div class="ttdeci">SimStats stats_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00073">CompressionSimulator.h:73</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPMessage_html_a0753ce8ab4cdd78cb5b8f4a97180e75b"><div class="ttname"><a href="classproxygen_1_1HTTPMessage.html#a0753ce8ab4cdd78cb5b8f4a97180e75b">proxygen::HTTPMessage::setURL</a></div><div class="ttdeci">ParseURL setURL(T &amp;&amp;url)</div><div class="ttdef"><b>Definition:</b> <a href="HTTPMessage_8h_source.html#l00183">HTTPMessage.h:183</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ae5507a6cc20d0189a91a840c1e9650ea"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ae5507a6cc20d0189a91a840c1e9650ea">proxygen::compress::CompressionSimulator::flushRequests</a></div><div class="ttdeci">void flushRequests(CompressionScheme *scheme)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00103">CompressionSimulator.cpp:103</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPMessage_html_a2ba4953e1ab061fe5eb68af08e684772"><div class="ttname"><a href="classproxygen_1_1HTTPMessage.html#a2ba4953e1ab061fe5eb68af08e684772">proxygen::HTTPMessage::getHeaders</a></div><div class="ttdeci">HTTPHeaders &amp; getHeaders()</div><div class="ttdef"><b>Definition:</b> <a href="HTTPMessage_8h_source.html#l00273">HTTPMessage.h:273</a></div></div>
<div class="ttc" id="classproxygen_1_1HTTPHeaders_html_aa14bc0e99fc0ebe98fb95b7cff1bb598"><div class="ttname"><a href="classproxygen_1_1HTTPHeaders.html#aa14bc0e99fc0ebe98fb95b7cff1bb598">proxygen::HTTPHeaders::getSingleOrEmpty</a></div><div class="ttdeci">const std::string &amp; getSingleOrEmpty(const T &amp;nameOrCode) const </div><div class="ttdef"><b>Definition:</b> <a href="HTTPHeaders_8h_source.html#l00434">HTTPHeaders.h:434</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a1d2618417295b3be19f67d35d8f974af"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a1d2618417295b3be19f67d35d8f974af">proxygen::compress::CompressionSimulator::getScheme</a></div><div class="ttdeci">CompressionScheme * getScheme(folly::StringPiece host)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00252">CompressionSimulator.cpp:252</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_a6d9e755a51c6b580b6c793bbdd0e72d9"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#a6d9e755a51c6b580b6c793bbdd0e72d9">proxygen::compress::CompressionSimulator::sendAck</a></div><div class="ttdeci">void sendAck(CompressionScheme *scheme, std::unique_ptr&lt; CompressionScheme::Ack &gt; ack)</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8cpp_source.html#l00336">CompressionSimulator.cpp:336</a></div></div>
<div class="ttc" id="classproxygen_1_1compress_1_1CompressionSimulator_html_ad3715b92b4caff88ff3cf9ca77f954b7"><div class="ttname"><a href="classproxygen_1_1compress_1_1CompressionSimulator.html#ad3715b92b4caff88ff3cf9ca77f954b7">proxygen::compress::CompressionSimulator::requests_</a></div><div class="ttdeci">std::vector&lt; proxygen::HTTPMessage &gt; requests_</div><div class="ttdef"><b>Definition:</b> <a href="CompressionSimulator_8h_source.html#l00066">CompressionSimulator.h:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a4c6e0687998c74788b4a21c4edcff6d8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classproxygen_1_1compress_1_1SimStreamingCallback.html">SimStreamingCallback</a>&gt; proxygen::compress::CompressionSimulator::callbacks_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00070">70</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a53051171a9727bfeb9f1566814b64b60"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;std::string, std::unique_ptr&lt;<a class="el" href="classproxygen_1_1compress_1_1CompressionScheme.html">CompressionScheme</a>&gt; &gt; proxygen::compress::CompressionSimulator::domains_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00069">69</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac5749fb27acd9bfcb3cf75032e7103fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::EventBase proxygen::compress::CompressionSimulator::eventBase_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00067">67</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9513db1985327332e7a9e87f708fa899"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structproxygen_1_1compress_1_1SimParams.html">SimParams</a> proxygen::compress::CompressionSimulator::params_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00065">65</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad3715b92b4caff88ff3cf9ca77f954b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classproxygen_1_1HTTPMessage.html">proxygen::HTTPMessage</a>&gt; proxygen::compress::CompressionSimulator::requests_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00066">66</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae668782e2b26f9ca6dd1cd8f5c6d5cc7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::Random::DefaultGenerator proxygen::compress::CompressionSimulator::rng_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">{</div><div class="line">      <span class="keyword">static_cast&lt;</span>folly::Random::DefaultGenerator::result_type<span class="keyword">&gt;</span>(<a class="code" href="classproxygen_1_1compress_1_1CompressionSimulator.html#a9513db1985327332e7a9e87f708fa899">params_</a>.<a class="code" href="structproxygen_1_1compress_1_1SimParams.html#ac39b8b8125137f1a6717715d15c0f9e3">seed</a>)}</div></div><!-- fragment -->
<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00071">71</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa38d3dd39bf4ad68347a3668899aa9ed"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structproxygen_1_1compress_1_1SimStats.html">SimStats</a> proxygen::compress::CompressionSimulator::stats_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CompressionSimulator_8h_source.html#l00073">73</a> of file <a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/lib/http/codec/compress/experimental/simulator/<a class="el" href="CompressionSimulator_8h_source.html">CompressionSimulator.h</a></li>
<li>proxygen/lib/http/codec/compress/experimental/simulator/<a class="el" href="CompressionSimulator_8cpp_source.html">CompressionSimulator.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceproxygen.html">proxygen</a></li><li class="navelem"><a class="el" href="namespaceproxygen_1_1compress.html">compress</a></li><li class="navelem"><a class="el" href="classproxygen_1_1compress_1_1CompressionSimulator.html">CompressionSimulator</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
