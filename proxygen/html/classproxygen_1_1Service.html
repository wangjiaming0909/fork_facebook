<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: proxygen::Service Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classproxygen_1_1Service.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classproxygen_1_1Service-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">proxygen::Service Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="Service_8h_source.html">Service.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3dd2ab78ecb35c00c06c249f308a0548"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a3dd2ab78ecb35c00c06c249f308a0548">Service</a> ()</td></tr>
<tr class="separator:a3dd2ab78ecb35c00c06c249f308a0548"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19651ee36f0587e739feb16e46335fc1"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a19651ee36f0587e739feb16e46335fc1">~Service</a> ()</td></tr>
<tr class="separator:a19651ee36f0587e739feb16e46335fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2022b84c986021512bce0c6a0da92c18"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a2022b84c986021512bce0c6a0da92c18">init</a> (folly::EventBase *mainEventBase, const std::list&lt; <a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> * &gt; &amp;workers)=0</td></tr>
<tr class="separator:a2022b84c986021512bce0c6a0da92c18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c07ad7dcdbd7266ace387753af4b19e"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a6c07ad7dcdbd7266ace387753af4b19e">finishInit</a> ()</td></tr>
<tr class="separator:a6c07ad7dcdbd7266ace387753af4b19e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8252af19f3d9ed27b92aa86014dba1b0"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a8252af19f3d9ed27b92aa86014dba1b0">startAccepting</a> ()</td></tr>
<tr class="separator:a8252af19f3d9ed27b92aa86014dba1b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77a22433e5717bee7adf9d7319e7c6c9"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a77a22433e5717bee7adf9d7319e7c6c9">failHealthChecks</a> ()</td></tr>
<tr class="separator:a77a22433e5717bee7adf9d7319e7c6c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a904b289b962b777e59a1c8798143a2a2"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a904b289b962b777e59a1c8798143a2a2">stopAccepting</a> ()=0</td></tr>
<tr class="separator:a904b289b962b777e59a1c8798143a2a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0bae3d89b417b14d5e2a8f2089c3e4a"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#ad0bae3d89b417b14d5e2a8f2089c3e4a">pauseListening</a> ()</td></tr>
<tr class="separator:ad0bae3d89b417b14d5e2a8f2089c3e4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70a38d79e36b6c10b36efbf1ea9042c6"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a70a38d79e36b6c10b36efbf1ea9042c6">dropConnections</a> (double)</td></tr>
<tr class="separator:a70a38d79e36b6c10b36efbf1ea9042c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11d6ba913d9ff0322e36745e7de43382"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop</a> ()</td></tr>
<tr class="separator:a11d6ba913d9ff0322e36745e7de43382"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d1edd8575f9df19636977574e161d88"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a0d1edd8575f9df19636977574e161d88">initWorkerState</a> (<a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> *)</td></tr>
<tr class="separator:a0d1edd8575f9df19636977574e161d88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65a04c0c41179f726b95760f1d3ea659"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a65a04c0c41179f726b95760f1d3ea659">cleanupWorkerState</a> (<a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> *)</td></tr>
<tr class="separator:a65a04c0c41179f726b95760f1d3ea659"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdadd74deb16648a332e4a79ef424c70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#abdadd74deb16648a332e4a79ef424c70">addServiceWorker</a> (std::unique_ptr&lt; <a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a> &gt; worker, <a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> *reqWorker)</td></tr>
<tr class="separator:abdadd74deb16648a332e4a79ef424c70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a966cc18b1174fb8d568b17b84b2eeb76"><td class="memItemLeft" align="right" valign="top">const std::list&lt; std::unique_ptr&lt; <a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a> &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a966cc18b1174fb8d568b17b84b2eeb76">getServiceWorkers</a> () const </td></tr>
<tr class="separator:a966cc18b1174fb8d568b17b84b2eeb76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a479996af2008bb7652052e903b8a7ccd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a479996af2008bb7652052e903b8a7ccd">clearServiceWorkers</a> ()</td></tr>
<tr class="separator:a479996af2008bb7652052e903b8a7ccd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d192179cb2c48422cdd60464318deee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a3d192179cb2c48422cdd60464318deee">addWorkerEventBase</a> (folly::EventBase *evb)</td></tr>
<tr class="separator:a3d192179cb2c48422cdd60464318deee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80e281f3572789548c629907ddc6f327"><td class="memItemLeft" align="right" valign="top">const std::vector&lt; folly::EventBase * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a80e281f3572789548c629907ddc6f327">getWorkerEventBases</a> ()</td></tr>
<tr class="separator:a80e281f3572789548c629907ddc6f327"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ab506559d9d9676b9a6571e35391ed87c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#ab506559d9d9676b9a6571e35391ed87c">Service</a> (<a class="el" href="classproxygen_1_1Service.html">Service</a> const &amp;)=delete</td></tr>
<tr class="separator:ab506559d9d9676b9a6571e35391ed87c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba21125a46e35702a15af1b2e213b936"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classproxygen_1_1Service.html">Service</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#aba21125a46e35702a15af1b2e213b936">operator=</a> (<a class="el" href="classproxygen_1_1Service.html">Service</a> const &amp;)=delete</td></tr>
<tr class="separator:aba21125a46e35702a15af1b2e213b936"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a3597a61a56f378ac599cb410d1beff13"><td class="memItemLeft" align="right" valign="top">std::list&lt; std::unique_ptr&lt; <a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">workers_</a></td></tr>
<tr class="separator:a3597a61a56f378ac599cb410d1beff13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf3fe5158aea222d7b6de6006a9f0151"><td class="memItemLeft" align="right" valign="top">std::vector&lt; folly::EventBase * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classproxygen_1_1Service.html#abf3fe5158aea222d7b6de6006a9f0151">workerEvbs_</a></td></tr>
<tr class="separator:abf3fe5158aea222d7b6de6006a9f0151"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="Service_8h_source.html#l00032">32</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a3dd2ab78ecb35c00c06c249f308a0548"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">proxygen::Service::Service </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Service_8cpp_source.html#l00017">17</a> of file <a class="el" href="Service_8cpp_source.html">Service.cpp</a>.</p>

<p>Referenced by <a class="el" href="Service_8h_source.html#l00168">getWorkerEventBases()</a>.</p>
<div class="fragment"><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                 {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a19651ee36f0587e739feb16e46335fc1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">proxygen::Service::~Service </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Service_8cpp_source.html#l00020">20</a> of file <a class="el" href="Service_8cpp_source.html">Service.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                  {</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab506559d9d9676b9a6571e35391ed87c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">proxygen::Service::Service </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1Service.html">Service</a> const &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="abdadd74deb16648a332e4a79ef424c70"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::Service::addServiceWorker </td>
          <td>(</td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a> &gt;&#160;</td>
          <td class="paramname"><em>worker</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> *&#160;</td>
          <td class="paramname"><em>reqWorker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a new <a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a> (subclasses should create one <a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a> per worker thread) </p>

<p>Definition at line <a class="el" href="Service_8cpp_source.html#l00023">23</a> of file <a class="el" href="Service_8cpp_source.html">Service.cpp</a>.</p>

<p>References <a class="el" href="RequestWorker_8h_source.html#l00057">proxygen::RequestWorker::addServiceWorker()</a>, and <a class="el" href="Service_8h_source.html#l00178">workers_</a>.</p>

<p>Referenced by <a class="el" href="Service_8h_source.html#l00143">cleanupWorkerState()</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                                                         {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  reqWorker-&gt;addServiceWorker(<span class="keyword">this</span>, worker.get());</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <a class="code" href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">workers_</a>.emplace_back(std::move(worker));</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;}</div><div class="ttc" id="classproxygen_1_1Service_html_a3597a61a56f378ac599cb410d1beff13"><div class="ttname"><a href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">proxygen::Service::workers_</a></div><div class="ttdeci">std::list&lt; std::unique_ptr&lt; ServiceWorker &gt; &gt; workers_</div><div class="ttdef"><b>Definition:</b> <a href="Service_8h_source.html#l00178">Service.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d192179cb2c48422cdd60464318deee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::Service::addWorkerEventBase </td>
          <td>(</td>
          <td class="paramtype">folly::EventBase *&#160;</td>
          <td class="paramname"><em>evb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Service_8h_source.html#l00164">164</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>References <a class="el" href="Service_8h_source.html#l00179">workerEvbs_</a>.</p>
<div class="fragment"><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                                               {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classproxygen_1_1Service.html#abf3fe5158aea222d7b6de6006a9f0151">workerEvbs_</a>.push_back(evb);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div><div class="ttc" id="classproxygen_1_1Service_html_abf3fe5158aea222d7b6de6006a9f0151"><div class="ttname"><a href="classproxygen_1_1Service.html#abf3fe5158aea222d7b6de6006a9f0151">proxygen::Service::workerEvbs_</a></div><div class="ttdeci">std::vector&lt; folly::EventBase * &gt; workerEvbs_</div><div class="ttdef"><b>Definition:</b> <a href="Service_8h_source.html#l00179">Service.h:179</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a65a04c0c41179f726b95760f1d3ea659"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::cleanupWorkerState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform per-thread cleanup.</p>
<p>This method will be called once for each <a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> thread, just before that thread is about to exit. Note that this method is called from the worker thread itself, not from the main thread.</p>
<p><a class="el" href="classproxygen_1_1Service.html#a77a22433e5717bee7adf9d7319e7c6c9">failHealthChecks()</a> and <a class="el" href="classproxygen_1_1Service.html#a904b289b962b777e59a1c8798143a2a2">stopAccepting()</a> will always be called in the main thread before <a class="el" href="classproxygen_1_1Service.html#a65a04c0c41179f726b95760f1d3ea659">cleanupWorkerState()</a> is called in any of the worker threads.</p>
<p><a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a> may be called in the main thread at any point during shutdown. (i.e., Some worker threads may already have finished and called <a class="el" href="classproxygen_1_1Service.html#a65a04c0c41179f726b95760f1d3ea659">cleanupWorkerState()</a>. Once <a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a> is invoked, the remaining threads will forcibly exit and then call <a class="el" href="classproxygen_1_1Service.html#a65a04c0c41179f726b95760f1d3ea659">cleanupWorkerState()</a>.) </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00143">143</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>References <a class="el" href="Service_8cpp_source.html#l00023">addServiceWorker()</a>.</p>
<div class="fragment"><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a479996af2008bb7652052e903b8a7ccd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proxygen::Service::clearServiceWorkers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Delete all the workers </p>

<p>Definition at line <a class="el" href="Service_8cpp_source.html#l00029">29</a> of file <a class="el" href="Service_8cpp_source.html">Service.cpp</a>.</p>

<p>References <a class="el" href="Service_8h_source.html#l00178">workers_</a>.</p>

<p>Referenced by <a class="el" href="Service_8h_source.html#l00155">getServiceWorkers()</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                  {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">workers_</a>.clear();</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;}</div><div class="ttc" id="classproxygen_1_1Service_html_a3597a61a56f378ac599cb410d1beff13"><div class="ttname"><a href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">proxygen::Service::workers_</a></div><div class="ttdeci">std::list&lt; std::unique_ptr&lt; ServiceWorker &gt; &gt; workers_</div><div class="ttdef"><b>Definition:</b> <a href="Service_8h_source.html#l00178">Service.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a70a38d79e36b6c10b36efbf1ea9042c6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::dropConnections </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Forcibly stop "pct" (0.0 to 1.0) of the remaining client connections.</p>
<p>If the service does not stop on its own after <a class="el" href="classproxygen_1_1Service.html#a904b289b962b777e59a1c8798143a2a2">stopAccepting()</a> is called, then proxygen might call <a class="el" href="classproxygen_1_1Service.html#a70a38d79e36b6c10b36efbf1ea9042c6">dropConnections()</a> several times to gradually stop all processing before finally calling <a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a>. </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00104">104</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a77a22433e5717bee7adf9d7319e7c6c9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::failHealthChecks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Mark the service as about to stop; invoked from main thread.</p>
<p>This indicates that the service will be told to stop at some later time and should continue to service requests but tell the healthchecker that it is dying. </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00076">76</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>References <a class="el" href="classproxygen_1_1Service.html#a904b289b962b777e59a1c8798143a2a2">stopAccepting()</a>.</p>
<div class="fragment"><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6c07ad7dcdbd7266ace387753af4b19e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::finishInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Finish any service initialization that requires the use of the worker threads. </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00056">56</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a11d6ba913d9ff0322e36745e7de43382"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::forceStop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Forcibly stop the service.</p>
<p>If the service does not stop on its own after <a class="el" href="classproxygen_1_1Service.html#a904b289b962b777e59a1c8798143a2a2">stopAccepting()</a> is called, <a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a> will eventually be called to forcibly stop all processing.</p>
<p>(At the moment this isn't pure virtual simply because I haven't had the time to update all existing services to implement <a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a>. Proxygen will forcibly terminate the event loop even if a service does not stop processing when <a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a> is called, so properly implementing <a class="el" href="classproxygen_1_1Service.html#a11d6ba913d9ff0322e36745e7de43382">forceStop()</a> isn't strictly required.) </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00118">118</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a966cc18b1174fb8d568b17b84b2eeb76"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::list&lt;std::unique_ptr&lt;<a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a>&gt; &gt;&amp; proxygen::Service::getServiceWorkers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>List of workers </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00155">155</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>References <a class="el" href="Service_8cpp_source.html#l00029">clearServiceWorkers()</a>, and <a class="el" href="Service_8h_source.html#l00178">workers_</a>.</p>
<div class="fragment"><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                                                         {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">workers_</a>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div><div class="ttc" id="classproxygen_1_1Service_html_a3597a61a56f378ac599cb410d1beff13"><div class="ttname"><a href="classproxygen_1_1Service.html#a3597a61a56f378ac599cb410d1beff13">proxygen::Service::workers_</a></div><div class="ttdeci">std::list&lt; std::unique_ptr&lt; ServiceWorker &gt; &gt; workers_</div><div class="ttdef"><b>Definition:</b> <a href="Service_8h_source.html#l00178">Service.h:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a80e281f3572789548c629907ddc6f327"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::vector&lt;folly::EventBase*&gt;&amp; proxygen::Service::getWorkerEventBases </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Service_8h_source.html#l00168">168</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>References <a class="el" href="classproxygen_1_1Service.html#aba21125a46e35702a15af1b2e213b936">operator=()</a>, <a class="el" href="Service_8cpp_source.html#l00017">Service()</a>, and <a class="el" href="Service_8h_source.html#l00179">workerEvbs_</a>.</p>
<div class="fragment"><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                                          {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classproxygen_1_1Service.html#abf3fe5158aea222d7b6de6006a9f0151">workerEvbs_</a>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  }</div><div class="ttc" id="classproxygen_1_1Service_html_abf3fe5158aea222d7b6de6006a9f0151"><div class="ttname"><a href="classproxygen_1_1Service.html#abf3fe5158aea222d7b6de6006a9f0151">proxygen::Service::workerEvbs_</a></div><div class="ttdeci">std::vector&lt; folly::EventBase * &gt; workerEvbs_</div><div class="ttdef"><b>Definition:</b> <a href="Service_8h_source.html#l00179">Service.h:179</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2022b84c986021512bce0c6a0da92c18"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::init </td>
          <td>(</td>
          <td class="paramtype">folly::EventBase *&#160;</td>
          <td class="paramname"><em>mainEventBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::list&lt; <a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>workers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Initialize the service.</p>
<p><a class="el" href="classproxygen_1_1Service.html#a2022b84c986021512bce0c6a0da92c18">init()</a> will be invoked from proxygen's main thread, before the worker threads have started processing their event loops.</p>
<p>The return value indicates if the service is enabled or not. Return true if the service is enabled and was initialized successfully, and false if the service is disabled or is intialized successfully. Throw an exception if an error occurred initializing it. </p>

</div>
</div>
<a class="anchor" id="a0d1edd8575f9df19636977574e161d88"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::initWorkerState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Perform per-thread init.</p>
<p>This method will be called once for each <a class="el" href="classproxygen_1_1RequestWorker.html">RequestWorker</a> thread, just after the worker thread started. </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00126">126</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aba21125a46e35702a15af1b2e213b936"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classproxygen_1_1Service.html">Service</a>&amp; proxygen::Service::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classproxygen_1_1Service.html">Service</a> const &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="Service_8h_source.html#l00168">getWorkerEventBases()</a>.</p>

</div>
</div>
<a class="anchor" id="ad0bae3d89b417b14d5e2a8f2089c3e4a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::pauseListening </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pause listening for new connections; invoked from proxygen's main thread.</p>
<p>This should cause the service to pause listening for new connections. The already accepted connections must not be affected. It may or may not be followed by stopAccepting or resume listening. </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00095">95</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8252af19f3d9ed27b92aa86014dba1b0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::startAccepting </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Start to accept connection on the listening sockect(s)</p>
<p>All the expansive preparation work should be done befofe <a class="el" href="classproxygen_1_1Service.html#a8252af19f3d9ed27b92aa86014dba1b0">startAccepting()</a>, i.g., in constructor or <a class="el" href="classproxygen_1_1Service.html#a2022b84c986021512bce0c6a0da92c18">init()</a>. <a class="el" href="classproxygen_1_1Service.html#a8252af19f3d9ed27b92aa86014dba1b0">startAccepting()</a> should be lightweight, ideally just the call of accept() on all the listening sockects. Otherwise, the first accepted connection may experience high latency. </p>

<p>Definition at line <a class="el" href="Service_8h_source.html#l00067">67</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a904b289b962b777e59a1c8798143a2a2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void proxygen::Service::stopAccepting </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Stop accepting all new work; invoked from proxygen's main thread.</p>
<p>This should cause the service to stop accepting new work, and begin to fully shut down. stop() may return before all work has completed, but it should eventually cause all events for this service to be removed from the main EventBase and from the worker threads. </p>

<p>Referenced by <a class="el" href="Service_8h_source.html#l00076">failHealthChecks()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="abf3fe5158aea222d7b6de6006a9f0151"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;folly::EventBase*&gt; proxygen::Service::workerEvbs_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Service_8h_source.html#l00179">179</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>Referenced by <a class="el" href="Service_8h_source.html#l00164">addWorkerEventBase()</a>, and <a class="el" href="Service_8h_source.html#l00168">getWorkerEventBases()</a>.</p>

</div>
</div>
<a class="anchor" id="a3597a61a56f378ac599cb410d1beff13"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt;std::unique_ptr&lt;<a class="el" href="classproxygen_1_1ServiceWorker.html">ServiceWorker</a>&gt; &gt; proxygen::Service::workers_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Service_8h_source.html#l00178">178</a> of file <a class="el" href="Service_8h_source.html">Service.h</a>.</p>

<p>Referenced by <a class="el" href="Service_8cpp_source.html#l00023">addServiceWorker()</a>, <a class="el" href="Service_8cpp_source.html#l00029">clearServiceWorkers()</a>, and <a class="el" href="Service_8h_source.html#l00155">getServiceWorkers()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/lib/services/<a class="el" href="Service_8h_source.html">Service.h</a></li>
<li>proxygen/lib/services/<a class="el" href="Service_8cpp_source.html">Service.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceproxygen.html">proxygen</a></li><li class="navelem"><a class="el" href="classproxygen_1_1Service.html">Service</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
