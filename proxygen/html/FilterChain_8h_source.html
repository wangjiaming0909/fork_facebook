<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: proxygen/lib/utils/FilterChain.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('FilterChain_8h_source.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">FilterChain.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="FilterChain_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  Copyright (c) 2015-present, Facebook, Inc.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  All rights reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  This source code is licensed under the BSD-style license found in the</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  LICENSE file in the root directory of this source tree. An additional grant</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  of patent rights can be found in the PATENTS file in the same directory.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#pragma once</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;folly/Memory.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;folly/Function.h&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;glog/logging.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceproxygen.html">proxygen</a> {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, void (T1::*set_callback)(T2*),</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;          <span class="keywordtype">bool</span> TakeOwnership, <span class="keyword">typename</span> Dp = std::default_delete&lt;T1&gt; &gt;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html">   40</a></span>&#160;<span class="keyword">class</span> <a class="code" href="classproxygen_1_1GenericFilter.html">GenericFilter</a>: <span class="keyword">public</span> T1, <span class="keyword">public</span> T2 {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a389d3bbe1cc982d293812386191da67e">   42</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a> = <a class="code" href="classproxygen_1_1GenericFilter.html">GenericFilter&lt;T1, T2, set_callback, TakeOwnership, Dp&gt;</a>;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a84f317808c140aee6e5c61cd08cc2462">   49</a></span>&#160;  <a class="code" href="classproxygen_1_1GenericFilter.html#a84f317808c140aee6e5c61cd08cc2462">GenericFilter</a>(<span class="keywordtype">bool</span> calls, <span class="keywordtype">bool</span> callbacks):</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      kWantsCalls_(calls),</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      kWantsCallbacks_(callbacks) {}</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#ac735a06aa304a9af961cde1fed669d9e">   53</a></span>&#160;  <a class="code" href="classproxygen_1_1GenericFilter.html#ac735a06aa304a9af961cde1fed669d9e">~GenericFilter</a>()<span class="keyword"> override </span>{</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (TakeOwnership) {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      callbackSource_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// For the last filter in the chain, next_ is null, and call_ points</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// to the concrete implementation object.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">auto</span> next = next_ ? next_ : call_;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    drop();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (TakeOwnership &amp;&amp; next) {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      Dp()(next);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a5ace1a9c6b836f9c47e9a5ffcda41d1d">   69</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1GenericFilter.html#a5ace1a9c6b836f9c47e9a5ffcda41d1d">append</a>(<a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a>* nextFilter) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a3c357bc09758a6b0f091ceb059cf3dcc">next_</a> = next_;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a7754951315e1d98be092785991500685">prev_</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a> = call_;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a220493bfd47fb9557b93c5ce9389adc7">callback_</a> = kWantsCallbacks_ ? <span class="keyword">this</span> : callback_;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#ab7c3f69b09585ac6b25ad3a4515d1bef">callSource_</a> = kWantsCalls_ ? <span class="keyword">this</span> : callSource_;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a2fb8d99f9d9e9d0ed2e8722edba98285">callbackSource_</a> = callbackSource_;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> (next_) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      next_-&gt;prev_ = nextFilter;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span> (nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#ab0bcf0b3db5befb74a31a255f0ed78a3">kWantsCalls_</a>) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">if</span> (kWantsCalls_) {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        call_ = nextFilter;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        callSource_-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a> = nextFilter;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">if</span> (next_) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        next_-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#ab7c3f69b09585ac6b25ad3a4515d1bef">callSource_</a> = nextFilter;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> (nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a6c3532dbdc77a23c87ea57618f398130">kWantsCallbacks_</a>) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="comment">// Find the first filter before this one that wants callbacks</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keyword">auto</span> cur = <span class="keyword">this</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">while</span> (cur-&gt;prev_ &amp;&amp; !cur-&gt;kWantsCallbacks_) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        cur = cur-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a7754951315e1d98be092785991500685">prev_</a>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      cur-&gt;callbackSource_ = nextFilter;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="comment">// Make sure nextFilter gets callbacks</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      ((nextFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a2fb8d99f9d9e9d0ed2e8722edba98285">callbackSource_</a>)-&gt;*(set_callback))(nextFilter);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    next_ = nextFilter;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#ab0bcf0b3db5befb74a31a255f0ed78a3">  103</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classproxygen_1_1GenericFilter.html#ab0bcf0b3db5befb74a31a255f0ed78a3">kWantsCalls_</a>;</div><div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a6c3532dbdc77a23c87ea57618f398130">  104</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classproxygen_1_1GenericFilter.html#a6c3532dbdc77a23c87ea57618f398130">kWantsCallbacks_</a>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; <span class="keyword">protected</span>:</div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a5ffa361695d72c2d93ccd762d1a072c7">  111</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1GenericFilter.html#a5ffa361695d72c2d93ccd762d1a072c7">setCallbackInternal</a>(T2* cb) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    setCallbackInternalImpl(cb, <span class="keyword">this</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a58cd678895ea4703cc87cded78e9d4c6">  119</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1GenericFilter.html#a58cd678895ea4703cc87cded78e9d4c6">drop</a>() {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (prev_) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      prev_-&gt;next_ = next_;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">if</span> (next_) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      next_-&gt;prev_ = prev_;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// TODO: could call fn gated by std::enable_if</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span> (kWantsCalls_ &amp;&amp; callSource_) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      callSource_-&gt;call_ = call_;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (call_) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keyword">auto</span> callFilter = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a>*<span class="keyword">&gt;</span>(call_);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (callFilter) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          callFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#ab7c3f69b09585ac6b25ad3a4515d1bef">callSource_</a> = callSource_;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// TODO: could call fn gated by std::enable_if</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (kWantsCallbacks_ &amp;&amp; callbackSource_) {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      ((callbackSource_)-&gt;*(set_callback))(callback_);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">if</span> (callback_) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keyword">auto</span> callbackFilter = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a>*<span class="keyword">&gt;</span>(callback_);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> (callbackFilter) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          callbackFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a2fb8d99f9d9e9d0ed2e8722edba98285">callbackSource_</a> = callbackSource_;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    call_ = callbackSource_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    callback_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    callSource_ = next_ = prev_ = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// Next &quot;call&quot; filter (call_ == next_ iff next_-&gt;kWantsCalls_)</span></div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">  152</a></span>&#160;  T1* call_{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// Next &quot;callback&quot; filter (callback_ == prev_ iff prev_-&gt;kWantsCallbacks_)</span></div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a220493bfd47fb9557b93c5ce9389adc7">  154</a></span>&#160;  T2* callback_{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a9e1df9cbd76eed567e7103d23a108e6a">  158</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1GenericFilter.html#a9e1df9cbd76eed567e7103d23a108e6a">setCallbackInternalImpl</a>(T2* cb, T2* sourceSet) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (callback_ != cb) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      callback_ = cb;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      ((callbackSource_)-&gt;*(set_callback))(cb ? sourceSet : <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">// The next filter in the chain (towards T1 implementation)</span></div><div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a3c357bc09758a6b0f091ceb059cf3dcc">  166</a></span>&#160;  <a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a>* next_{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">// The previous filter in the chain (towards T2 implementation)</span></div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a7754951315e1d98be092785991500685">  168</a></span>&#160;  <a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a>* prev_{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// The first filter before this one in the chain that wants calls.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">// Only valid if kWantsCalls_ is true.</span></div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#ab7c3f69b09585ac6b25ad3a4515d1bef">  171</a></span>&#160;  <a class="code" href="classproxygen_1_1GenericFilter.html">Filter</a>* callSource_{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// Pointer to the first filter or object after this one in the chain</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// that makes callbacks. Only valid if kWantsCallbacks_ is true.</span></div><div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a2fb8d99f9d9e9d0ed2e8722edba98285">  174</a></span>&#160;  T1* callbackSource_{<span class="keyword">nullptr</span>};</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> A, <span class="keyword">class</span> B, <span class="keyword">class</span> F, <span class="keywordtype">void</span> (A::*fn)(B*), <span class="keywordtype">bool</span> Own&gt;</div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="classproxygen_1_1GenericFilter.html#a95c29b20c364e8ebbb6c546ecff2a6b2">  177</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classproxygen_1_1GenericFilter.html#a95c29b20c364e8ebbb6c546ecff2a6b2">FilterChain</a>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;};</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">typename</span> FilterType,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;          void (T1::*set_callback)(T2*), <span class="keywordtype">bool</span> TakeOwnership&gt;</div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html">  207</a></span>&#160;<span class="keyword">class</span> <a class="code" href="classproxygen_1_1FilterChain.html">FilterChain</a>: <span class="keyword">private</span> FilterType {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; <span class="keyword">public</span>:</div><div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a0d2436218300bf51f2bb60204c8f4c1d">  209</a></span>&#160;  <span class="keyword">explicit</span> <a class="code" href="classproxygen_1_1FilterChain.html#a0d2436218300bf51f2bb60204c8f4c1d">FilterChain</a>(std::unique_ptr&lt;T1&gt; destination):</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      FilterType(false, false) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    static_assert(TakeOwnership, <span class="stringliteral">&quot;unique_ptr constructor only available &quot;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                  <span class="stringliteral">&quot;if the chain owns the filters.&quot;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    this-&gt;call_ = CHECK_NOTNULL(destination.release());</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    this-&gt;callback_ = <span class="keyword">nullptr</span>; <span class="comment">//must call setCallback() explicitly</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    this-&gt;callSource_ = <span class="keyword">this</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    this-&gt;callbackSource_ = this-&gt;call_;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    this-&gt;chainEnd_ = this-&gt;call_;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a3cda65d09b99a401a49cef5805b4b607">  220</a></span>&#160;  <span class="keyword">explicit</span> <a class="code" href="classproxygen_1_1FilterChain.html#a3cda65d09b99a401a49cef5805b4b607">FilterChain</a>(T1* destination):</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      FilterType(false, false) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    static_assert(!TakeOwnership, <span class="stringliteral">&quot;raw pointer constructor only available &quot;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                  <span class="stringliteral">&quot;if the chain doesn&#39;t own the filters.&quot;</span>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    this-&gt;call_ = CHECK_NOTNULL(destination);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    this-&gt;callback_ = <span class="keyword">nullptr</span>; <span class="comment">//must call setCallback() explicitly</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    this-&gt;callSource_ = <span class="keyword">this</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    this-&gt;callbackSource_ = this-&gt;call_;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    this-&gt;chainEnd_ = this-&gt;call_;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a26eec92e23c4bede04208d8996cad587">  235</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1FilterChain.html#a26eec92e23c4bede04208d8996cad587">setCallback</a>(T2* cb)<span class="keyword"> override </span>{ this-&gt;setCallbackInternalImpl(cb, cb); }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a097978132f89f0d76537a83daecfa960">  242</a></span>&#160;  T1* <a class="code" href="classproxygen_1_1FilterChain.html#a097978132f89f0d76537a83daecfa960">call</a>() {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> this-&gt;call_;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a049c1ee6b75eb199d7e4f24010408e69">  245</a></span>&#160;  <span class="keyword">const</span> T1* <a class="code" href="classproxygen_1_1FilterChain.html#a049c1ee6b75eb199d7e4f24010408e69">call</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">return</span> this-&gt;call_;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a251a79f705fb5341d440765921afdce7">  252</a></span>&#160;  T1* <a class="code" href="classproxygen_1_1FilterChain.html#a251a79f705fb5341d440765921afdce7">getChainEndPtr</a>() {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">return</span> chainEnd_;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a24ef040a55410dd9a816f57cb795cb44">  255</a></span>&#160;  <span class="keyword">const</span> T1&amp; <a class="code" href="classproxygen_1_1FilterChain.html#a24ef040a55410dd9a816f57cb795cb44">getChainEnd</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> *chainEnd_;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#aaf56e3255f9f0290f5f0681f7cdf5d3e">  259</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classproxygen_1_1GenericFilter.html">FilterChainType</a> = <a class="code" href="classproxygen_1_1GenericFilter.html">GenericFilter&lt;T1, T2, set_callback, TakeOwnership&gt;</a>;</div><div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a9fb71919f20e105649530b95a3170b8f">  260</a></span>&#160;  std::unique_ptr&lt;T1&gt; <a class="code" href="classproxygen_1_1FilterChain.html#a9fb71919f20e105649530b95a3170b8f">setDestination</a>(std::unique_ptr&lt;T1&gt; destination) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    static_assert(TakeOwnership, <span class="stringliteral">&quot;unique_ptr setDestination only available &quot;</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                  <span class="stringliteral">&quot;if the chain owns the filters.&quot;</span>);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// find the last filter in the chain, and the last filter that wants calls,</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// callbacks</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="classproxygen_1_1GenericFilter.html">FilterChainType</a>* lastFilter = <span class="keyword">this</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="classproxygen_1_1GenericFilter.html">FilterChainType</a>* lastCall = <span class="keyword">this</span>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="classproxygen_1_1GenericFilter.html">FilterChainType</a>* lastCallback = <span class="keyword">this</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">while</span> (lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a3c357bc09758a6b0f091ceb059cf3dcc">next_</a>) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="keywordflow">if</span> (lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#ab0bcf0b3db5befb74a31a255f0ed78a3">kWantsCalls_</a>) {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        lastCall = lastFilter;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">if</span> (lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a6c3532dbdc77a23c87ea57618f398130">kWantsCallbacks_</a>) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        lastCallback = lastFilter;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">if</span> (lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a> == this-&gt;chainEnd_) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="comment">// Search and replace, the last N non-call filters all point to dest</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a> = destination.get();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      lastFilter = lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a3c357bc09758a6b0f091ceb059cf3dcc">next_</a>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#ab0bcf0b3db5befb74a31a255f0ed78a3">kWantsCalls_</a>) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      lastCall = lastFilter;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a6c3532dbdc77a23c87ea57618f398130">kWantsCallbacks_</a>) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      lastCallback = lastFilter;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a> = CHECK_NOTNULL(destination.release());</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    lastCall-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a> = lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    lastCallback-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a2fb8d99f9d9e9d0ed2e8722edba98285">callbackSource_</a> = lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keyword">auto</span> oldChainEnd = this-&gt;chainEnd_;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    this-&gt;chainEnd_ = lastFilter-&gt;<a class="code" href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">call_</a>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    this-&gt;chainEnd_-&gt;setCallback(lastCallback);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">return</span> std::unique_ptr&lt;T1&gt;(oldChainEnd);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> C2, <span class="keyword">typename</span>... Types&gt;</div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a156f7de0f5af0dbddfe240c12d0ef27b">  301</a></span>&#160;  <span class="keyword">typename</span> std::enable_if&lt;std::is_constructible&lt;C&gt;::value&gt;::type <a class="code" href="classproxygen_1_1FilterChain.html#a156f7de0f5af0dbddfe240c12d0ef27b">addFilters</a>() {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// Callback &lt;-&gt; F1 &lt;-&gt; F2 ... &lt;-&gt; F_new &lt;-&gt; Destination</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    this-&gt;append(<span class="keyword">new</span> C());</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    addFilters&lt;C2, Types...&gt;();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> C&gt;</div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a155a35b906e4169bf310197bbd09aaf7">  311</a></span>&#160;  <span class="keyword">typename</span> std::enable_if&lt;std::is_constructible&lt;C&gt;::value&gt;::type <a class="code" href="classproxygen_1_1FilterChain.html#a155a35b906e4169bf310197bbd09aaf7">addFilters</a>() {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    this-&gt;append(<span class="keyword">new</span> C());</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span>... Types&gt;</div><div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a9df273029c67b0a5805fb63f358a6877">  320</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1FilterChain.html#a9df273029c67b0a5805fb63f358a6877">addFilters</a>(std::unique_ptr&lt;C&gt; cur, Types&amp;&amp;... remaining) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    static_assert(TakeOwnership, <span class="stringliteral">&quot;addFilters() can only take &quot;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                  <span class="stringliteral">&quot;unique_ptr if the chain owns the filters&quot;</span>);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    this-&gt;append(cur.release());</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    addFilters(std::forward&lt;Types&gt;(remaining)...);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span>... Types&gt;</div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a79be8bc52c2f2541560d397ec627937b">  328</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1FilterChain.html#a79be8bc52c2f2541560d397ec627937b">addFilters</a>(C* cur, Types&amp;&amp;... remaining) {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    static_assert(!TakeOwnership, <span class="stringliteral">&quot;addFilters() can only take &quot;</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                  <span class="stringliteral">&quot;pointers if the chain doesn&#39;t own the filters&quot;</span>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    this-&gt;append(cur);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    addFilters(std::forward&lt;Types&gt;(remaining)...);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span>... Args&gt;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <a class="code" href="classproxygen_1_1FilterChain.html">FilterChain&lt;T1, T2, FilterType, set_callback, TakeOwnership&gt;</a>&amp;</div><div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a5c9a247735bddd41eff4c2795e889fc3">  341</a></span>&#160;  <a class="code" href="classproxygen_1_1FilterChain.html#a5c9a247735bddd41eff4c2795e889fc3">add</a>(Args&amp;&amp;... args) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    this-&gt;append(<span class="keyword">new</span> C(std::forward&lt;Args&gt;(args)...));</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a840801ed50699b36795986469a063d4f">  346</a></span>&#160;  <span class="keyword">const</span> T1* <a class="code" href="classproxygen_1_1FilterChain.html#a840801ed50699b36795986469a063d4f">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> call(); }</div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a97e45693befbef8b771d8cc5be1ef80c">  347</a></span>&#160;  T1* <a class="code" href="classproxygen_1_1FilterChain.html#a97e45693befbef8b771d8cc5be1ef80c">operator-&gt;</a>() { <span class="keywordflow">return</span> call(); }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#ac59776e8ac9688af120db07adcd87702">  349</a></span>&#160;  <span class="keywordtype">void</span> <span class="keywordflow">foreach</span>(folly::FunctionRef&lt;<span class="keywordtype">void</span>(<a class="code" href="classproxygen_1_1GenericFilter.html">FilterChainType</a>*)&gt; fn) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keyword">auto</span> cur = this-&gt;next_;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">while</span> (cur) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keyword">auto</span> filter = cur;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      cur = cur-&gt;next_;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      fn(filter);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; <span class="keyword">private</span>:</div><div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a2c53b086f7f708560bd9c4f08eacbc26">  364</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproxygen_1_1FilterChain.html#a2c53b086f7f708560bd9c4f08eacbc26">addFilters</a>() {}</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="classproxygen_1_1FilterChain.html#a679fffcc67e45ba02163e29a5d95a422">  366</a></span>&#160;  T1* <a class="code" href="classproxygen_1_1FilterChain.html#a679fffcc67e45ba02163e29a5d95a422">chainEnd_</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;};</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;}</div><div class="ttc" id="classproxygen_1_1GenericFilter_html_a9e1df9cbd76eed567e7103d23a108e6a"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a9e1df9cbd76eed567e7103d23a108e6a">proxygen::GenericFilter::setCallbackInternalImpl</a></div><div class="ttdeci">void setCallbackInternalImpl(T2 *cb, T2 *sourceSet)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00158">FilterChain.h:158</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a220493bfd47fb9557b93c5ce9389adc7"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a220493bfd47fb9557b93c5ce9389adc7">proxygen::GenericFilter::callback_</a></div><div class="ttdeci">T2 * callback_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00154">FilterChain.h:154</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a5ace1a9c6b836f9c47e9a5ffcda41d1d"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a5ace1a9c6b836f9c47e9a5ffcda41d1d">proxygen::GenericFilter::append</a></div><div class="ttdeci">void append(Filter *nextFilter)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00069">FilterChain.h:69</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a3c357bc09758a6b0f091ceb059cf3dcc"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a3c357bc09758a6b0f091ceb059cf3dcc">proxygen::GenericFilter::next_</a></div><div class="ttdeci">Filter * next_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00166">FilterChain.h:166</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_ab7c3f69b09585ac6b25ad3a4515d1bef"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#ab7c3f69b09585ac6b25ad3a4515d1bef">proxygen::GenericFilter::callSource_</a></div><div class="ttdeci">Filter * callSource_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00171">FilterChain.h:171</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a24ef040a55410dd9a816f57cb795cb44"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a24ef040a55410dd9a816f57cb795cb44">proxygen::FilterChain::getChainEnd</a></div><div class="ttdeci">const T1 &amp; getChainEnd() const </div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00255">FilterChain.h:255</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a2fb8d99f9d9e9d0ed2e8722edba98285"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a2fb8d99f9d9e9d0ed2e8722edba98285">proxygen::GenericFilter::callbackSource_</a></div><div class="ttdeci">T1 * callbackSource_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00174">FilterChain.h:174</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a840801ed50699b36795986469a063d4f"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a840801ed50699b36795986469a063d4f">proxygen::FilterChain::operator-&gt;</a></div><div class="ttdeci">const T1 * operator-&gt;() const </div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00346">FilterChain.h:346</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a156f7de0f5af0dbddfe240c12d0ef27b"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a156f7de0f5af0dbddfe240c12d0ef27b">proxygen::FilterChain::addFilters</a></div><div class="ttdeci">std::enable_if&lt; std::is_constructible&lt; C &gt;::value &gt;::type addFilters()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00301">FilterChain.h:301</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a097978132f89f0d76537a83daecfa960"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a097978132f89f0d76537a83daecfa960">proxygen::FilterChain::call</a></div><div class="ttdeci">T1 * call()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00242">FilterChain.h:242</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a251a79f705fb5341d440765921afdce7"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a251a79f705fb5341d440765921afdce7">proxygen::FilterChain::getChainEndPtr</a></div><div class="ttdeci">T1 * getChainEndPtr()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00252">FilterChain.h:252</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a79be8bc52c2f2541560d397ec627937b"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a79be8bc52c2f2541560d397ec627937b">proxygen::FilterChain::addFilters</a></div><div class="ttdeci">void addFilters(C *cur, Types &amp;&amp;...remaining)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00328">FilterChain.h:328</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a5aa6e457a5679089f5ae167d87e64cc9"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a5aa6e457a5679089f5ae167d87e64cc9">proxygen::GenericFilter::call_</a></div><div class="ttdeci">T1 * call_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00152">FilterChain.h:152</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a5c9a247735bddd41eff4c2795e889fc3"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a5c9a247735bddd41eff4c2795e889fc3">proxygen::FilterChain::add</a></div><div class="ttdeci">FilterChain&lt; T1, T2, FilterType, set_callback, TakeOwnership &gt; &amp; add(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00341">FilterChain.h:341</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a049c1ee6b75eb199d7e4f24010408e69"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a049c1ee6b75eb199d7e4f24010408e69">proxygen::FilterChain::call</a></div><div class="ttdeci">const T1 * call() const </div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00245">FilterChain.h:245</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a5ffa361695d72c2d93ccd762d1a072c7"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a5ffa361695d72c2d93ccd762d1a072c7">proxygen::GenericFilter::setCallbackInternal</a></div><div class="ttdeci">void setCallbackInternal(T2 *cb)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00111">FilterChain.h:111</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a95c29b20c364e8ebbb6c546ecff2a6b2"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a95c29b20c364e8ebbb6c546ecff2a6b2">proxygen::GenericFilter::FilterChain</a></div><div class="ttdeci">friend class FilterChain</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00177">FilterChain.h:177</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a679fffcc67e45ba02163e29a5d95a422"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a679fffcc67e45ba02163e29a5d95a422">proxygen::FilterChain::chainEnd_</a></div><div class="ttdeci">T1 * chainEnd_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00366">FilterChain.h:366</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_ab0bcf0b3db5befb74a31a255f0ed78a3"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#ab0bcf0b3db5befb74a31a255f0ed78a3">proxygen::GenericFilter::kWantsCalls_</a></div><div class="ttdeci">const bool kWantsCalls_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00103">FilterChain.h:103</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a6c3532dbdc77a23c87ea57618f398130"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a6c3532dbdc77a23c87ea57618f398130">proxygen::GenericFilter::kWantsCallbacks_</a></div><div class="ttdeci">const bool kWantsCallbacks_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00104">FilterChain.h:104</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a84f317808c140aee6e5c61cd08cc2462"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a84f317808c140aee6e5c61cd08cc2462">proxygen::GenericFilter::GenericFilter</a></div><div class="ttdeci">GenericFilter(bool calls, bool callbacks)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00049">FilterChain.h:49</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a26eec92e23c4bede04208d8996cad587"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a26eec92e23c4bede04208d8996cad587">proxygen::FilterChain::setCallback</a></div><div class="ttdeci">void setCallback(T2 *cb) override</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00235">FilterChain.h:235</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a155a35b906e4169bf310197bbd09aaf7"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a155a35b906e4169bf310197bbd09aaf7">proxygen::FilterChain::addFilters</a></div><div class="ttdeci">std::enable_if&lt; std::is_constructible&lt; C &gt;::value &gt;::type addFilters()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00311">FilterChain.h:311</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a9fb71919f20e105649530b95a3170b8f"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a9fb71919f20e105649530b95a3170b8f">proxygen::FilterChain::setDestination</a></div><div class="ttdeci">std::unique_ptr&lt; T1 &gt; setDestination(std::unique_ptr&lt; T1 &gt; destination)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00260">FilterChain.h:260</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html"><div class="ttname"><a href="classproxygen_1_1FilterChain.html">proxygen::FilterChain</a></div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00207">FilterChain.h:207</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a0d2436218300bf51f2bb60204c8f4c1d"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a0d2436218300bf51f2bb60204c8f4c1d">proxygen::FilterChain::FilterChain</a></div><div class="ttdeci">FilterChain(std::unique_ptr&lt; T1 &gt; destination)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00209">FilterChain.h:209</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html">proxygen::GenericFilter</a></div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00040">FilterChain.h:40</a></div></div>
<div class="ttc" id="namespaceproxygen_html"><div class="ttname"><a href="namespaceproxygen.html">proxygen</a></div><div class="ttdef"><b>Definition:</b> <a href="ExMessageHandler_8h_source.html#l00014">ExMessageHandler.h:14</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a9df273029c67b0a5805fb63f358a6877"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a9df273029c67b0a5805fb63f358a6877">proxygen::FilterChain::addFilters</a></div><div class="ttdeci">void addFilters(std::unique_ptr&lt; C &gt; cur, Types &amp;&amp;...remaining)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00320">FilterChain.h:320</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a97e45693befbef8b771d8cc5be1ef80c"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a97e45693befbef8b771d8cc5be1ef80c">proxygen::FilterChain::operator-&gt;</a></div><div class="ttdeci">T1 * operator-&gt;()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00347">FilterChain.h:347</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a3cda65d09b99a401a49cef5805b4b607"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a3cda65d09b99a401a49cef5805b4b607">proxygen::FilterChain::FilterChain</a></div><div class="ttdeci">FilterChain(T1 *destination)</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00220">FilterChain.h:220</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a58cd678895ea4703cc87cded78e9d4c6"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a58cd678895ea4703cc87cded78e9d4c6">proxygen::GenericFilter::drop</a></div><div class="ttdeci">void drop()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00119">FilterChain.h:119</a></div></div>
<div class="ttc" id="classproxygen_1_1FilterChain_html_a2c53b086f7f708560bd9c4f08eacbc26"><div class="ttname"><a href="classproxygen_1_1FilterChain.html#a2c53b086f7f708560bd9c4f08eacbc26">proxygen::FilterChain::addFilters</a></div><div class="ttdeci">void addFilters()</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00364">FilterChain.h:364</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_ac735a06aa304a9af961cde1fed669d9e"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#ac735a06aa304a9af961cde1fed669d9e">proxygen::GenericFilter::~GenericFilter</a></div><div class="ttdeci">~GenericFilter() override</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00053">FilterChain.h:53</a></div></div>
<div class="ttc" id="classproxygen_1_1GenericFilter_html_a7754951315e1d98be092785991500685"><div class="ttname"><a href="classproxygen_1_1GenericFilter.html#a7754951315e1d98be092785991500685">proxygen::GenericFilter::prev_</a></div><div class="ttdeci">Filter * prev_</div><div class="ttdef"><b>Definition:</b> <a href="FilterChain_8h_source.html#l00168">FilterChain.h:168</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d333e33cf903653326082c1f32e03be5.html">proxygen</a></li><li class="navelem"><a class="el" href="dir_baa8b6fadb61b56c035914fe171fd962.html">lib</a></li><li class="navelem"><a class="el" href="dir_736717bac64c903277b300e102617b7e.html">utils</a></li><li class="navelem"><a class="el" href="FilterChain_8h.html">FilterChain.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
