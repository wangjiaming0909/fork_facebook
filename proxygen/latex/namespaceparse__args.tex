\section{parse\+\_\+args Namespace Reference}
\label{namespaceparse__args}\index{parse\+\_\+args@{parse\+\_\+args}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def {\bf parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts} (add\+\_\+args\+\_\+fn, top\+\_\+level\+\_\+opts, opts, help)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{parse\+\_\+args@{parse\+\_\+args}!parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts@{parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts}}
\index{parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts@{parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts}!parse\+\_\+args@{parse\+\_\+args}}
\subsubsection[{parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts(add\+\_\+args\+\_\+fn, top\+\_\+level\+\_\+opts, opts, help)}]{\setlength{\rightskip}{0pt plus 5cm}def parse\+\_\+args.\+parse\+\_\+args\+\_\+to\+\_\+fbcode\+\_\+builder\+\_\+opts (
\begin{DoxyParamCaption}
\item[{}]{add\+\_\+args\+\_\+fn, }
\item[{}]{top\+\_\+level\+\_\+opts, }
\item[{}]{opts, }
\item[{}]{help}
\end{DoxyParamCaption}
)}\label{namespaceparse__args_a8651aee0801ed87d22c54dccc639886b}
\begin{DoxyVerb}Provides some standard arguments: --debug, --option, --shell-quoted-option

Then, calls `add_args_fn(parser)` to add application-specific arguments.

`opts` are first used as defaults for the various command-line
arguments.  Then, the parsed arguments are mapped back into `opts`,
which then become the values for `FBCodeBuilder.option()`, to be used
both by the builder and by `get_steps_fn()`.

`help` is printed in response to the `--help` argument.\end{DoxyVerb}
 

Definition at line 15 of file parse\+\_\+args.\+py.



References shell\+\_\+quoting.\+raw\+\_\+shell().



Referenced by make\+\_\+docker\+\_\+context.\+make\+\_\+docker\+\_\+context().


\begin{DoxyCode}
15 \textcolor{keyword}{def }parse_args_to_fbcode_builder_opts(add\_args\_fn, top\_level\_opts, opts, help):
16     \textcolor{stringliteral}{'''}
17 \textcolor{stringliteral}{}
18 \textcolor{stringliteral}{    Provides some standard arguments: --debug, --option, --shell-quoted-option}
19 \textcolor{stringliteral}{}
20 \textcolor{stringliteral}{    Then, calls `add\_args\_fn(parser)` to add application-specific arguments.}
21 \textcolor{stringliteral}{}
22 \textcolor{stringliteral}{    `opts` are first used as defaults for the various command-line}
23 \textcolor{stringliteral}{    arguments.  Then, the parsed arguments are mapped back into `opts`,}
24 \textcolor{stringliteral}{    which then become the values for `FBCodeBuilder.option()`, to be used}
25 \textcolor{stringliteral}{    both by the builder and by `get\_steps\_fn()`.}
26 \textcolor{stringliteral}{}
27 \textcolor{stringliteral}{    `help` is printed in response to the `--help` argument.}
28 \textcolor{stringliteral}{}
29 \textcolor{stringliteral}{    '''}
30     top\_level\_opts = set(top\_level\_opts)
31 
32     parser = argparse.ArgumentParser(
33         description=help,
34         formatter\_class=argparse.RawDescriptionHelpFormatter
35     )
36 
37     add\_args\_fn(parser)
38 
39     parser.add\_argument(
40         \textcolor{stringliteral}{'--option'}, nargs=2, metavar=(\textcolor{stringliteral}{'KEY'}, \textcolor{stringliteral}{'VALUE'}), action=\textcolor{stringliteral}{'append'},
41         default=[
42             (k, v) \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} opts.items()
43                 \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} top\_level\_opts \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} isinstance(v, ShellQuoted)
44         ],
45         help=\textcolor{stringliteral}{'Set project-specific options. These are assumed to be raw '}
46             \textcolor{stringliteral}{'strings, to be shell-escaped as needed. Default: %(default)s.'},
47     )
48     parser.add\_argument(
49         \textcolor{stringliteral}{'--shell-quoted-option'}, nargs=2, metavar=(\textcolor{stringliteral}{'KEY'}, \textcolor{stringliteral}{'VALUE'}),
50         action=\textcolor{stringliteral}{'append'},
51         default=[
52             (k, raw_shell(v)) \textcolor{keywordflow}{for} k, v \textcolor{keywordflow}{in} opts.items()
53                 \textcolor{keywordflow}{if} k \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} top\_level\_opts \textcolor{keywordflow}{and} isinstance(v, ShellQuoted)
54         ],
55         help=\textcolor{stringliteral}{'Set project-specific options. These are assumed to be shell-'}
56             \textcolor{stringliteral}{'quoted, and may be used in commands as-is. Default: %(default)s.'},
57     )
58 
59     parser.add\_argument(\textcolor{stringliteral}{'--debug'}, action=\textcolor{stringliteral}{'store\_true'}, help=\textcolor{stringliteral}{'Log more'})
60     args = parser.parse\_args()
61 
62     logging.basicConfig(
63         level=logging.DEBUG \textcolor{keywordflow}{if} args.debug \textcolor{keywordflow}{else} logging.INFO,
64         format=\textcolor{stringliteral}{'%(levelname)s: %(message)s'}
65     )
66 
67     \textcolor{comment}{# Map command-line args back into opts.}
68     logging.debug(\textcolor{stringliteral}{'opts before command-line arguments: \{0\}'}.format(opts))
69 
70     new\_opts = \{\}
71     \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} top\_level\_opts:
72         val = getattr(args, key)
73         \textcolor{comment}{# Allow clients to unset a default by passing a value of None in opts}
74         \textcolor{keywordflow}{if} val \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
75             new\_opts[key] = val
76     \textcolor{keywordflow}{for} key, val \textcolor{keywordflow}{in} args.option:
77         new\_opts[key] = val
78     \textcolor{keywordflow}{for} key, val \textcolor{keywordflow}{in} args.shell\_quoted\_option:
79         new\_opts[key] = ShellQuoted(val)
80 
81     logging.debug(\textcolor{stringliteral}{'opts after command-line arguments: \{0\}'}.format(new\_opts))
82 
83     \textcolor{keywordflow}{return} new\_opts
84 \end{DoxyCode}
