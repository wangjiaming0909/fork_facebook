\section{proxygen\+:\+:Zstd\+Stream\+Decompressor Class Reference}
\label{classproxygen_1_1ZstdStreamDecompressor}\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}


{\ttfamily \#include $<$Zstd\+Stream\+Decompressor.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf Zstd\+Stream\+Decompressor} (size\+\_\+t, std\+::string)
\item 
{\bf $\sim$\+Zstd\+Stream\+Decompressor} ()
\item 
std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ {\bf decompress} (const folly\+::\+I\+O\+Buf $\ast$in)
\item 
{\bf Zstd\+Status\+Type} {\bf get\+Status} ()
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
{\bf Zstd\+Status\+Type} {\bf status\+\_\+}
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
Z\+S\+T\+D\+\_\+\+D\+Stream $\ast$ {\bf d\+Stream\+\_\+} \{{\bf nullptr}\}
\item 
Z\+S\+T\+D\+\_\+\+D\+Dict $\ast$ {\bf d\+Dict\+\_\+} \{{\bf nullptr}\}
\item 
size\+\_\+t {\bf total\+Len\+\_\+} \{0\}
\item 
size\+\_\+t {\bf total\+Dec\+\_\+} \{0\}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 37 of file Zstd\+Stream\+Decompressor.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!Zstd\+Stream\+Decompressor@{Zstd\+Stream\+Decompressor}}
\index{Zstd\+Stream\+Decompressor@{Zstd\+Stream\+Decompressor}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{Zstd\+Stream\+Decompressor(size\+\_\+t, std\+::string)}]{\setlength{\rightskip}{0pt plus 5cm}Zstd\+Stream\+Decompressor\+::\+Zstd\+Stream\+Decompressor (
\begin{DoxyParamCaption}
\item[{size\+\_\+t}]{total\+Len, }
\item[{std\+::string}]{dict\+Str}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [explicit]}}\label{classproxygen_1_1ZstdStreamDecompressor_ab96ce5474b4e4eded3c579acc63748ad}


Definition at line 21 of file Zstd\+Stream\+Decompressor.\+cpp.



References d\+Dict\+\_\+, d\+Stream\+\_\+, proxygen\+::\+E\+R\+R\+OR, and status\+\_\+.


\begin{DoxyCode}
22   : totalLen_(totalLen) \{
23   dStream_ = ZSTD\_createDStream();
24   \textcolor{keywordflow}{if} (dictStr != \textcolor{stringliteral}{""}) \{
25     dDict_ = ZSTD\_createDDict(&dictStr, dictStr.length());
26     \textcolor{keywordflow}{if} (dStream_ == \textcolor{keyword}{nullptr} || dDict_ == \textcolor{keyword}{nullptr} ||
27         ZSTD\_isError(ZSTD\_initDStream\_usingDDict(dStream_, dDict_))) \{
28       status_ = ZstdStatusType::ERROR;
29     \}
30   \} \textcolor{keywordflow}{else} \{
31     \textcolor{keywordflow}{if} (dStream_ == \textcolor{keyword}{nullptr} ||
32         ZSTD\_isError(ZSTD\_initDStream(dStream_))) \{
33       status_ = ZstdStatusType::ERROR;
34     \}
35   \}
36 \}
\end{DoxyCode}
\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!````~Zstd\+Stream\+Decompressor@{$\sim$\+Zstd\+Stream\+Decompressor}}
\index{````~Zstd\+Stream\+Decompressor@{$\sim$\+Zstd\+Stream\+Decompressor}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{$\sim$\+Zstd\+Stream\+Decompressor()}]{\setlength{\rightskip}{0pt plus 5cm}Zstd\+Stream\+Decompressor\+::$\sim$\+Zstd\+Stream\+Decompressor (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classproxygen_1_1ZstdStreamDecompressor_a313f2f0a21914cf68204a3da1c0292e1}


Definition at line 38 of file Zstd\+Stream\+Decompressor.\+cpp.



References d\+Dict\+\_\+, and d\+Stream\+\_\+.


\begin{DoxyCode}
38                                                 \{
39   \textcolor{keywordflow}{if} (dStream_) \{
40     ZSTD\_freeDStream(dStream_);
41   \}
42   \textcolor{keywordflow}{if} (dDict_) \{
43     ZSTD\_freeDDict(dDict_);
44   \}
45 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!decompress@{decompress}}
\index{decompress@{decompress}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{decompress(const folly\+::\+I\+O\+Buf $\ast$in)}]{\setlength{\rightskip}{0pt plus 5cm}std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ Zstd\+Stream\+Decompressor\+::decompress (
\begin{DoxyParamCaption}
\item[{const folly\+::\+I\+O\+Buf $\ast$}]{in}
\end{DoxyParamCaption}
)}\label{classproxygen_1_1ZstdStreamDecompressor_a219969f9565f22d7754b47a035aed6eb}


Definition at line 47 of file Zstd\+Stream\+Decompressor.\+cpp.



References proxygen\+::\+C\+O\+N\+T\+I\+N\+UE, d\+Stream\+\_\+, proxygen\+::\+E\+R\+R\+OR, status\+\_\+, proxygen\+::\+S\+U\+C\+C\+E\+SS, total\+Dec\+\_\+, and total\+Len\+\_\+.


\begin{DoxyCode}
48                         \{
49   \textcolor{keywordflow}{if} (dStream_ == \textcolor{keyword}{nullptr}) \{
50     status_ = ZstdStatusType::ERROR;
51     \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
52   \}
53 
54   \textcolor{keyword}{auto} out = folly::IOBuf::create(ZSTD\_DStreamOutSize());
55 
56   \textcolor{keywordtype}{size\_t} buffOutSize = ZSTD\_DStreamOutSize();
57   std::unique\_ptr<unsigned char[]> buffOut(\textcolor{keyword}{new} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}[buffOutSize]);
58   \textcolor{keyword}{auto} appender = folly::io::Appender(out.get(), buffOutSize);
59 
60   \textcolor{keywordflow}{for} (\textcolor{keyword}{const} folly::ByteRange range : *in) \{
61     ZSTD\_inBuffer input = \{range.data(), range.size(), 0\};
62     \textcolor{keywordflow}{while} (input.pos < input.size) \{
63       ZSTD\_outBuffer output = \{buffOut.get(), buffOutSize, 0\};
64       \textcolor{keywordtype}{size\_t} toRead = ZSTD\_decompressStream(dStream_, &output, &input);
65 
66       \textcolor{keywordflow}{if} (ZSTD\_isError(toRead)) \{
67         status_ = ZstdStatusType::ERROR;
68         \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
69       \}
70 
71       \textcolor{keywordflow}{if} (toRead == 0) \{
72         ZSTD\_resetDStream(dStream_);
73       \}
74 
75       \textcolor{keywordflow}{if} (output.pos > 0) \{
76         \textcolor{keywordtype}{size\_t} copied =
77           appender.pushAtMost((\textcolor{keyword}{const} uint8\_t*)output.dst, output.pos);
78         CHECK(copied == output.pos);
79       \}
80       totalDec_ += input.size;
81 
82       \textcolor{keywordflow}{if} (totalDec_ < totalLen_) \{
83         status_ = ZstdStatusType::CONTINUE;
84       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (totalDec_ > totalLen_) \{
85         status_ = ZstdStatusType::ERROR;
86       \} \textcolor{keywordflow}{else} \{
87         status_ = ZstdStatusType::SUCCESS;
88       \}
89     \}
90   \}
91 
92   \textcolor{keywordflow}{return} out;
93 \}
\end{DoxyCode}
\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!get\+Status@{get\+Status}}
\index{get\+Status@{get\+Status}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{get\+Status()}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Zstd\+Status\+Type} proxygen\+::\+Zstd\+Stream\+Decompressor\+::get\+Status (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1ZstdStreamDecompressor_ab3860c617e84000bdf221c2b04e45c63}


Definition at line 42 of file Zstd\+Stream\+Decompressor.\+h.


\begin{DoxyCode}
42 \{\textcolor{keywordflow}{return} status_;\};
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!d\+Dict\+\_\+@{d\+Dict\+\_\+}}
\index{d\+Dict\+\_\+@{d\+Dict\+\_\+}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{d\+Dict\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}Z\+S\+T\+D\+\_\+\+D\+Dict$\ast$ proxygen\+::\+Zstd\+Stream\+Decompressor\+::d\+Dict\+\_\+ \{{\bf nullptr}\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1ZstdStreamDecompressor_ad6a965344a4532209076e7afe7350b89}


Definition at line 47 of file Zstd\+Stream\+Decompressor.\+h.



Referenced by Zstd\+Stream\+Decompressor(), and $\sim$\+Zstd\+Stream\+Decompressor().

\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!d\+Stream\+\_\+@{d\+Stream\+\_\+}}
\index{d\+Stream\+\_\+@{d\+Stream\+\_\+}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{d\+Stream\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}Z\+S\+T\+D\+\_\+\+D\+Stream$\ast$ proxygen\+::\+Zstd\+Stream\+Decompressor\+::d\+Stream\+\_\+ \{{\bf nullptr}\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1ZstdStreamDecompressor_a42341a33c0ebfd77cae05ba8071af2f8}


Definition at line 46 of file Zstd\+Stream\+Decompressor.\+h.



Referenced by decompress(), Zstd\+Stream\+Decompressor(), and $\sim$\+Zstd\+Stream\+Decompressor().

\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!status\+\_\+@{status\+\_\+}}
\index{status\+\_\+@{status\+\_\+}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{status\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Zstd\+Status\+Type} proxygen\+::\+Zstd\+Stream\+Decompressor\+::status\+\_\+}\label{classproxygen_1_1ZstdStreamDecompressor_ae79e9f83ea960ab40b9c3fd6e010c4ac}


Definition at line 42 of file Zstd\+Stream\+Decompressor.\+h.



Referenced by decompress(), and Zstd\+Stream\+Decompressor().

\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!total\+Dec\+\_\+@{total\+Dec\+\_\+}}
\index{total\+Dec\+\_\+@{total\+Dec\+\_\+}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{total\+Dec\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t proxygen\+::\+Zstd\+Stream\+Decompressor\+::total\+Dec\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1ZstdStreamDecompressor_a9c627453c1a56fec4572094af9f9fb61}


Definition at line 49 of file Zstd\+Stream\+Decompressor.\+h.



Referenced by decompress().

\index{proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}!total\+Len\+\_\+@{total\+Len\+\_\+}}
\index{total\+Len\+\_\+@{total\+Len\+\_\+}!proxygen\+::\+Zstd\+Stream\+Decompressor@{proxygen\+::\+Zstd\+Stream\+Decompressor}}
\subsubsection[{total\+Len\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t proxygen\+::\+Zstd\+Stream\+Decompressor\+::total\+Len\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1ZstdStreamDecompressor_a0c4b8e7e8e16e85bc568b0de2fcdfbe8}


Definition at line 48 of file Zstd\+Stream\+Decompressor.\+h.



Referenced by decompress().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
proxygen/lib/utils/{\bf Zstd\+Stream\+Decompressor.\+h}\item 
proxygen/lib/utils/{\bf Zstd\+Stream\+Decompressor.\+cpp}\end{DoxyCompactItemize}
