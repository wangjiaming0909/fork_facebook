\section{proxygen/httpserver/tests/\+Request\+Handler\+Adaptor\+Test.cpp File Reference}
\label{RequestHandlerAdaptorTest_8cpp}\index{proxygen/httpserver/tests/\+Request\+Handler\+Adaptor\+Test.\+cpp@{proxygen/httpserver/tests/\+Request\+Handler\+Adaptor\+Test.\+cpp}}
{\ttfamily \#include $<$folly/portability/\+G\+Test.\+h$>$}\\*
{\ttfamily \#include $<$folly/portability/\+G\+Mock.\+h$>$}\\*
{\ttfamily \#include \char`\"{}proxygen/httpserver/\+Mocks.\+h\char`\"{}}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+Request\+Handler\+Adaptor.\+h$>$}\\*
{\ttfamily \#include \char`\"{}proxygen/lib/http/session/test/\+H\+T\+T\+P\+Transaction\+Mocks.\+h\char`\"{}}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct {\bf Stub\+Request\+Handler\+Adaptor}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void {\bf test\+Expect\+Handling} (bool handler\+Responds)
\item 
{\bf T\+E\+ST} (Request\+Handler\+Adaptor\+Test, Expect)
\item 
{\bf T\+E\+ST} (Request\+Handler\+Adaptor\+Test, on\+Error)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{Request\+Handler\+Adaptor\+Test.\+cpp@{Request\+Handler\+Adaptor\+Test.\+cpp}!T\+E\+ST@{T\+E\+ST}}
\index{T\+E\+ST@{T\+E\+ST}!Request\+Handler\+Adaptor\+Test.\+cpp@{Request\+Handler\+Adaptor\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T(\+Request\+Handler\+Adaptor\+Test, Expect)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+ST (
\begin{DoxyParamCaption}
\item[{Request\+Handler\+Adaptor\+Test}]{, }
\item[{Expect}]{}
\end{DoxyParamCaption}
)}\label{RequestHandlerAdaptorTest_8cpp_a5500d573c3e3711b9cfc4d0dddb900b2}


Definition at line 47 of file Request\+Handler\+Adaptor\+Test.\+cpp.



References test\+Expect\+Handling().


\begin{DoxyCode}
47                                         \{
48   testExpectHandling(\textcolor{keyword}{true} \textcolor{comment}{/* handlerResponds */});
49   testExpectHandling(\textcolor{keyword}{false} \textcolor{comment}{/* handlerResponds */});
50 \}
\end{DoxyCode}
\index{Request\+Handler\+Adaptor\+Test.\+cpp@{Request\+Handler\+Adaptor\+Test.\+cpp}!T\+E\+ST@{T\+E\+ST}}
\index{T\+E\+ST@{T\+E\+ST}!Request\+Handler\+Adaptor\+Test.\+cpp@{Request\+Handler\+Adaptor\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T(\+Request\+Handler\+Adaptor\+Test, on\+Error)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+ST (
\begin{DoxyParamCaption}
\item[{Request\+Handler\+Adaptor\+Test}]{, }
\item[{on\+Error}]{}
\end{DoxyParamCaption}
)}\label{RequestHandlerAdaptorTest_8cpp_a8bf3ccf84b6b9f8ba47f90d0e19b3d9b}


Definition at line 52 of file Request\+Handler\+Adaptor\+Test.\+cpp.



References proxygen\+::k\+Error\+Timeout, proxygen\+::\+H\+T\+T\+P\+Transaction\+::on\+Error(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::set\+Handler(), and proxygen\+::\+Exception\+::set\+Proxygen\+Error().


\begin{DoxyCode}
52                                          \{
53   NiceMock<MockRequestHandler> requestHandler\_;
54   \textcolor{keyword}{auto} adaptor = \textcolor{keyword}{new} RequestHandlerAdaptor(&requestHandler\_);
55   NiceMock<MockHTTPTransactionTransport> transport;
56   HTTP2PriorityQueue egressQueue;
57   HTTPTransaction txn(TransportDirection::DOWNSTREAM,
58                       1, 1, transport, egressQueue);
59   txn.setHandler(adaptor);
60   \textcolor{comment}{// egress timeout error}
61   HTTPException ex(HTTPException::Direction::EGRESS, \textcolor{stringliteral}{"egress timeout"});
62   ex.setProxygenError(kErrorTimeout);
63   txn.onError(ex);
64 \}
\end{DoxyCode}
\index{Request\+Handler\+Adaptor\+Test.\+cpp@{Request\+Handler\+Adaptor\+Test.\+cpp}!test\+Expect\+Handling@{test\+Expect\+Handling}}
\index{test\+Expect\+Handling@{test\+Expect\+Handling}!Request\+Handler\+Adaptor\+Test.\+cpp@{Request\+Handler\+Adaptor\+Test.\+cpp}}
\subsubsection[{test\+Expect\+Handling(bool handler\+Responds)}]{\setlength{\rightskip}{0pt plus 5cm}void test\+Expect\+Handling (
\begin{DoxyParamCaption}
\item[{bool}]{handler\+Responds}
\end{DoxyParamCaption}
)}\label{RequestHandlerAdaptorTest_8cpp_a19a019e9225856ae7b23ee05f46703ba}


Definition at line 34 of file Request\+Handler\+Adaptor\+Test.\+cpp.



References proxygen\+::\+H\+T\+T\+P\+Transaction\+Handler\+::on\+Headers\+Complete().



Referenced by T\+E\+S\+T().


\begin{DoxyCode}
34                                               \{
35   StrictMock<MockRequestHandler> requestHandler\_;
36   EXPECT\_CALL(requestHandler\_, canHandleExpect()).WillOnce(
37     Return(handlerResponds));
38   EXPECT\_CALL(requestHandler\_, onRequest(\_));
39   \textcolor{keyword}{auto} adaptor = std::make\_shared<StubRequestHandlerAdaptor>(&requestHandler\_);
40   \textcolor{keyword}{auto} msg = std::make\_unique<HTTPMessage>();
41   msg->getHeaders().add(\textcolor{stringliteral}{"Expect"}, \textcolor{stringliteral}{"100-continue"});
42   \textcolor{keyword}{auto} txHandler = std::dynamic\_pointer\_cast<HTTPTransactionHandler>(adaptor);
43   txHandler->onHeadersComplete(std::move(msg));
44   EXPECT\_EQ(adaptor->headersSent\_, !handlerResponds);
45 \}
\end{DoxyCode}
