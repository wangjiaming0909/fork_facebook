\section{proxygen/httpclient/samples/curl/\+Curl\+Client\+Main.cpp File Reference}
\label{CurlClientMain_8cpp}\index{proxygen/httpclient/samples/curl/\+Curl\+Client\+Main.\+cpp@{proxygen/httpclient/samples/curl/\+Curl\+Client\+Main.\+cpp}}
{\ttfamily \#include $<$folly/portability/\+G\+Flags.\+h$>$}\\*
{\ttfamily \#include $<$folly/io/async/\+Event\+Base.\+h$>$}\\*
{\ttfamily \#include $<$folly/io/async/\+S\+S\+L\+Context.\+h$>$}\\*
{\ttfamily \#include $<$folly/\+Socket\+Address.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/lib/http/\+H\+T\+T\+P\+Connector.\+h$>$}\\*
{\ttfamily \#include \char`\"{}Curl\+Client.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} ({\bf http\+\_\+method},\char`\"{}G\+ET\char`\"{},\char`\"{}H\+T\+TP method to use. G\+ET or P\+O\+ST are supported\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (url,\char`\"{}https\+://github.\+com/facebook/proxygen\char`\"{},\char`\"{}{\bf U\+RL} to perform the H\+T\+TP method against\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (input\+\_\+filename,\char`\"{}\char`\"{},\char`\"{}Filename to read from for P\+O\+ST {\bf requests}\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (http\+\_\+client\+\_\+connect\+\_\+timeout, 1000,\char`\"{}connect timeout in milliseconds\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (ca\+\_\+path,\char`\"{}/etc/ssl/certs/ca-\/certificates.\+crt\char`\"{},\char`\"{}Path to trusted CA file\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (cert\+\_\+path,\char`\"{}\char`\"{},\char`\"{}Path to client certificate file\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (key\+\_\+path,\char`\"{}\char`\"{},\char`\"{}Path to client private key file\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (next\+\_\+protos,\char`\"{}h2,h2-\/14,spdy/3.\+1,spdy/3,http/1.\+1\char`\"{},\char`\"{}Next protocol string for N\+PN/A\+L\+PN\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (plaintext\+\_\+proto,\char`\"{}\char`\"{},\char`\"{}plaintext protocol\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (recv\+\_\+window, 65536,\char`\"{}Flow control receive window for h2/spdy\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+bool} (h2c, true,\char`\"{}Attempt H\+T\+TP/1.\+1 -\/$>$ H\+T\+TP/2 upgrade\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (headers,\char`\"{}\char`\"{},\char`\"{}List of N=V headers separated by ,\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (proxy,\char`\"{}\char`\"{},\char`\"{}H\+T\+TP proxy {\bf U\+RL}\char`\"{})
\item 
int {\bf main} (int argc, char $\ast$argv[$\,$])
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+bool@{D\+E\+F\+I\+N\+E\+\_\+bool}}
\index{D\+E\+F\+I\+N\+E\+\_\+bool@{D\+E\+F\+I\+N\+E\+\_\+bool}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+bool(h2c, true,""Attempt H\+T\+T\+P/1.\+1 -\/$>$ H\+T\+T\+P/2 upgrade"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+bool (
\begin{DoxyParamCaption}
\item[{h2c}]{, }
\item[{true}]{, }
\item[{\char`\"{}Attempt H\+T\+TP/1.\+1 -\/$>$ H\+T\+TP/2 upgrade\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_ab9141b4886b228b77b337587236c90cb}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(http\+\_\+client\+\_\+connect\+\_\+timeout, 1000,""connect timeout in milliseconds"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{http\+\_\+client\+\_\+connect\+\_\+timeout}]{, }
\item[{1000}]{, }
\item[{\char`\"{}connect timeout in milliseconds\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_af4c28d8cef1003b6918cec09fcd5d078}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(recv\+\_\+window, 65536,""Flow control receive window for h2/spdy"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{recv\+\_\+window}]{, }
\item[{65536}]{, }
\item[{\char`\"{}Flow control receive window for h2/spdy\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_ad46639fc96f7f91c9ca7a1d37fb4b9ed}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(http\+\_\+method,""G\+ET"",""H\+T\+T\+P method to use. G\+E\+T or P\+O\+S\+T are supported"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{{\bf http\+\_\+method}}]{, }
\item[{\char`\"{}G\+ET\char`\"{}}]{, }
\item[{\char`\"{}H\+T\+TP method to use. G\+ET or P\+O\+ST are supported\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_ae4ca579bd9a8b54079b16af5a63c1d35}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(url,""https\+://github.\+com/facebook/proxygen"",""U\+R\+L to perform the H\+T\+T\+P method against"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{url}]{, }
\item[{\char`\"{}https\+://github.\+com/facebook/proxygen\char`\"{}}]{, }
\item[{\char`\"{}U\+RL to perform the H\+T\+TP method against\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a2c31f744ad20c9dbf24f5bdb6c104e81}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(input\+\_\+filename,"""",""Filename to read from for P\+O\+S\+T requests"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{input\+\_\+filename}]{, }
\item[{\char`\"{}\char`\"{}}]{, }
\item[{\char`\"{}Filename to read from for P\+O\+ST {\bf requests}\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a4c7b165ef42ccacde6572963022e4564}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(ca\+\_\+path,""/etc/ssl/certs/ca-\/certificates.\+crt"",""Path to trusted C\+A file"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{ca\+\_\+path}]{, }
\item[{\char`\"{}/etc/ssl/certs/ca-\/certificates.\+crt\char`\"{}}]{, }
\item[{\char`\"{}Path to trusted CA file\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a5d2d95bd94f49c907971152c38bb5dea}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(cert\+\_\+path,"""",""Path to client certificate file"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{cert\+\_\+path}]{, }
\item[{\char`\"{}\char`\"{}}]{, }
\item[{\char`\"{}Path to client certificate file\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a67a643bd19b46408017bcc9be3779d0c}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(key\+\_\+path,"""",""Path to client private key file"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{key\+\_\+path}]{, }
\item[{\char`\"{}\char`\"{}}]{, }
\item[{\char`\"{}Path to client private key file\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a725e8644259d811e4c73a8295aff35a3}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(next\+\_\+protos,""h2,h2-\/14,spdy/3.\+1,spdy/3,http/1.\+1"",""Next protocol string for N\+P\+N/\+A\+L\+PN"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{next\+\_\+protos}]{, }
\item[{\char`\"{}}]{h2, }
\item[{h2-\/}]{14, }
\item[{spdy/3.}]{1, }
\item[{spdy/}]{3, }
\item[{http/1.\+1\char`\"{}}]{, }
\item[{\char`\"{}Next protocol string for N\+PN/A\+L\+PN\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a6168a5ac3df2ed26e6fb5ddc7dfe7ee1}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(plaintext\+\_\+proto,"""",""plaintext protocol"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{plaintext\+\_\+proto}]{, }
\item[{\char`\"{}\char`\"{}}]{, }
\item[{\char`\"{}plaintext protocol\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_ace1f70c5a1d7a91482167202167e2f01}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(headers,"""",""List of N=\+V headers separated by ,"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{headers}]{, }
\item[{\char`\"{}\char`\"{}}]{, }
\item[{\char`\"{}List of}]{N = {\ttfamily V~headers~separated~by}, }
\item[{\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_aba71267274d5138df63dc16294631109}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(proxy,"""",""H\+T\+T\+P proxy U\+RL"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{proxy}]{, }
\item[{\char`\"{}\char`\"{}}]{, }
\item[{\char`\"{}H\+T\+TP proxy {\bf U\+RL}\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a0c0317d576d394cc9be06497e3d88cdb}
\index{Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}!main@{main}}
\index{main@{main}!Curl\+Client\+Main.\+cpp@{Curl\+Client\+Main.\+cpp}}
\subsubsection[{main(int argc, char $\ast$argv[])}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv[$\,$]}
\end{DoxyParamCaption}
)}\label{CurlClientMain_8cpp_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 50 of file Curl\+Client\+Main.\+cpp.



References proxygen\+::\+E\+R\+R\+OR, proxygen\+::\+U\+R\+L\+::get\+Host(), proxygen\+::\+U\+R\+L\+::get\+Port(), proxygen\+::\+U\+R\+L\+::is\+Secure(), Curl\+Service\+::\+Curl\+Client\+::parse\+Headers(), Curl\+Service\+::\+Curl\+Client\+::set\+Flow\+Control\+Settings(), proxygen\+::\+H\+T\+T\+P\+Connector\+::set\+Plaintext\+Protocol(), and proxygen\+::string\+To\+Method().


\begin{DoxyCode}
50                                  \{
51   gflags::ParseCommandLineFlags(&argc, &argv, \textcolor{keyword}{true});
52   google::InitGoogleLogging(argv[0]);
53   google::InstallFailureSignalHandler();
54 
55   EventBase evb;
56   URL url(FLAGS\_url);
57   URL proxy(FLAGS\_proxy);
58 
59   \textcolor{keywordflow}{if} (FLAGS\_http\_method != \textcolor{stringliteral}{"GET"} && FLAGS\_http\_method != \textcolor{stringliteral}{"POST"}) \{
60     LOG(ERROR) << \textcolor{stringliteral}{"http\_method must be either GET or POST"};
61     \textcolor{keywordflow}{return} EXIT\_FAILURE;
62   \}
63 
64   HTTPMethod httpMethod = *stringToMethod(FLAGS\_http\_method);
65   \textcolor{keywordflow}{if} (httpMethod == HTTPMethod::POST) \{
66     \textcolor{keywordflow}{try} \{
67       File f(FLAGS\_input\_filename);
68       (void)f;
69     \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::system\_error& se) \{
70       LOG(ERROR) << \textcolor{stringliteral}{"Couldn't open file for POST method"};
71       LOG(ERROR) << se.what();
72       \textcolor{keywordflow}{return} EXIT\_FAILURE;
73     \}
74   \}
75 
76   HTTPHeaders headers = CurlClient::parseHeaders(FLAGS\_headers);
77 
78   CurlClient curlClient(&evb,
79                         httpMethod,
80                         url,
81                         FLAGS\_proxy.empty() ? \textcolor{keyword}{nullptr} : &proxy,
82                         headers,
83                         FLAGS\_input\_filename,
84                         FLAGS\_h2c);
85   curlClient.setFlowControlSettings(FLAGS\_recv\_window);
86 
87   SocketAddress addr;
88   \textcolor{keywordflow}{if} (!FLAGS\_proxy.empty()) \{
89     addr = SocketAddress(proxy.getHost(), proxy.getPort(), \textcolor{keyword}{true});
90   \} \textcolor{keywordflow}{else} \{
91     addr = SocketAddress(url.getHost(), url.getPort(), \textcolor{keyword}{true});
92   \}
93   LOG(INFO) << \textcolor{stringliteral}{"Trying to connect to "} << addr;
94 
95   \textcolor{comment}{// Note: HHWheelTimer is a large object and should be created at most}
96   \textcolor{comment}{// once per thread}
97   HHWheelTimer::UniquePtr timer\{HHWheelTimer::newTimer(
98       &evb,
99       std::chrono::milliseconds(HHWheelTimer::DEFAULT\_TICK\_INTERVAL),
100       AsyncTimeout::InternalEnum::NORMAL,
101       std::chrono::milliseconds(5000))\};
102   HTTPConnector connector(&curlClient, timer.get());
103   \textcolor{keywordflow}{if} (!FLAGS\_plaintext\_proto.empty()) \{
104     connector.setPlaintextProtocol(FLAGS\_plaintext\_proto);
105   \}
106   \textcolor{keyword}{static} \textcolor{keyword}{const} AsyncSocket::OptionMap opts\{\{\{SOL\_SOCKET, SO\_REUSEADDR\}, 1\}\};
107 
108   \textcolor{keywordflow}{if} (url.isSecure()) \{
109     curlClient.initializeSsl(
110         FLAGS\_ca\_path, FLAGS\_next\_protos, FLAGS\_cert\_path, FLAGS\_key\_path);
111     connector.connectSSL(
112         &evb,
113         addr,
114         curlClient.getSSLContext(),
115         \textcolor{keyword}{nullptr},
116         std::chrono::milliseconds(FLAGS\_http\_client\_connect\_timeout),
117         opts,
118         folly::AsyncSocket::anyAddress(),
119         curlClient.getServerName());
120   \} \textcolor{keywordflow}{else} \{
121     connector.connect(&evb, addr,
122         std::chrono::milliseconds(FLAGS\_http\_client\_connect\_timeout), opts);
123   \}
124 
125   evb.loop();
126 
127   \textcolor{keywordflow}{return} EXIT\_SUCCESS;
128 \}
\end{DoxyCode}
