\section{proxygen\+:\+:Scoped\+H\+T\+T\+P\+Server Class Reference}
\label{classproxygen_1_1ScopedHTTPServer}\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}


{\ttfamily \#include $<$Scoped\+H\+T\+T\+P\+Server.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
int {\bf get\+Port} () const 
\item 
std\+::vector$<$ {\bf H\+T\+T\+P\+Server\+::\+I\+P\+Config} $>$ {\bf get\+Addresses} () const 
\item 
{\bf $\sim$\+Scoped\+H\+T\+T\+P\+Server} ()
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename Handler\+Type $>$ }\\static std\+::unique\+\_\+ptr$<$ {\bf Scoped\+H\+T\+T\+P\+Server} $>$ {\bf start} (Handler\+Type handler, int port=0, int num\+Threads=4, std\+::unique\+\_\+ptr$<$ wangle\+::\+S\+S\+L\+Context\+Config $>$ ssl\+Cfg={\bf nullptr})
\item 
static std\+::unique\+\_\+ptr$<$ {\bf Scoped\+H\+T\+T\+P\+Server} $>$ {\bf start} ({\bf H\+T\+T\+P\+Server\+::\+I\+P\+Config} cfg, {\bf H\+T\+T\+P\+Server\+Options} options)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf Scoped\+H\+T\+T\+P\+Server} (std\+::thread thread, std\+::unique\+\_\+ptr$<$ {\bf H\+T\+T\+P\+Server} $>$ server)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::thread {\bf thread\+\_\+}
\item 
std\+::unique\+\_\+ptr$<$ {\bf H\+T\+T\+P\+Server} $>$ {\bf server\+\_\+}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
A basic server that can be used for testing http clients. Since most such servers are short lived, this server takes care of starting and stopping automatically. 

Definition at line 88 of file Scoped\+H\+T\+T\+P\+Server.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!````~Scoped\+H\+T\+T\+P\+Server@{$\sim$\+Scoped\+H\+T\+T\+P\+Server}}
\index{````~Scoped\+H\+T\+T\+P\+Server@{$\sim$\+Scoped\+H\+T\+T\+P\+Server}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{$\sim$\+Scoped\+H\+T\+T\+P\+Server()}]{\setlength{\rightskip}{0pt plus 5cm}proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::$\sim$\+Scoped\+H\+T\+T\+P\+Server (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1ScopedHTTPServer_abdb4eb3e66521e092a083eae6f77533d}


Definition at line 124 of file Scoped\+H\+T\+T\+P\+Server.\+h.


\begin{DoxyCode}
124                       \{
125     server_->stop();
126     thread_.join();
127   \}
\end{DoxyCode}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!Scoped\+H\+T\+T\+P\+Server@{Scoped\+H\+T\+T\+P\+Server}}
\index{Scoped\+H\+T\+T\+P\+Server@{Scoped\+H\+T\+T\+P\+Server}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{Scoped\+H\+T\+T\+P\+Server(std\+::thread thread, std\+::unique\+\_\+ptr$<$ H\+T\+T\+P\+Server $>$ server)}]{\setlength{\rightskip}{0pt plus 5cm}proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::\+Scoped\+H\+T\+T\+P\+Server (
\begin{DoxyParamCaption}
\item[{std\+::thread}]{thread, }
\item[{std\+::unique\+\_\+ptr$<$ {\bf H\+T\+T\+P\+Server} $>$}]{server}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}\label{classproxygen_1_1ScopedHTTPServer_acc78a4a5e299d3e7e2f77011c7e98a9f}


Definition at line 130 of file Scoped\+H\+T\+T\+P\+Server.\+h.


\begin{DoxyCode}
132       : thread_(std::move(thread)),
133         server_(std::move(server)) \{
134   \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!get\+Addresses@{get\+Addresses}}
\index{get\+Addresses@{get\+Addresses}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{get\+Addresses() const }]{\setlength{\rightskip}{0pt plus 5cm}std\+::vector$<${\bf H\+T\+T\+P\+Server\+::\+I\+P\+Config}$>$ proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::get\+Addresses (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1ScopedHTTPServer_a12284d01a74141041333280c7ddbe7b0}
Get the addresses for the server. 

Definition at line 118 of file Scoped\+H\+T\+T\+P\+Server.\+h.


\begin{DoxyCode}
118                                                      \{
119     \textcolor{keyword}{auto} addresses = server_->addresses();
120     CHECK(!addresses.empty());
121     \textcolor{keywordflow}{return} addresses;
122   \}
\end{DoxyCode}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!get\+Port@{get\+Port}}
\index{get\+Port@{get\+Port}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{get\+Port() const }]{\setlength{\rightskip}{0pt plus 5cm}int proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::get\+Port (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1ScopedHTTPServer_a29ad3ab59b6e71035e10d03f04b669bf}
Get the port the server is listening on. This is helpful if the port was randomly chosen. 

Definition at line 111 of file Scoped\+H\+T\+T\+P\+Server.\+h.


\begin{DoxyCode}
111                       \{
112     \textcolor{keywordflow}{return} getAddresses()[0].address.getPort();
113   \}
\end{DoxyCode}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!start@{start}}
\index{start@{start}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{start(\+Handler\+Type handler, int port=0, int num\+Threads=4, std\+::unique\+\_\+ptr$<$ wangle\+::\+S\+S\+L\+Context\+Config $>$ ssl\+Cfg=nullptr)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$typename Handler\+Type $>$ std\+::unique\+\_\+ptr$<$ {\bf Scoped\+H\+T\+T\+P\+Server} $>$ proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::start (
\begin{DoxyParamCaption}
\item[{Handler\+Type}]{handler, }
\item[{int}]{port = {\ttfamily 0}, }
\item[{int}]{num\+Threads = {\ttfamily 4}, }
\item[{std\+::unique\+\_\+ptr$<$ wangle\+::\+S\+S\+L\+Context\+Config $>$}]{ssl\+Cfg = {\ttfamily {\bf nullptr}}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\label{classproxygen_1_1ScopedHTTPServer_aeef1e672ffe56978eed1fe8acf02177e}
Start a server listening on the requested {\ttfamily port}. If {\ttfamily port} is 0, it will choose a random port. 

Definition at line 141 of file Scoped\+H\+T\+T\+P\+Server.\+h.


\begin{DoxyCode}
145                                                   \{
146 
147   std::unique\_ptr<RequestHandlerFactory> f =
148       std::make\_unique<ScopedHandlerFactory<HandlerType>>(handler);
149   \textcolor{keywordflow}{return} start(std::move(f), port, numThreads, std::move(sslCfg));
150 \}
\end{DoxyCode}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!start@{start}}
\index{start@{start}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{start(\+H\+T\+T\+P\+Server\+::\+I\+P\+Config cfg, H\+T\+T\+P\+Server\+Options options)}]{\setlength{\rightskip}{0pt plus 5cm}std\+::unique\+\_\+ptr$<$ {\bf Scoped\+H\+T\+T\+P\+Server} $>$ proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::start (
\begin{DoxyParamCaption}
\item[{{\bf H\+T\+T\+P\+Server\+::\+I\+P\+Config}}]{cfg, }
\item[{{\bf H\+T\+T\+P\+Server\+Options}}]{options}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\label{classproxygen_1_1ScopedHTTPServer_a9b8174f7866e34d04db6451a7f394976}
Start a server listening with the requested I\+P\+Config and server opts 

Definition at line 179 of file Scoped\+H\+T\+T\+P\+Server.\+h.


\begin{DoxyCode}
181                                \{
182 
183   std::vector<HTTPServer::IPConfig> IPs = \{ std::move(cfg) \};
184 
185   \textcolor{keyword}{auto} server = std::make\_unique<HTTPServer>(std::move(options));
186   server->bind(IPs);
187 
188   \textcolor{comment}{// Start the server}
189   std::exception\_ptr eptr;
190   \textcolor{keyword}{auto} barrier = std::make\_shared<boost::barrier>(2);
191 
192   std::thread t = std::thread([&, barrier] () \{
193     server->start(
194       [&, barrier] () \{
195         folly::setThreadName(\textcolor{stringliteral}{"http-acceptor"});
196         barrier->wait();
197       \},
198       [&, barrier] (std::exception\_ptr ex) \{
199         eptr = ex;
200         barrier->wait();
201       \});
202     \});
203 
204   \textcolor{comment}{// Wait for server to start}
205   barrier->wait();
206   \textcolor{keywordflow}{if} (eptr) \{
207     t.join();
208 
209     std::rethrow\_exception(eptr);
210   \}
211 
212   \textcolor{keywordflow}{return} std::unique\_ptr<ScopedHTTPServer>(
213       \textcolor{keyword}{new} ScopedHTTPServer(std::move(t), std::move(server)));
214 \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!server\+\_\+@{server\+\_\+}}
\index{server\+\_\+@{server\+\_\+}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{server\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}std\+::unique\+\_\+ptr$<${\bf H\+T\+T\+P\+Server}$>$ proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::server\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1ScopedHTTPServer_ad01730dadcc11482b211af4d52c54b5a}


Definition at line 137 of file Scoped\+H\+T\+T\+P\+Server.\+h.

\index{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}!thread\+\_\+@{thread\+\_\+}}
\index{thread\+\_\+@{thread\+\_\+}!proxygen\+::\+Scoped\+H\+T\+T\+P\+Server@{proxygen\+::\+Scoped\+H\+T\+T\+P\+Server}}
\subsubsection[{thread\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}std\+::thread proxygen\+::\+Scoped\+H\+T\+T\+P\+Server\+::thread\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1ScopedHTTPServer_a0922054ed6d17413448270a88d3467d9}


Definition at line 136 of file Scoped\+H\+T\+T\+P\+Server.\+h.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
proxygen/httpserver/{\bf Scoped\+H\+T\+T\+P\+Server.\+h}\end{DoxyCompactItemize}
