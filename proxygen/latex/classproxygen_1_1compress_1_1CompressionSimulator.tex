\section{proxygen\+:\+:compress\+:\+:Compression\+Simulator Class Reference}
\label{classproxygen_1_1compress_1_1CompressionSimulator}\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}


{\ttfamily \#include $<$Compression\+Simulator.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf Compression\+Simulator} ({\bf Sim\+Params} p)
\item 
bool {\bf read\+Input\+From\+File\+And\+Schedule} (const std\+::string \&filename)
\item 
void {\bf run} ()
\item 
void {\bf flush\+Scheme\+Packets} ({\bf Compression\+Scheme} $\ast$scheme)
\item 
void {\bf flush\+Packet} ({\bf Compression\+Scheme} $\ast$scheme)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void {\bf flush\+Requests} ({\bf Compression\+Scheme} $\ast$scheme)
\item 
void {\bf setup\+Request} (uint16\+\_\+t seqn, {\bf H\+T\+T\+P\+Message} \&\&msg, std\+::chrono\+::milliseconds encode\+Delay)
\item 
{\bf Compression\+Scheme} $\ast$ {\bf get\+Scheme} (folly\+::\+String\+Piece host)
\item 
std\+::unique\+\_\+ptr$<$ {\bf Compression\+Scheme} $>$ {\bf make\+Scheme} ()
\item 
std\+::pair$<$ {\bf Frame\+Flags}, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ $>$ {\bf encode} ({\bf Compression\+Scheme} $\ast$scheme, bool new\+Packet, uint16\+\_\+t seqn)
\item 
void {\bf decode\+Packet} ({\bf Compression\+Scheme} $\ast$scheme, std\+::list$<$ {\bf Compression\+Scheme\+::\+Block\+Info} $>$ \&blocks)
\item 
void {\bf decode} ({\bf Compression\+Scheme} $\ast$scheme, {\bf Frame\+Flags} {\bf flags}, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ encoded\+Req, {\bf Sim\+Streaming\+Callback} \&cb)
\item 
void {\bf schedule\+Event} (folly\+::\+Function$<$ void()$>$ f, std\+::chrono\+::milliseconds ms)
\item 
void {\bf send\+Ack} ({\bf Compression\+Scheme} $\ast$scheme, std\+::unique\+\_\+ptr$<$ {\bf Compression\+Scheme\+::\+Ack} $>$ ack)
\item 
void {\bf recv\+Ack} ({\bf Compression\+Scheme} $\ast$scheme, std\+::unique\+\_\+ptr$<$ {\bf Compression\+Scheme\+::\+Ack} $>$ ack)
\item 
std\+::chrono\+::milliseconds {\bf delivery\+Delay} ()
\item 
std\+::chrono\+::milliseconds {\bf rtt} ()
\item 
std\+::chrono\+::milliseconds {\bf one\+\_\+half\+\_\+rtt} ()
\item 
std\+::chrono\+::milliseconds {\bf rxmit\+Delay} ()
\item 
bool {\bf loss} ()
\item 
bool {\bf delayed} ()
\item 
std\+::chrono\+::milliseconds {\bf extra\+Delay} ()
\item 
uint32\+\_\+t {\bf min\+O\+O\+O\+Thresh} ()
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
{\bf Sim\+Params} {\bf params\+\_\+}
\item 
std\+::vector$<$ {\bf proxygen\+::\+H\+T\+T\+P\+Message} $>$ {\bf requests\+\_\+}
\item 
folly\+::\+Event\+Base {\bf event\+Base\+\_\+}
\item 
std\+::unordered\+\_\+map$<$ std\+::string, std\+::unique\+\_\+ptr$<$ {\bf Compression\+Scheme} $>$ $>$ {\bf domains\+\_\+}
\item 
std\+::vector$<$ {\bf Sim\+Streaming\+Callback} $>$ {\bf callbacks\+\_\+}
\item 
folly\+::\+Random\+::\+Default\+Generator {\bf rng\+\_\+}
\item 
{\bf Sim\+Stats} {\bf stats\+\_\+}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 23 of file Compression\+Simulator.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!Compression\+Simulator@{Compression\+Simulator}}
\index{Compression\+Simulator@{Compression\+Simulator}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{Compression\+Simulator(\+Sim\+Params p)}]{\setlength{\rightskip}{0pt plus 5cm}proxygen\+::compress\+::\+Compression\+Simulator\+::\+Compression\+Simulator (
\begin{DoxyParamCaption}
\item[{{\bf Sim\+Params}}]{p}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [explicit]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a18003fe5998e7271d2c818bec436ee52}


Definition at line 25 of file Compression\+Simulator.\+h.



References decode(), decode\+Packet(), delayed(), delivery\+Delay(), encode(), extra\+Delay(), flush\+Packet(), flush\+Requests(), flush\+Scheme\+Packets(), get\+Scheme(), loss(), make\+Scheme(), min\+O\+O\+O\+Thresh(), one\+\_\+half\+\_\+rtt(), read\+Input\+From\+File\+And\+Schedule(), recv\+Ack(), rtt(), run(), rxmit\+Delay(), schedule\+Event(), send\+Ack(), and setup\+Request().


\begin{DoxyCode}
25                                              : params_(p) \{
26   \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!decode@{decode}}
\index{decode@{decode}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{decode(\+Compression\+Scheme $\ast$scheme, Frame\+Flags flags, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ encoded\+Req, Sim\+Streaming\+Callback \&cb)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::decode (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme, }
\item[{{\bf Frame\+Flags}}]{flags, }
\item[{std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$}]{encoded\+Req, }
\item[{{\bf Sim\+Streaming\+Callback} \&}]{cb}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ae82cb6f93c12771defb01fe392d12639}


Definition at line 306 of file Compression\+Simulator.\+cpp.



References proxygen\+::compress\+::\+Compression\+Scheme\+::decode().



Referenced by Compression\+Simulator().


\begin{DoxyCode}
309                                                             \{
310   scheme->decode(flags, std::move(encodedReq), stats_, cb);
311 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!decode\+Packet@{decode\+Packet}}
\index{decode\+Packet@{decode\+Packet}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{decode\+Packet(\+Compression\+Scheme $\ast$scheme, std\+::list$<$ Compression\+Scheme\+::\+Block\+Info $>$ \&blocks)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::decode\+Packet (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme, }
\item[{std\+::list$<$ {\bf Compression\+Scheme\+::\+Block\+Info} $>$ \&}]{blocks}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a38bef8da0daefefa016062dfc5374f11}


Definition at line 313 of file Compression\+Simulator.\+cpp.



References proxygen\+::hpack\+::decode().



Referenced by Compression\+Simulator().


\begin{DoxyCode}
315                                                  \{
316   VLOG(1) << \textcolor{stringliteral}{"decode packet with "} << blocks.size() << \textcolor{stringliteral}{" blocks"};
317   \textcolor{keywordflow}{while} (!blocks.empty()) \{
318     \textcolor{keyword}{auto} encodeRes = &blocks.front();
319     \textcolor{comment}{// TODO(ckrasic) - to get packet coordination correct, could plumb}
320     \textcolor{comment}{// through "start of packet" flag here.  Probably not worth it,}
321     \textcolor{comment}{// since it seems to make only a very small difference (about a}
322     \textcolor{comment}{// 0.1% compressiondifference on my facebook har).}
323     decode(scheme,
324            std::get<0>(*encodeRes),
325            std::move(std::get<2>(*encodeRes)),
326            *std::get<3>(*encodeRes));
327     blocks.pop\_front();
328   \}
329 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!delayed@{delayed}}
\index{delayed@{delayed}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{delayed()}]{\setlength{\rightskip}{0pt plus 5cm}bool proxygen\+::compress\+::\+Compression\+Simulator\+::delayed (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a1946a350f39d75b58da56fcf21080b08}


Definition at line 392 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
392                                    \{
393   \textcolor{keywordflow}{return} Random::randDouble01(rng_) < params_.delayProbability;
394 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!delivery\+Delay@{delivery\+Delay}}
\index{delivery\+Delay@{delivery\+Delay}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{delivery\+Delay()}]{\setlength{\rightskip}{0pt plus 5cm}std\+::chrono\+::milliseconds proxygen\+::compress\+::\+Compression\+Simulator\+::delivery\+Delay (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_af0d6d728f67553cdfa0149c7bc7e634f}


Definition at line 354 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
354                                                           \{
355   std::chrono::milliseconds delay = one_half_rtt();
356   \textcolor{keywordflow}{while} (loss()) \{
357     stats_.packetLosses++;
358     scheduleEvent([] \{ VLOG(4) << \textcolor{stringliteral}{"Packet lost!"}; \}, delay);
359     std::chrono::milliseconds rxmit = rxmitDelay();
360     delay += rxmit;
361     scheduleEvent(
362         [rxmit] \{
363           VLOG(4) << \textcolor{stringliteral}{"Packet loss detected, retransmitting with additional "}
364                   << rxmit.count();
365         \},
366         delay - one_half_rtt());
367   \}
368   \textcolor{keywordflow}{if} (delayed()) \{
369     scheduleEvent([] \{ VLOG(4) << \textcolor{stringliteral}{"Packet delayed in network"}; \}, delay);
370     delay += extraDelay();
371   \}
372   \textcolor{keywordflow}{return} delay;
373 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!encode@{encode}}
\index{encode@{encode}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{encode(\+Compression\+Scheme $\ast$scheme, bool new\+Packet, uint16\+\_\+t seqn)}]{\setlength{\rightskip}{0pt plus 5cm}std\+::pair$<$ {\bf Frame\+Flags}, unique\+\_\+ptr$<$ I\+O\+Buf $>$ $>$ proxygen\+::compress\+::\+Compression\+Simulator\+::encode (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme, }
\item[{bool}]{new\+Packet, }
\item[{uint16\+\_\+t}]{seqn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a566957fa4b7a925f5cae7660b4ed24b9}


Definition at line 286 of file Compression\+Simulator.\+cpp.



References proxygen\+::compress\+::\+Compression\+Scheme\+::encode(), and proxygen\+::compress\+::prepare\+Message\+For\+Compression().



Referenced by Compression\+Simulator().


\begin{DoxyCode}
287                                                                \{
288   VLOG(1) << \textcolor{stringliteral}{"Start encoding request="} << index;
289   \textcolor{comment}{// vector to hold cookie crumbs}
290   vector<string> cookies;
291   vector<compress::Header> allHeaders = prepareMessageForCompression(
292       requests_[index], cookies);
293 
294   \textcolor{keyword}{auto} before = stats_.uncompressed;
295   \textcolor{keyword}{auto} res = scheme->encode(newPacket, std::move(allHeaders), stats_);
296   VLOG(1) << \textcolor{stringliteral}{"Encoded request="} << index << \textcolor{stringliteral}{" for host="}
297           << requests_[index].getHeaders().getSingleOrEmpty(HTTP\_HEADER\_HOST)
298           << \textcolor{stringliteral}{" orig size="} << (stats_.uncompressed - before)
299           << \textcolor{stringliteral}{" block size="} << res.second->computeChainDataLength()
300           << \textcolor{stringliteral}{" cumulative bytes="} << stats_.compressed
301           << \textcolor{stringliteral}{" cumulative compression ratio="}
302           << int(100 - \textcolor{keywordtype}{double}(100 * stats_.compressed) / stats_.uncompressed);
303   \textcolor{keywordflow}{return} res;
304 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!extra\+Delay@{extra\+Delay}}
\index{extra\+Delay@{extra\+Delay}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{extra\+Delay()}]{\setlength{\rightskip}{0pt plus 5cm}std\+::chrono\+::milliseconds proxygen\+::compress\+::\+Compression\+Simulator\+::extra\+Delay (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a17527a82237c46d5d9968605cefe2aee}


Definition at line 396 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
396                                                        \{
397   uint32\_t ms = params_.maxDelay.count() * Random::randDouble01(rng_);
398   \textcolor{keywordflow}{return} std::chrono::milliseconds(ms);
399 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!flush\+Packet@{flush\+Packet}}
\index{flush\+Packet@{flush\+Packet}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{flush\+Packet(\+Compression\+Scheme $\ast$scheme)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::flush\+Packet (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme}
\end{DoxyParamCaption}
)}\label{classproxygen_1_1compress_1_1CompressionSimulator_adbe2351c3837f1532bedee587d37d4b0}


Definition at line 186 of file Compression\+Simulator.\+cpp.



References proxygen\+::compress\+::\+Compression\+Scheme\+::decode\+Delay, proxygen\+::compress\+::\+Compression\+Scheme\+::packet\+Blocks, and proxygen\+::compress\+::\+Compression\+Scheme\+::packet\+Bytes.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
186                                                                 \{
187   \textcolor{keywordflow}{if} (scheme->packetBlocks.empty()) \{
188     \textcolor{keywordflow}{return};
189   \}
190 
191   stats_.packets++;
192   VLOG(1) << \textcolor{stringliteral}{"schedule decode for "} << scheme->packetBlocks.size()
193           << \textcolor{stringliteral}{" blocks at "} << scheme->decodeDelay.count();
194   scheduleEvent(
195       \{[\textcolor{keyword}{this}, scheme, blocks = std::move(scheme->packetBlocks)]() \textcolor{keyword}{mutable} \{
196         decodePacket(scheme, blocks);
197       \}\},
198       scheme->decodeDelay);
199   scheme->packetBytes = 0;
200 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!flush\+Requests@{flush\+Requests}}
\index{flush\+Requests@{flush\+Requests}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{flush\+Requests(\+Compression\+Scheme $\ast$scheme)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::flush\+Requests (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ae5507a6cc20d0189a91a840c1e9650ea}


Definition at line 103 of file Compression\+Simulator.\+cpp.



References proxygen\+::compress\+::\+Compression\+Scheme\+::packet\+Indices, and proxygen\+::compress\+::\+Compression\+Scheme\+::prev.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
103                                                                   \{
104   VLOG(5) << \textcolor{stringliteral}{"schedule encode for "} << scheme->packetIndices.size()
105           << \textcolor{stringliteral}{" blocks at "} << scheme->prev.count();
106   \textcolor{comment}{// Flush previous train}
107   scheduleEvent(
108       [\textcolor{keyword}{this}, scheme, indices = std::move(scheme->packetIndices)]() \textcolor{keyword}{mutable} \{
109         bool newPacket = true;
110         while (!indices.empty()) \{
111           int16\_t index = indices.front();
112           indices.pop\_front();
113           auto schemeIndex = scheme->index;
114           auto encodeRes = encode(scheme, newPacket, index);
115           FrameFlags flags = encodeRes.first;
116           bool allowOOO = flags.allowOOO;
117           if (schemeIndex < minOOOThresh()) \{
118             allowOOO = false;
119             auto ack = scheme->getAck(schemeIndex);
120             if (ack) \{
121               scheme->recvAck(std::move(ack));
122             \}
123           \}
124           stats\_.allowedOOO += (allowOOO) ? 1 : 0;
125           flags.allowOOO = allowOOO;
126           scheme->encodedBlocks.emplace\_back(flags,
127                                              newPacket,
128                                              std::move(encodeRes.second),
129                                              &callbacks\_[index]);
130           newPacket = false;
131         \}
132         eventBase_.runInLoop(scheme, \textcolor{keyword}{true});
133       \},
134       scheme->prev);
135 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!flush\+Scheme\+Packets@{flush\+Scheme\+Packets}}
\index{flush\+Scheme\+Packets@{flush\+Scheme\+Packets}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{flush\+Scheme\+Packets(\+Compression\+Scheme $\ast$scheme)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::flush\+Scheme\+Packets (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme}
\end{DoxyParamCaption}
)}\label{classproxygen_1_1compress_1_1CompressionSimulator_a884a49adac43a3f563dc5d09b15de14a}


Definition at line 202 of file Compression\+Simulator.\+cpp.



References proxygen\+::compress\+::\+Compression\+Scheme\+::decode\+Delay, proxygen\+::compress\+::\+Compression\+Scheme\+::encoded\+Blocks, proxygen\+::compress\+::\+Compression\+Scheme\+::packet\+Blocks, and proxygen\+::compress\+::\+Compression\+Scheme\+::packet\+Bytes.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
202                                                                        \{
203   CHECK(!scheme->encodedBlocks.empty());
204   VLOG(2) << \textcolor{stringliteral}{"Flushing "} << scheme->encodedBlocks.size() << \textcolor{stringliteral}{" requests"};
205   \textcolor{comment}{// tracks the number of bytes in the current simulated packet}
206   \textcolor{keyword}{auto} encodeRes = &scheme->encodedBlocks.front();
207   \textcolor{keywordtype}{bool} newPacket = std::get<1>(*encodeRes);
208   \textcolor{keywordtype}{size\_t} headerBlockBytesRemaining =
209       std::get<2>(*encodeRes)->computeChainDataLength();
210   std::chrono::milliseconds packetDelay = deliveryDelay();
211   scheme->decodeDelay = packetDelay;
212   \textcolor{keywordflow}{while} (\textcolor{keyword}{true}) \{
213     \textcolor{keywordflow}{if} (newPacket) \{
214       flushPacket(scheme);
215     \}
216     newPacket = \textcolor{keyword}{false};
217     \textcolor{comment}{// precondition packetBytes < kMTU}
218     \textcolor{keywordflow}{if} (scheme->packetBytes + headerBlockBytesRemaining >= kMTU) \{
219       \textcolor{comment}{// Header block filled current packet, triggering a flush}
220       VLOG(2) << \textcolor{stringliteral}{"Request(s) spanned multiple packets"};
221       newPacket = \textcolor{keyword}{true};
222     \} \textcolor{keywordflow}{else} \{
223       scheme->packetBytes += headerBlockBytesRemaining;
224     \}
225     headerBlockBytesRemaining -=
226         std::min(headerBlockBytesRemaining, kMTU - scheme->packetBytes);
227     \textcolor{keywordflow}{if} (headerBlockBytesRemaining == 0) \{
228       \textcolor{comment}{// Move from the first element of encodedBlocks to the last}
229       \textcolor{comment}{// element of packetBlocks.}
230       scheme->packetBlocks.splice(scheme->packetBlocks.end(),
231                                   scheme->encodedBlocks,
232                                   scheme->encodedBlocks.begin());
233       \textcolor{keywordflow}{if} (scheme->encodedBlocks.empty()) \{
234         \textcolor{comment}{// All done}
235         \textcolor{keywordflow}{break};
236       \}
237       \textcolor{comment}{// Grab the next request}
238       encodeRes = &scheme->encodedBlocks.front();
239       newPacket = std::get<1>(*encodeRes);
240       headerBlockBytesRemaining =
241           std::get<2>(*encodeRes)->computeChainDataLength();
242     \}
243     \textcolor{keywordflow}{if} (newPacket) \{
244       packetDelay = deliveryDelay();
245       scheme->decodeDelay = std::max(scheme->decodeDelay, packetDelay);
246     \}
247   \}
248   flushPacket(scheme);
249   CHECK(scheme->encodedBlocks.empty());
250 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!get\+Scheme@{get\+Scheme}}
\index{get\+Scheme@{get\+Scheme}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{get\+Scheme(folly\+::\+String\+Piece host)}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Compression\+Scheme} $\ast$ proxygen\+::compress\+::\+Compression\+Simulator\+::get\+Scheme (
\begin{DoxyParamCaption}
\item[{folly\+::\+String\+Piece}]{host}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a1d2618417295b3be19f67d35d8f974af}


Definition at line 252 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
252                                                                      \{
253   \textcolor{keyword}{static} \textcolor{keywordtype}{string} blended(\textcolor{stringliteral}{"\(\backslash\)"Facebook\(\backslash\)""});
254   \textcolor{keywordflow}{if} (params_.blend &&
255       (domain.endsWith(\textcolor{stringliteral}{"facebook.com"}) || domain.endsWith(\textcolor{stringliteral}{"fbcdn.net"}))) \{
256     domain = blended;
257   \}
258 
259   \textcolor{keyword}{auto} it = domains_.find(domain.str());
260   CompressionScheme* scheme = \textcolor{keyword}{nullptr};
261   \textcolor{keywordflow}{if} (it == domains_.end()) \{
262     LOG(INFO) << \textcolor{stringliteral}{"Creating scheme for domain="} << domain;
263     \textcolor{keyword}{auto} schemePtr = makeScheme();
264     scheme = schemePtr.get();
265     domains_.emplace(domain.str(), std::move(schemePtr));
266   \} \textcolor{keywordflow}{else} \{
267     scheme = it->second.get();
268   \}
269   \textcolor{keywordflow}{return} scheme;
270 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!loss@{loss}}
\index{loss@{loss}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{loss()}]{\setlength{\rightskip}{0pt plus 5cm}bool proxygen\+::compress\+::\+Compression\+Simulator\+::loss (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a8c5b3ac32f847eb57ffa25b48bbc938a}


Definition at line 388 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
388                                 \{
389   \textcolor{keywordflow}{return} Random::randDouble01(rng_) < params_.lossProbability;
390 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!make\+Scheme@{make\+Scheme}}
\index{make\+Scheme@{make\+Scheme}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{make\+Scheme()}]{\setlength{\rightskip}{0pt plus 5cm}unique\+\_\+ptr$<$ {\bf Compression\+Scheme} $>$ proxygen\+::compress\+::\+Compression\+Simulator\+::make\+Scheme (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a8be7f9576f03cd8f562ebb0755cd8d69}


Definition at line 272 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
272                                                                \{
273   \textcolor{keywordflow}{switch} (params_.type) \{
274     \textcolor{keywordflow}{case} SchemeType::QPACK:
275       \textcolor{keywordflow}{return} make\_unique<QPACKScheme>(\textcolor{keyword}{this}, params_.tableSize,
276                                       params_.maxBlocking);
277     \textcolor{keywordflow}{case} SchemeType::QMIN:
278       \textcolor{keywordflow}{return} make\_unique<QMINScheme>(\textcolor{keyword}{this}, params_.tableSize);
279     \textcolor{keywordflow}{case} SchemeType::HPACK:
280       \textcolor{keywordflow}{return} make\_unique<HPACKScheme>(\textcolor{keyword}{this}, params_.tableSize);
281   \}
282   LOG(FATAL) << \textcolor{stringliteral}{"Bad scheme"};
283   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
284 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!min\+O\+O\+O\+Thresh@{min\+O\+O\+O\+Thresh}}
\index{min\+O\+O\+O\+Thresh@{min\+O\+O\+O\+Thresh}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{min\+O\+O\+O\+Thresh()}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t proxygen\+::compress\+::\+Compression\+Simulator\+::min\+O\+O\+O\+Thresh (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_aa3aa2b684f8d8a8aad6850bfafa94c29}


Definition at line 401 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
401                                             \{
402   \textcolor{keywordflow}{return} params_.minOOOThresh;
403 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!one\+\_\+half\+\_\+rtt@{one\+\_\+half\+\_\+rtt}}
\index{one\+\_\+half\+\_\+rtt@{one\+\_\+half\+\_\+rtt}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{one\+\_\+half\+\_\+rtt()}]{\setlength{\rightskip}{0pt plus 5cm}std\+::chrono\+::milliseconds proxygen\+::compress\+::\+Compression\+Simulator\+::one\+\_\+half\+\_\+rtt (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ac277f5cf3c36830948b344ecad58db3e}


Definition at line 379 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
379                                                          \{
380   \textcolor{keywordflow}{return} params_.rtt / 2;
381 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!read\+Input\+From\+File\+And\+Schedule@{read\+Input\+From\+File\+And\+Schedule}}
\index{read\+Input\+From\+File\+And\+Schedule@{read\+Input\+From\+File\+And\+Schedule}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{read\+Input\+From\+File\+And\+Schedule(const std\+::string \&filename)}]{\setlength{\rightskip}{0pt plus 5cm}bool proxygen\+::compress\+::\+Compression\+Simulator\+::read\+Input\+From\+File\+And\+Schedule (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{filename}
\end{DoxyParamCaption}
)}\label{classproxygen_1_1compress_1_1CompressionSimulator_a669fd5e309fe7b672d0a192039782b9a}


Definition at line 36 of file Compression\+Simulator.\+cpp.



References proxygen\+::\+E\+R\+R\+OR, proxygen\+::\+H\+T\+T\+P\+Message\+::get\+Start\+Time(), proxygen\+::milliseconds\+Between(), and proxygen\+::\+H\+T\+T\+P\+Archive\+::requests.



Referenced by Compression\+Simulator(), and main().


\begin{DoxyCode}
37                             \{
38   unique\_ptr<HTTPArchive> har;
39   \textcolor{keywordflow}{try} \{
40     har = HTTPArchive::fromFile(kTestDir + filename);
41   \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::exception& ex) \{
42     LOG(ERROR) << folly::exceptionStr(ex);
43   \}
44   \textcolor{keywordflow}{if} (!har || har->requests.size() == 0) \{
45     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
46   \}
47   \textcolor{comment}{// Sort by start time (har ordered by finish time?)}
48   std::sort(har->requests.begin(),
49             har->requests.end(),
50             [](\textcolor{keyword}{const} HTTPMessage& a, \textcolor{keyword}{const} HTTPMessage& b) \{
51               \textcolor{keywordflow}{return} a.getStartTime() < b.getStartTime();
52             \});
53   TimePoint last = har->requests[0].getStartTime();
54   std::chrono::milliseconds cumulativeDelay(0);
55   uint16\_t index = 0;
56   \textcolor{keywordflow}{for} (HTTPMessage& msg : har->requests) \{
57     \textcolor{keyword}{auto} delayFromPrevious = millisecondsBetween(msg.getStartTime(), last);
58     \textcolor{comment}{// If there was a quiescent gap in the HAR of at least some value, shrink}
59     \textcolor{comment}{// it so the test doesn't last forever}
60     \textcolor{keywordflow}{if} (delayFromPrevious > std::chrono::milliseconds(1000)) \{
61       delayFromPrevious = std::chrono::milliseconds(1000);
62     \}
63     last = msg.getStartTime();
64     cumulativeDelay += delayFromPrevious;
65     setupRequest(index++, std::move(msg), cumulativeDelay);
66   \}
67   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& kv : domains_) \{
68     flushRequests(kv.second.get());
69   \}
70   \textcolor{keywordflow}{return} \textcolor{keyword}{true};
71 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!recv\+Ack@{recv\+Ack}}
\index{recv\+Ack@{recv\+Ack}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{recv\+Ack(\+Compression\+Scheme $\ast$scheme, std\+::unique\+\_\+ptr$<$ Compression\+Scheme\+::\+Ack $>$ ack)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::recv\+Ack (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme, }
\item[{std\+::unique\+\_\+ptr$<$ {\bf Compression\+Scheme\+::\+Ack} $>$}]{ack}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a1edc5901ae87a12da5851a6a238293fc}


Definition at line 349 of file Compression\+Simulator.\+cpp.



References proxygen\+::compress\+::\+Compression\+Scheme\+::recv\+Ack().



Referenced by Compression\+Simulator().


\begin{DoxyCode}
350                                                                          \{
351   scheme->recvAck(std::move(ack));
352 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!rtt@{rtt}}
\index{rtt@{rtt}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{rtt()}]{\setlength{\rightskip}{0pt plus 5cm}std\+::chrono\+::milliseconds proxygen\+::compress\+::\+Compression\+Simulator\+::rtt (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_aee96fdc737e78658a558b44c877bca6d}


Definition at line 375 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
375                                                 \{
376   \textcolor{keywordflow}{return} params_.rtt;
377 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!run@{run}}
\index{run@{run}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{run()}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classproxygen_1_1compress_1_1CompressionSimulator_a5b756a2a20de3ecd7f2fd00c995b78d6}


Definition at line 73 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator(), and main().


\begin{DoxyCode}
73                                \{
74 \textcolor{preprocessor}{#ifndef HAVE\_REAL\_QMIN}
75   \textcolor{keywordflow}{if} (params_.type == SchemeType::QMIN) \{
76     LOG(INFO) << \textcolor{stringliteral}{"QMIN not available"};
77     \textcolor{keywordflow}{return};
78   \}
79 \textcolor{preprocessor}{#endif}
80 
81   LOG(INFO) << \textcolor{stringliteral}{"Starting run"};
82   eventBase_.loop();
83   uint32\_t holBlockCount = 0;
84   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& scheme : domains_) \{
85     holBlockCount += scheme.second->getHolBlockCount();
86   \}
87   LOG(INFO) << \textcolor{stringliteral}{"Complete"}
88             << \textcolor{stringliteral}{"\(\backslash\)nStats:"}
89                \textcolor{stringliteral}{"\(\backslash\)nSeed: "}
90             << params_.seed << \textcolor{stringliteral}{"\(\backslash\)nBlocks sent: "} << requests_.size()
91             << \textcolor{stringliteral}{"\(\backslash\)nAllowed OOO: "} << stats_.allowedOOO
92             << \textcolor{stringliteral}{"\(\backslash\)nPackets: "} << stats_.packets
93             << \textcolor{stringliteral}{"\(\backslash\)nPacket Losses: "} << stats_.packetLosses
94             << \textcolor{stringliteral}{"\(\backslash\)nHOL Block Count: "} << holBlockCount
95             << \textcolor{stringliteral}{"\(\backslash\)nHOL Delay (ms): "} << stats_.holDelay.count()
96             << \textcolor{stringliteral}{"\(\backslash\)nMax Queue Buffer Bytes: "} << stats_.maxQueueBufferBytes
97             << \textcolor{stringliteral}{"\(\backslash\)nUncompressed Bytes: "} << stats_.uncompressed
98             << \textcolor{stringliteral}{"\(\backslash\)nCompressed Bytes: "} << stats_.compressed
99             << \textcolor{stringliteral}{"\(\backslash\)nCompression Ratio: "}
100             << int(100 - \textcolor{keywordtype}{double}(100 * stats_.compressed) / stats_.uncompressed);
101 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!rxmit\+Delay@{rxmit\+Delay}}
\index{rxmit\+Delay@{rxmit\+Delay}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{rxmit\+Delay()}]{\setlength{\rightskip}{0pt plus 5cm}std\+::chrono\+::milliseconds proxygen\+::compress\+::\+Compression\+Simulator\+::rxmit\+Delay (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a5c93f855c37efddfc1468a754aca7539}


Definition at line 383 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
383                                                        \{
384   uint32\_t ms = rtt().count() * Random::randDouble(1.1, 2, rng_);
385   \textcolor{keywordflow}{return} std::chrono::milliseconds(ms);
386 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!schedule\+Event@{schedule\+Event}}
\index{schedule\+Event@{schedule\+Event}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{schedule\+Event(folly\+::\+Function$<$ void()$>$ f, std\+::chrono\+::milliseconds ms)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::schedule\+Event (
\begin{DoxyParamCaption}
\item[{folly\+::\+Function$<$ void()$>$}]{f, }
\item[{std\+::chrono\+::milliseconds}]{ms}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ac04f1b78922a01355be9bc27d20455a7}


Definition at line 331 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
332                                                                    \{
333   eventBase_.runAfterDelay(std::move(f), ms.count());
334 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!send\+Ack@{send\+Ack}}
\index{send\+Ack@{send\+Ack}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{send\+Ack(\+Compression\+Scheme $\ast$scheme, std\+::unique\+\_\+ptr$<$ Compression\+Scheme\+::\+Ack $>$ ack)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::send\+Ack (
\begin{DoxyParamCaption}
\item[{{\bf Compression\+Scheme} $\ast$}]{scheme, }
\item[{std\+::unique\+\_\+ptr$<$ {\bf Compression\+Scheme\+::\+Ack} $>$}]{ack}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a6d9e755a51c6b580b6c793bbdd0e72d9}


Definition at line 336 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
337                                                                          \{
338   \textcolor{keywordflow}{if} (!ack) \{
339     \textcolor{keywordflow}{return};
340   \}
341   \textcolor{comment}{// An ack is a packet}
342   stats_.packets++;
343   scheduleEvent([a = std::move(ack),
344                  \textcolor{keyword}{this},
345                  scheme]() \textcolor{keyword}{mutable} \{ recvAck(scheme, std::move(a)); \},
346                 deliveryDelay());
347 \}
\end{DoxyCode}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!setup\+Request@{setup\+Request}}
\index{setup\+Request@{setup\+Request}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{setup\+Request(uint16\+\_\+t seqn, H\+T\+T\+P\+Message \&\&msg, std\+::chrono\+::milliseconds encode\+Delay)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::compress\+::\+Compression\+Simulator\+::setup\+Request (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{seqn, }
\item[{{\bf H\+T\+T\+P\+Message} \&\&}]{msg, }
\item[{std\+::chrono\+::milliseconds}]{encode\+Delay}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a63980bd7582703dfdd89aa3fffdc93ff}


Definition at line 137 of file Compression\+Simulator.\+cpp.



Referenced by Compression\+Simulator().


\begin{DoxyCode}
139                                                                            \{
140   \textcolor{comment}{// Normalize to relative paths}
141   \textcolor{keyword}{const} \textcolor{keyword}{auto}& query = msg.getQueryString();
142   \textcolor{keywordflow}{if} (query.empty()) \{
143     msg.setURL(msg.getPath());
144   \} \textcolor{keywordflow}{else} \{
145     msg.setURL(folly::to<string>(msg.getPath(), \textcolor{stringliteral}{"?"}, query));
146   \}
147 
148   \textcolor{keyword}{auto} scheme = getScheme(msg.getHeaders().getSingleOrEmpty(HTTP\_HEADER\_HOST));
149   requests_.emplace\_back(msg);
150   \textcolor{keyword}{auto} decodeCompleteCB =
151       [index, \textcolor{keyword}{this}, scheme](std::chrono::milliseconds holDelay) \{
152         \textcolor{comment}{// record processed timestamp}
153         CHECK(!callbacks_[index].getResult().hasError());
154         DCHECK\_EQ(requests_[index], *callbacks_[index].getResult().value());
155         stats_.holDelay += holDelay;
156         VLOG(1) << \textcolor{stringliteral}{"Finished decoding request="} << index
157                 << \textcolor{stringliteral}{" with holDelay="} << holDelay.count()
158                 << \textcolor{stringliteral}{" cumulative HoL delay="} << stats_.holDelay.count();
159         \textcolor{keywordflow}{if} (callbacks_[index].acknowledge) \{
160           sendAck(scheme, scheme->getAck(callbacks_[index].seqn));
161         \}
162       \};
163   callbacks_.emplace\_back(index, decodeCompleteCB);
164 
165   \textcolor{comment}{// Assume that all packets with same encodeDelay will form a packet}
166   \textcolor{comment}{// train.  Encode them as a group, so can we can emulate packet}
167   \textcolor{comment}{// boundaries more realistically, telling the encoder which blocks}
168   \textcolor{comment}{// start such trains.}
169   \textcolor{keywordflow}{if} (scheme->packetIndices.size() > 0) \{
170     \textcolor{keyword}{auto} delayFromPrevious = encodeDelay - scheme->prev;
171     VLOG(1) << \textcolor{stringliteral}{"request "} << index << \textcolor{stringliteral}{" delay "} << delayFromPrevious.count();
172     \textcolor{keywordflow}{if} (delayFromPrevious > std::chrono::milliseconds(1)) \{
173       flushRequests(scheme);
174     \}
175   \}
176   scheme->prev = encodeDelay;
177   scheme->packetIndices.push\_back(index);
178 \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!callbacks\+\_\+@{callbacks\+\_\+}}
\index{callbacks\+\_\+@{callbacks\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{callbacks\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}std\+::vector$<${\bf Sim\+Streaming\+Callback}$>$ proxygen\+::compress\+::\+Compression\+Simulator\+::callbacks\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a4c6e0687998c74788b4a21c4edcff6d8}


Definition at line 70 of file Compression\+Simulator.\+h.

\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!domains\+\_\+@{domains\+\_\+}}
\index{domains\+\_\+@{domains\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{domains\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}std\+::unordered\+\_\+map$<$std\+::string, std\+::unique\+\_\+ptr$<${\bf Compression\+Scheme}$>$ $>$ proxygen\+::compress\+::\+Compression\+Simulator\+::domains\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a53051171a9727bfeb9f1566814b64b60}


Definition at line 69 of file Compression\+Simulator.\+h.

\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!event\+Base\+\_\+@{event\+Base\+\_\+}}
\index{event\+Base\+\_\+@{event\+Base\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{event\+Base\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}folly\+::\+Event\+Base proxygen\+::compress\+::\+Compression\+Simulator\+::event\+Base\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ac5749fb27acd9bfcb3cf75032e7103fb}


Definition at line 67 of file Compression\+Simulator.\+h.

\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!params\+\_\+@{params\+\_\+}}
\index{params\+\_\+@{params\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{params\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Sim\+Params} proxygen\+::compress\+::\+Compression\+Simulator\+::params\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_a9513db1985327332e7a9e87f708fa899}


Definition at line 65 of file Compression\+Simulator.\+h.

\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!requests\+\_\+@{requests\+\_\+}}
\index{requests\+\_\+@{requests\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{requests\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}std\+::vector$<${\bf proxygen\+::\+H\+T\+T\+P\+Message}$>$ proxygen\+::compress\+::\+Compression\+Simulator\+::requests\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ad3715b92b4caff88ff3cf9ca77f954b7}


Definition at line 66 of file Compression\+Simulator.\+h.

\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!rng\+\_\+@{rng\+\_\+}}
\index{rng\+\_\+@{rng\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{rng\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}folly\+::\+Random\+::\+Default\+Generator proxygen\+::compress\+::\+Compression\+Simulator\+::rng\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_ae668782e2b26f9ca6dd1cd8f5c6d5cc7}
{\bfseries Initial value\+:}
\begin{DoxyCode}
\{
      \textcolor{keyword}{static\_cast<}folly::Random::DefaultGenerator::result\_type\textcolor{keyword}{>}(params_.seed)\}
\end{DoxyCode}


Definition at line 71 of file Compression\+Simulator.\+h.

\index{proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}!stats\+\_\+@{stats\+\_\+}}
\index{stats\+\_\+@{stats\+\_\+}!proxygen\+::compress\+::\+Compression\+Simulator@{proxygen\+::compress\+::\+Compression\+Simulator}}
\subsubsection[{stats\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Sim\+Stats} proxygen\+::compress\+::\+Compression\+Simulator\+::stats\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1compress_1_1CompressionSimulator_aa38d3dd39bf4ad68347a3668899aa9ed}


Definition at line 73 of file Compression\+Simulator.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
proxygen/lib/http/codec/compress/experimental/simulator/{\bf Compression\+Simulator.\+h}\item 
proxygen/lib/http/codec/compress/experimental/simulator/{\bf Compression\+Simulator.\+cpp}\end{DoxyCompactItemize}
