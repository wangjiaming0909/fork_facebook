\section{H\+T\+T\+P\+Upstream\+Test$<$ C $>$ Class Template Reference}
\label{classHTTPUpstreamTest}\index{H\+T\+T\+P\+Upstream\+Test$<$ C $>$@{H\+T\+T\+P\+Upstream\+Test$<$ C $>$}}
Inheritance diagram for H\+T\+T\+P\+Upstream\+Test$<$ C $>$\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{classHTTPUpstreamTest}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf H\+T\+T\+P\+Upstream\+Test} (std\+::vector$<$ int64\+\_\+t $>$ flow\+Control=\{-\/1,-\/1,-\/1\})
\item 
void {\bf resume\+Writes} ()
\item 
virtual void {\bf on\+Write\+Chain} (folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$callback, std\+::shared\+\_\+ptr$<$ I\+O\+Buf $>$ iob, Write\+Flags)
\item 
void {\bf handle\+Write} (folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$callback)
\item 
void {\bf Set\+Up} () override
\item 
void {\bf common\+Set\+Up} (unique\+\_\+ptr$<$ {\bf H\+T\+T\+P\+Codec} $>$ codec)
\item 
unique\+\_\+ptr$<$ typename C\+::\+Codec $>$ {\bf make\+Server\+Codec} ()
\item 
void {\bf enable\+Ex\+Header} (typename C\+::\+Codec $\ast$server\+Codec)
\item 
void {\bf parse\+Output} ({\bf H\+T\+T\+P\+Codec} \&server\+Codec)
\item 
void {\bf read\+And\+Loop} (const std\+::string \&input)
\item 
void {\bf read\+And\+Loop} (I\+O\+Buf $\ast$buf)
\item 
void {\bf read\+And\+Loop} (const uint8\+\_\+t $\ast$input, size\+\_\+t length)
\item 
void {\bf test\+Basic\+Request} ()
\item 
void {\bf test\+Basic\+Request\+Http10} (bool keepalive)
\item 
void {\bf on\+Create} (const {\bf H\+T\+T\+P\+Session\+Base} \&) override
\item 
void {\bf on\+Destroy} (const {\bf H\+T\+T\+P\+Session\+Base} \&) override
\item 
void {\bf on\+Settings\+Outgoing\+Streams\+Full} (const {\bf H\+T\+T\+P\+Session\+Base} \&) override
\item 
void {\bf on\+Settings\+Outgoing\+Streams\+Not\+Full} (const {\bf H\+T\+T\+P\+Session\+Base} \&) override
\item 
void {\bf Tear\+Down} () override
\item 
std\+::unique\+\_\+ptr$<$ Strict\+Mock$<$ {\bf Mock\+H\+T\+T\+P\+Handler} $>$ $>$ {\bf open\+Transaction} (bool expect\+Start\+Paused=false)
\item 
std\+::unique\+\_\+ptr$<$ Nice\+Mock$<$ {\bf Mock\+H\+T\+T\+P\+Handler} $>$ $>$ {\bf open\+Nice\+Transaction} (bool expect\+Start\+Paused=false)
\item 
void {\bf test\+Simple\+Upgrade} (const std\+::string \&upgrade\+Req\+Header, const std\+::string \&upgrade\+Resp\+Header, {\bf Codec\+Protocol} resp\+Codec\+Version)
\item 
{\bf Mock\+Byte\+Event\+Tracker} $\ast$ {\bf set\+Mock\+Byte\+Event\+Tracker} ()
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
bool {\bf session\+Created\+\_\+} \{false\}
\item 
bool {\bf session\+Destroyed\+\_\+} \{false\}
\item 
bool {\bf transactions\+Full\+\_\+} \{false\}
\item 
bool {\bf transport\+Good\+\_\+} \{true\}
\item 
Event\+Base {\bf event\+Base\+\_\+}
\item 
Event\+Base $\ast$ {\bf event\+Base\+Ptr\+\_\+} \{\&{\bf event\+Base\+\_\+}\}
\item 
Mock\+Async\+Transport $\ast$ {\bf transport\+\_\+}
\item 
folly\+::\+Async\+Transport\+Wrapper\+::\+Read\+Callback $\ast$ {\bf read\+Callback\+\_\+} \{{\bf nullptr}\}
\item 
folly\+::\+Async\+Transport\+::\+Replay\+Safety\+Callback $\ast$ {\bf replay\+Safety\+Callback\+\_\+} \{{\bf nullptr}\}
\item 
folly\+::\+H\+H\+Wheel\+Timer\+::\+Unique\+Ptr {\bf transaction\+Timeouts\+\_\+}
\item 
std\+::vector$<$ int64\+\_\+t $>$ {\bf flow\+Control\+\_\+}
\item 
wangle\+::\+Transport\+Info {\bf mock\+Transport\+Info\+\_\+}
\item 
Socket\+Address {\bf local\+Addr\+\_\+} \{\char`\"{}127.\+0.\+0.\+1\char`\"{}, 80\}
\item 
Socket\+Address {\bf peer\+Addr\+\_\+} \{\char`\"{}127.\+0.\+0.\+1\char`\"{}, 12345\}
\item 
{\bf H\+T\+T\+P\+Upstream\+Session} $\ast$ {\bf http\+Session\+\_\+} \{{\bf nullptr}\}
\item 
I\+O\+Buf\+Queue {\bf writes\+\_\+} \{I\+O\+Buf\+Queue\+::cache\+Chain\+Length()\}
\item 
std\+::vector$<$ folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$ $>$ {\bf cbs\+\_\+}
\item 
bool {\bf fail\+Writes\+\_\+} \{false\}
\item 
bool {\bf pause\+Writes\+\_\+} \{false\}
\item 
bool {\bf write\+In\+Loop\+\_\+} \{false\}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\subsubsection*{template$<$class C$>$\\*
class H\+T\+T\+P\+Upstream\+Test$<$ C $>$}



Definition at line 136 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.



\subsection{Constructor \& Destructor Documentation}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{H\+T\+T\+P\+Upstream\+Test(std\+::vector$<$ int64\+\_\+t $>$ flow\+Control=\lcurly{}-\/1,-\/1,-\/1\rcurly{})}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::{\bf H\+T\+T\+P\+Upstream\+Test} (
\begin{DoxyParamCaption}
\item[{std\+::vector$<$ int64\+\_\+t $>$}]{flow\+Control = {\ttfamily \{-\/1,~-\/1,~-\/1\}}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [explicit]}}\label{classHTTPUpstreamTest_a0d6bb35edbf07c8c50706da8019553d8}


Definition at line 139 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
139                                                              \{-1, -1, -1\})
140       : eventBase_(),
141         transport_(\textcolor{keyword}{new} NiceMock<MockAsyncTransport>()),
142         transactionTimeouts_(folly::HHWheelTimer::newTimer(
143             &eventBase_,
144             std::chrono::milliseconds(
145                 folly::HHWheelTimer::DEFAULT\_TICK\_INTERVAL),
146             TimeoutManager::InternalEnum::INTERNAL,
147             std::chrono::milliseconds(500))),
148         flowControl_(flowControl) \{\}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!common\+Set\+Up@{common\+Set\+Up}}
\index{common\+Set\+Up@{common\+Set\+Up}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{common\+Set\+Up(unique\+\_\+ptr$<$ H\+T\+T\+P\+Codec $>$ codec)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::common\+Set\+Up (
\begin{DoxyParamCaption}
\item[{unique\+\_\+ptr$<$ {\bf H\+T\+T\+P\+Codec} $>$}]{codec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a33b83a83d2659bd5b408008dcb0875b3}


Definition at line 191 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
191                                                 \{
192     HTTPSession::setDefaultReadBufferLimit(65536);
193     HTTPSession::setDefaultWriteBufferLimit(65536);
194     EXPECT\_CALL(*transport_, writeChain(\_, \_, \_))
195       .WillRepeatedly(Invoke(\textcolor{keyword}{this}, &HTTPUpstreamTest<C>::onWriteChain));
196     EXPECT\_CALL(*transport_, setReadCB(\_))
197       .WillRepeatedly(SaveArg<0>(&readCallback_));
198     EXPECT\_CALL(*transport_, getReadCB())
199       .WillRepeatedly(Return(readCallback_));
200     EXPECT\_CALL(*transport_, getEventBase())
201       .WillRepeatedly(ReturnPointee(&eventBasePtr_));
202     EXPECT\_CALL(*transport_, good())
203       .WillRepeatedly(ReturnPointee(&transportGood_));
204     EXPECT\_CALL(*transport_, closeNow())
205       .WillRepeatedly(Assign(&transportGood_, \textcolor{keyword}{false}));
206     EXPECT\_CALL(*transport_, isReplaySafe())
207       .WillOnce(Return(\textcolor{keyword}{false}));
208     EXPECT\_CALL(*transport_, setReplaySafetyCallback(\_))
209       .WillRepeatedly(SaveArg<0>(&replaySafetyCallback_));
210     EXPECT\_CALL(*transport_, attachEventBase(\_))
211       .WillRepeatedly(SaveArg<0>(&eventBasePtr_));
212 
213     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& param: flowControl_) \{
214       \textcolor{keywordflow}{if} (param < 0) \{
215         param = codec->getDefaultWindowSize();
216       \}
217     \}
218     httpSession_ = \textcolor{keyword}{new} HTTPUpstreamSession(
219       transactionTimeouts_.get(),
220       std::move(AsyncTransportWrapper::UniquePtr(transport_)),
221       localAddr_, peerAddr_,
222       std::move(codec),
223       mockTransportInfo_, \textcolor{keyword}{this});
224     httpSession_->setFlowControl(flowControl\_[0], flowControl\_[1],
225                                  flowControl\_[2]);
226     httpSession_->setMaxConcurrentOutgoingStreams(10);
227     httpSession_->setEgressSettings(\{\{SettingsId::ENABLE\_EX\_HEADERS, 1\}\});
228     httpSession_->startNow();
229     eventBase_.loop();
230     ASSERT\_EQ(this->sessionDestroyed_, \textcolor{keyword}{false});
231   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!enable\+Ex\+Header@{enable\+Ex\+Header}}
\index{enable\+Ex\+Header@{enable\+Ex\+Header}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{enable\+Ex\+Header(typename C\+::\+Codec $\ast$server\+Codec)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::enable\+Ex\+Header (
\begin{DoxyParamCaption}
\item[{typename C\+::\+Codec $\ast$}]{server\+Codec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a258efc11113e394ccd1a0377c608cd64}


Definition at line 237 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
237                                                    \{
238     \textcolor{keywordflow}{if} (!serverCodec || serverCodec->getProtocol() != CodecProtocol::HTTP\_2) \{
239       \textcolor{keywordflow}{return};
240     \}
241 
242     \textcolor{keyword}{auto} clientCodec = makeClientCodec<HTTP2Codec>(2);
243     folly::IOBufQueue c2s\{IOBufQueue::cacheChainLength()\};
244     clientCodec->getEgressSettings()->setSetting(
245       SettingsId::ENABLE\_EX\_HEADERS, 1);
246     clientCodec->generateConnectionPreface(c2s);
247     clientCodec->generateSettings(c2s);
248 
249     \textcolor{comment}{// set ENABLE\_EX\_HEADERS to 1 in egressSettings}
250     serverCodec->getEgressSettings()->setSetting(
251       SettingsId::ENABLE\_EX\_HEADERS, 1);
252     \textcolor{comment}{// set ENABLE\_EX\_HEADERS to 1 in ingressSettings}
253     \textcolor{keyword}{auto} setup = c2s.move();
254     serverCodec->onIngress(*setup);
255   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!handle\+Write@{handle\+Write}}
\index{handle\+Write@{handle\+Write}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{handle\+Write(folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$callback)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::handle\+Write (
\begin{DoxyParamCaption}
\item[{folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$}]{callback}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a67024a430c2c5eb92f3c08895a671ae0}


Definition at line 172 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
172                                                                       \{
173     \textcolor{keywordflow}{if} (failWrites_) \{
174       AsyncSocketException ex(AsyncSocketException::UNKNOWN, \textcolor{stringliteral}{""});
175       callback->writeErr(0, ex);
176     \} \textcolor{keywordflow}{else} \{
177       \textcolor{keywordflow}{if} (writeInLoop_) \{
178         eventBase_.runInLoop([&] \{
179             callback->writeSuccess();
180           \});
181       \} \textcolor{keywordflow}{else} \{
182         callback->writeSuccess();
183       \}
184     \}
185   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!make\+Server\+Codec@{make\+Server\+Codec}}
\index{make\+Server\+Codec@{make\+Server\+Codec}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{make\+Server\+Codec()}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ unique\+\_\+ptr$<$typename C\+::\+Codec$>$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::make\+Server\+Codec (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a34653b8214e4be5f65e9d13da977302a}


Definition at line 233 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
233                                                 \{
234     return ::makeServerCodec<typename C::Codec>(C::version);
235   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!on\+Create@{on\+Create}}
\index{on\+Create@{on\+Create}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{on\+Create(const H\+T\+T\+P\+Session\+Base \&) override}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::on\+Create (
\begin{DoxyParamCaption}
\item[{const {\bf H\+T\+T\+P\+Session\+Base} \&}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}\label{classHTTPUpstreamTest_a9010c9ec904d835c7f0bd7bffcd22a0d}


Reimplemented from {\bf proxygen\+::\+H\+T\+T\+P\+Session\+Base\+::\+Info\+Callback} \doxyref{}{p.}{classproxygen_1_1HTTPSessionBase_1_1InfoCallback_a27acbef9ecf909890c4036377bc54cbb}.



Definition at line 297 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
297 \{ sessionCreated_ = \textcolor{keyword}{true}; \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!on\+Destroy@{on\+Destroy}}
\index{on\+Destroy@{on\+Destroy}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{on\+Destroy(const H\+T\+T\+P\+Session\+Base \&) override}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::on\+Destroy (
\begin{DoxyParamCaption}
\item[{const {\bf H\+T\+T\+P\+Session\+Base} \&}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}\label{classHTTPUpstreamTest_a971e5079096fac8e820e03e1905f8317}


Reimplemented from {\bf proxygen\+::\+H\+T\+T\+P\+Session\+Base\+::\+Info\+Callback} \doxyref{}{p.}{classproxygen_1_1HTTPSessionBase_1_1InfoCallback_a0b615d9fcea3810dc6b0b7c9a0c453c6}.



Definition at line 298 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
298 \{ sessionDestroyed_ = \textcolor{keyword}{true}; \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!on\+Settings\+Outgoing\+Streams\+Full@{on\+Settings\+Outgoing\+Streams\+Full}}
\index{on\+Settings\+Outgoing\+Streams\+Full@{on\+Settings\+Outgoing\+Streams\+Full}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{on\+Settings\+Outgoing\+Streams\+Full(const H\+T\+T\+P\+Session\+Base \&) override}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::on\+Settings\+Outgoing\+Streams\+Full (
\begin{DoxyParamCaption}
\item[{const {\bf H\+T\+T\+P\+Session\+Base} \&}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}\label{classHTTPUpstreamTest_a89e02ba4c54b68b2e19f349af5223624}


Reimplemented from {\bf proxygen\+::\+H\+T\+T\+P\+Session\+Base\+::\+Info\+Callback} \doxyref{}{p.}{classproxygen_1_1HTTPSessionBase_1_1InfoCallback_ac0b777230749faa0889d7f3db1461c7a}.



Definition at line 299 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
299                                                                       \{
300     transactionsFull_ = \textcolor{keyword}{true};
301   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!on\+Settings\+Outgoing\+Streams\+Not\+Full@{on\+Settings\+Outgoing\+Streams\+Not\+Full}}
\index{on\+Settings\+Outgoing\+Streams\+Not\+Full@{on\+Settings\+Outgoing\+Streams\+Not\+Full}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{on\+Settings\+Outgoing\+Streams\+Not\+Full(const H\+T\+T\+P\+Session\+Base \&) override}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::on\+Settings\+Outgoing\+Streams\+Not\+Full (
\begin{DoxyParamCaption}
\item[{const {\bf H\+T\+T\+P\+Session\+Base} \&}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}\label{classHTTPUpstreamTest_af935e61c7c8338760d0dcfe1c5e1510e}


Reimplemented from {\bf proxygen\+::\+H\+T\+T\+P\+Session\+Base\+::\+Info\+Callback} \doxyref{}{p.}{classproxygen_1_1HTTPSessionBase_1_1InfoCallback_ad709a8213d1fdb58253711c53bf387d3}.



Definition at line 302 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
302                                                                          \{
303     transactionsFull_ = \textcolor{keyword}{false};
304   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!on\+Write\+Chain@{on\+Write\+Chain}}
\index{on\+Write\+Chain@{on\+Write\+Chain}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{on\+Write\+Chain(folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$callback, std\+::shared\+\_\+ptr$<$ I\+O\+Buf $>$ iob, Write\+Flags)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ virtual void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::on\+Write\+Chain (
\begin{DoxyParamCaption}
\item[{folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback $\ast$}]{callback, }
\item[{std\+::shared\+\_\+ptr$<$ I\+O\+Buf $>$}]{iob, }
\item[{Write\+Flags}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\label{classHTTPUpstreamTest_ae4dd4ff4f4fb988e601884bad097a4f5}


Reimplemented in {\bf No\+Flush\+Upstream\+Session\+Test} \doxyref{}{p.}{classNoFlushUpstreamSessionTest_a52ffb620bb37eadacc8bc95c99d65869}.



Definition at line 158 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
161                   \{
162     \textcolor{keywordflow}{if} (pauseWrites_) \{
163       cbs_.push\_back(callback);
164       \textcolor{keywordflow}{return};  \textcolor{comment}{// let write requests timeout}
165     \}
166     \textcolor{keyword}{auto} mybuf = iob->clone();
167     mybuf->unshare();
168     writes_.append(std::move(mybuf));
169     handleWrite(callback);
170   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!open\+Nice\+Transaction@{open\+Nice\+Transaction}}
\index{open\+Nice\+Transaction@{open\+Nice\+Transaction}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{open\+Nice\+Transaction(bool expect\+Start\+Paused=false)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ std\+::unique\+\_\+ptr$<$Nice\+Mock$<${\bf Mock\+H\+T\+T\+P\+Handler}$>$ $>$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::open\+Nice\+Transaction (
\begin{DoxyParamCaption}
\item[{bool}]{expect\+Start\+Paused = {\ttfamily false}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a8e98ba0aa12a6351fad73405d2f67f39}


Definition at line 326 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
327                                     \{
328     \textcolor{comment}{// Returns a mock handler with txn\_ field set in it}
329     \textcolor{keyword}{auto} handler = std::make\_unique<NiceMock<MockHTTPHandler>>();
330     handler->expectTransaction();
331     \textcolor{keywordflow}{if} (expectStartPaused) \{
332       handler->expectEgressPaused();
333     \}
334     \textcolor{keyword}{auto} txn = httpSession_->newTransaction(handler.get());
335     EXPECT\_EQ(txn, handler->txn\_);
336     \textcolor{keywordflow}{return} handler;
337   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!open\+Transaction@{open\+Transaction}}
\index{open\+Transaction@{open\+Transaction}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{open\+Transaction(bool expect\+Start\+Paused=false)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ std\+::unique\+\_\+ptr$<$Strict\+Mock$<${\bf Mock\+H\+T\+T\+P\+Handler}$>$ $>$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::open\+Transaction (
\begin{DoxyParamCaption}
\item[{bool}]{expect\+Start\+Paused = {\ttfamily false}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a61dbe7c21b4e121fb83ccf0368d94795}


Definition at line 313 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
314                                     \{
315     \textcolor{comment}{// Returns a mock handler with txn\_ field set in it}
316     \textcolor{keyword}{auto} handler = std::make\_unique<StrictMock<MockHTTPHandler>>();
317     handler->expectTransaction();
318     \textcolor{keywordflow}{if} (expectStartPaused) \{
319       handler->expectEgressPaused();
320     \}
321     \textcolor{keyword}{auto} txn = httpSession_->newTransaction(handler.get());
322     EXPECT\_EQ(txn, handler->txn\_);
323     \textcolor{keywordflow}{return} handler;
324   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!parse\+Output@{parse\+Output}}
\index{parse\+Output@{parse\+Output}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{parse\+Output(\+H\+T\+T\+P\+Codec \&server\+Codec)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::parse\+Output (
\begin{DoxyParamCaption}
\item[{{\bf H\+T\+T\+P\+Codec} \&}]{server\+Codec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_ac8399e65970f9908e88e36f971518405}


Definition at line 257 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
257                                            \{
258     uint32\_t consumed = std::numeric\_limits<uint32\_t>::max();
259     \textcolor{keywordflow}{while} (!writes_.empty() && consumed > 0) \{
260       consumed = serverCodec.onIngress(*writes_.front());
261       writes_.split(consumed);
262     \}
263     EXPECT\_TRUE(writes_.empty());
264   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!read\+And\+Loop@{read\+And\+Loop}}
\index{read\+And\+Loop@{read\+And\+Loop}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{read\+And\+Loop(const std\+::string \&input)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::read\+And\+Loop (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{input}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a906b4b0b378f28f3fea8d4d3741cdbb7}


Definition at line 266 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
266                                            \{
267     readAndLoop((\textcolor{keyword}{const} uint8\_t *)input.data(), input.length());
268   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!read\+And\+Loop@{read\+And\+Loop}}
\index{read\+And\+Loop@{read\+And\+Loop}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{read\+And\+Loop(\+I\+O\+Buf $\ast$buf)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::read\+And\+Loop (
\begin{DoxyParamCaption}
\item[{I\+O\+Buf $\ast$}]{buf}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a647c483be232f8c4d48252e2a4d9d371}


Definition at line 270 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
270                                \{
271     buf->coalesce();
272     readAndLoop(buf->data(), buf->length());
273   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!read\+And\+Loop@{read\+And\+Loop}}
\index{read\+And\+Loop@{read\+And\+Loop}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{read\+And\+Loop(const uint8\+\_\+t $\ast$input, size\+\_\+t length)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::read\+And\+Loop (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{input, }
\item[{size\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_ab4a570f27dbc2a8fb35d13d893acab83}


Definition at line 275 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
275                                                         \{
276     CHECK\_NOTNULL(readCallback_);
277     \textcolor{keywordtype}{void}* buf;
278     \textcolor{keywordtype}{size\_t} bufSize;
279     \textcolor{keywordflow}{while} (length > 0) \{
280       readCallback_->getReadBuffer(&buf, &bufSize);
281       \textcolor{comment}{// This is somewhat specific to our implementation, but currently we}
282       \textcolor{comment}{// always return at least some space from getReadBuffer}
283       CHECK\_GT(bufSize, 0);
284       bufSize = std::min(bufSize, length);
285       memcpy(buf, input, bufSize);
286       readCallback_->readDataAvailable(bufSize);
287       eventBasePtr_->loop();
288       length -= bufSize;
289       input += bufSize;
290     \}
291   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!resume\+Writes@{resume\+Writes}}
\index{resume\+Writes@{resume\+Writes}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{resume\+Writes()}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::resume\+Writes (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a9b9fe3fe7f28f2c30c688346c6ce0242}


Definition at line 150 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
150                       \{
151     pauseWrites_ = \textcolor{keyword}{false};
152     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} cb: cbs_) \{
153       handleWrite(cb);
154     \}
155     cbs\_.clear();
156   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!set\+Mock\+Byte\+Event\+Tracker@{set\+Mock\+Byte\+Event\+Tracker}}
\index{set\+Mock\+Byte\+Event\+Tracker@{set\+Mock\+Byte\+Event\+Tracker}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{set\+Mock\+Byte\+Event\+Tracker()}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ {\bf Mock\+Byte\+Event\+Tracker}$\ast$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::set\+Mock\+Byte\+Event\+Tracker (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classHTTPUpstreamTest_a27aa49848cf4a7b833b90305d9af658a}


Definition at line 343 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
343                                                   \{
344     \textcolor{keyword}{auto} byteEventTracker = \textcolor{keyword}{new} MockByteEventTracker(\textcolor{keyword}{nullptr});
345     httpSession_->setByteEventTracker(
346       std::unique\_ptr<ByteEventTracker>(byteEventTracker));
347     EXPECT\_CALL(*byteEventTracker, preSend(\_, \_, \_))
348       .WillRepeatedly(Return(0));
349     EXPECT\_CALL(*byteEventTracker, drainByteEvents())
350       .WillRepeatedly(Return(0));
351     EXPECT\_CALL(*byteEventTracker, processByteEvents(\_, \_))
352       .WillRepeatedly(Invoke([]
353                             (std::shared\_ptr<ByteEventTracker> \textcolor{keyword}{self},
354                              uint64\_t bytesWritten) \{
355                               \textcolor{keywordflow}{return} \textcolor{keyword}{self}->ByteEventTracker::processByteEvents(
356                                 \textcolor{keyword}{self},
357                                 bytesWritten);
358                             \}));
359 
360     \textcolor{keywordflow}{return} byteEventTracker;
361   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!Set\+Up@{Set\+Up}}
\index{Set\+Up@{Set\+Up}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{Set\+Up() override}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::Set\+Up (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}\label{classHTTPUpstreamTest_ab3cfb6505cbc2c20cc3f98afbb6d9a57}


Definition at line 187 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
187                         \{
188     commonSetUp(makeClientCodec<typename C::Codec>(C::version));
189   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!Tear\+Down@{Tear\+Down}}
\index{Tear\+Down@{Tear\+Down}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{Tear\+Down() override}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::Tear\+Down (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}\label{classHTTPUpstreamTest_ab6ef22bfdc7dceab55f313137b7938ef}


Definition at line 306 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
306                            \{
307     AsyncSocketException ex(AsyncSocketException::UNKNOWN, \textcolor{stringliteral}{""});
308     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& cb : cbs_) \{
309       cb->writeErr(0, ex);
310     \}
311   \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!test\+Basic\+Request@{test\+Basic\+Request}}
\index{test\+Basic\+Request@{test\+Basic\+Request}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{test\+Basic\+Request()}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class Codec\+Pair $>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ Codec\+Pair $>$\+::test\+Basic\+Request (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classHTTPUpstreamTest_a4068088ae98c6f845f286256d0fda860}


Definition at line 1028 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.


\begin{DoxyCode}
1028                                                    \{
1029   InSequence enforceOrder;
1030 
1031   \textcolor{keyword}{auto} handler = openTransaction();
1032   handler->expectHeaders([&] (std::shared\_ptr<HTTPMessage> msg) \{
1033       EXPECT\_TRUE(msg->getIsChunked());
1034       EXPECT\_FALSE(msg->getIsUpgraded());
1035       EXPECT\_EQ(200, msg->getStatusCode());
1036     \});
1037   handler->expectEOM();
1038   handler->expectDetachTransaction();
1039 
1040   handler->sendRequest();
1041   readAndLoop(\textcolor{stringliteral}{"HTTP/1.1 200 OK\(\backslash\)r\(\backslash\)n"}
1042               \textcolor{stringliteral}{"Transfer-Encoding: chunked\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"}
1043               \textcolor{stringliteral}{"0\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"});
1044 
1045   CHECK(httpSession_->supportsMoreTransactions());
1046   CHECK\_EQ(httpSession_->getNumOutgoingStreams(), 0);
1047 \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!test\+Basic\+Request\+Http10@{test\+Basic\+Request\+Http10}}
\index{test\+Basic\+Request\+Http10@{test\+Basic\+Request\+Http10}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{test\+Basic\+Request\+Http10(bool keepalive)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class Codec\+Pair $>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ Codec\+Pair $>$\+::test\+Basic\+Request\+Http10 (
\begin{DoxyParamCaption}
\item[{bool}]{keepalive}
\end{DoxyParamCaption}
)}\label{classHTTPUpstreamTest_a14707de28ac2be14762c3c53cb3a121b}


Definition at line 1099 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.



References proxygen\+::get\+Get\+Request(), proxygen\+::\+H\+T\+T\+P\+Message\+::get\+Headers(), proxygen\+::\+H\+T\+T\+P\+Headers\+::set(), and proxygen\+::\+H\+T\+T\+P\+Message\+::set\+H\+T\+T\+P\+Version().


\begin{DoxyCode}
1099                                                                        \{
1100   HTTPMessage req = getGetRequest();
1101   req.setHTTPVersion(1, 0);
1102   \textcolor{keywordflow}{if} (keepalive) \{
1103     req.getHeaders().set(HTTP\_HEADER\_CONNECTION, \textcolor{stringliteral}{"Keep-Alive"});
1104   \}
1105 
1106   InSequence enforceOrder;
1107 
1108   \textcolor{keyword}{auto} handler = openTransaction();
1109   handler->expectHeaders([&] (std::shared\_ptr<HTTPMessage> msg) \{
1110       EXPECT\_EQ(200, msg->getStatusCode());
1111       EXPECT\_EQ(keepalive ? \textcolor{stringliteral}{"keep-alive"} : \textcolor{stringliteral}{"close"},
1112                 msg->getHeaders().getSingleOrEmpty(HTTP\_HEADER\_CONNECTION));
1113     \});
1114   EXPECT\_CALL(*handler, onBody(\_));
1115   handler->expectEOM();
1116   handler->expectDetachTransaction();
1117 
1118   handler->sendRequest();
1119   \textcolor{keywordflow}{if} (keepalive) \{
1120     readAndLoop(\textcolor{stringliteral}{"HTTP/1.0 200 OK\(\backslash\)r\(\backslash\)n"}
1121                 \textcolor{stringliteral}{"Connection: keep-alive\(\backslash\)r\(\backslash\)n"}
1122                 \textcolor{stringliteral}{"Content-length: 7\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"}
1123                 \textcolor{stringliteral}{"content"});
1124   \} \textcolor{keywordflow}{else} \{
1125     readAndLoop(\textcolor{stringliteral}{"HTTP/1.0 200 OK\(\backslash\)r\(\backslash\)n"}
1126                 \textcolor{stringliteral}{"Connection: close\(\backslash\)r\(\backslash\)n"}
1127                 \textcolor{stringliteral}{"Content-length: 7\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"}
1128                 \textcolor{stringliteral}{"content"});
1129   \}
1130 \}
\end{DoxyCode}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!test\+Simple\+Upgrade@{test\+Simple\+Upgrade}}
\index{test\+Simple\+Upgrade@{test\+Simple\+Upgrade}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{test\+Simple\+Upgrade(const std\+::string \&upgrade\+Req\+Header, const std\+::string \&upgrade\+Resp\+Header, Codec\+Protocol resp\+Codec\+Version)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class Codec\+Pair $>$ void {\bf H\+T\+T\+P\+Upstream\+Test}$<$ Codec\+Pair $>$\+::test\+Simple\+Upgrade (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{upgrade\+Req\+Header, }
\item[{const std\+::string \&}]{upgrade\+Resp\+Header, }
\item[{{\bf Codec\+Protocol}}]{resp\+Codec\+Version}
\end{DoxyParamCaption}
)}\label{classHTTPUpstreamTest_a06ae2dd4a4edeace8512689f30c62220}


Definition at line 1422 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.



References proxygen\+::\+H\+T\+T\+P2\+Codec\+::get\+Header\+Indexing\+Strategy(), and proxygen\+::get\+Upgrade\+Request().


\begin{DoxyCode}
1425                                   \{
1426   InSequence dummy;
1427   \textcolor{keyword}{auto} handler = openTransaction();
1428   NiceMock<MockUpstreamController> controller;
1429 
1430   httpSession_->setController(&controller);
1431   EXPECT\_CALL(controller, onSessionCodecChange(httpSession_));
1432 
1433   EXPECT\_EQ(httpSession_->getMaxConcurrentOutgoingStreams(), 1);
1434 
1435   HeaderIndexingStrategy testH2IndexingStrat;
1436   \textcolor{keywordflow}{if} (respCodecVersion == CodecProtocol::HTTP\_2) \{
1437     EXPECT\_CALL(controller, getHeaderIndexingStrategy())
1438       .WillOnce(
1439         Return(&testH2IndexingStrat)
1440     );
1441   \}
1442 
1443   handler->expectHeaders([] (std::shared\_ptr<HTTPMessage> msg) \{
1444       EXPECT\_EQ(200, msg->getStatusCode());
1445     \});
1446   handler->expectBody();
1447   handler->expectEOM();
1448   handler->expectDetachTransaction();
1449 
1450   \textcolor{keyword}{auto} txn = handler->txn\_;
1451   HTTPMessage req = getUpgradeRequest(upgradeReqHeader);
1452   txn->sendHeaders(req);
1453   txn->sendEOM();
1454   eventBase_.loopOnce(); \textcolor{comment}{// force HTTP/1.1 writes}
1455   writes_.move(); \textcolor{comment}{// clear them out}
1456   readAndLoop(folly::to<string>(\textcolor{stringliteral}{"HTTP/1.1 101 Switching Protocols\(\backslash\)r\(\backslash\)n"}
1457                                 \textcolor{stringliteral}{"Upgrade: "}, upgradeRespHeader, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}
1458                                 \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}));
1459 
1460   \textcolor{keywordflow}{if} (respCodecVersion == CodecProtocol::HTTP\_2) \{
1461     \textcolor{keyword}{const} HTTP2Codec* codec = \textcolor{keyword}{dynamic\_cast<}\textcolor{keyword}{const }HTTP2Codec*\textcolor{keyword}{>}(
1462       &txn->getTransport().getCodec());
1463     ASSERT\_NE(codec, \textcolor{keyword}{nullptr});
1464     EXPECT\_EQ(codec->getHeaderIndexingStrategy(), &testH2IndexingStrat);
1465   \}
1466 
1467   readAndLoop(getResponseBuf(respCodecVersion, txn->getID(), 200, 100).\textcolor{keyword}{get}());
1468 
1469   EXPECT\_EQ(httpSession_->getMaxConcurrentOutgoingStreams(), 10);
1470   httpSession_->destroy();
1471 \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!cbs\+\_\+@{cbs\+\_\+}}
\index{cbs\+\_\+@{cbs\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{cbs\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ std\+::vector$<$folly\+::\+Async\+Transport\+Wrapper\+::\+Write\+Callback$\ast$$>$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::cbs\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a3d4e6ba9d3ae37919979742d95aa2b02}


Definition at line 382 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!event\+Base\+\_\+@{event\+Base\+\_\+}}
\index{event\+Base\+\_\+@{event\+Base\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{event\+Base\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ Event\+Base {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::event\+Base\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a39194e1be3b673ffe2937709b6e7be9b}


Definition at line 370 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!event\+Base\+Ptr\+\_\+@{event\+Base\+Ptr\+\_\+}}
\index{event\+Base\+Ptr\+\_\+@{event\+Base\+Ptr\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{event\+Base\+Ptr\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ Event\+Base$\ast$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::event\+Base\+Ptr\+\_\+ \{\&{\bf event\+Base\+\_\+}\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a067f2d29379585e6060ad2250add150a}


Definition at line 371 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!fail\+Writes\+\_\+@{fail\+Writes\+\_\+}}
\index{fail\+Writes\+\_\+@{fail\+Writes\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{fail\+Writes\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::fail\+Writes\+\_\+ \{false\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a40f2441a4f2bce6200d293ed0982b146}


Definition at line 383 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!flow\+Control\+\_\+@{flow\+Control\+\_\+}}
\index{flow\+Control\+\_\+@{flow\+Control\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{flow\+Control\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ std\+::vector$<$int64\+\_\+t$>$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::flow\+Control\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a0d6c7f280ccc778f763b051893517717}


Definition at line 376 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!http\+Session\+\_\+@{http\+Session\+\_\+}}
\index{http\+Session\+\_\+@{http\+Session\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{http\+Session\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ {\bf H\+T\+T\+P\+Upstream\+Session}$\ast$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::http\+Session\+\_\+ \{{\bf nullptr}\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_aeaf08f0298c09202165e54d016b13bf5}


Definition at line 380 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!local\+Addr\+\_\+@{local\+Addr\+\_\+}}
\index{local\+Addr\+\_\+@{local\+Addr\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{local\+Addr\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ Socket\+Address {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::local\+Addr\+\_\+ \{\char`\"{}127.\+0.\+0.\+1\char`\"{}, 80\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a32d1b97ddb0ae57563f53f28dc7e7a4a}


Definition at line 378 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!mock\+Transport\+Info\+\_\+@{mock\+Transport\+Info\+\_\+}}
\index{mock\+Transport\+Info\+\_\+@{mock\+Transport\+Info\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{mock\+Transport\+Info\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ wangle\+::\+Transport\+Info {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::mock\+Transport\+Info\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a3dfb5eb28336737bc26f6d81fe094a3e}


Definition at line 377 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!pause\+Writes\+\_\+@{pause\+Writes\+\_\+}}
\index{pause\+Writes\+\_\+@{pause\+Writes\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{pause\+Writes\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::pause\+Writes\+\_\+ \{false\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a17a45c49a5f61fc01c3afaf3a215da56}


Definition at line 384 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!peer\+Addr\+\_\+@{peer\+Addr\+\_\+}}
\index{peer\+Addr\+\_\+@{peer\+Addr\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{peer\+Addr\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ Socket\+Address {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::peer\+Addr\+\_\+ \{\char`\"{}127.\+0.\+0.\+1\char`\"{}, 12345\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a73093897e1d5e6fb0b2e1020ccb188e7}


Definition at line 379 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!read\+Callback\+\_\+@{read\+Callback\+\_\+}}
\index{read\+Callback\+\_\+@{read\+Callback\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{read\+Callback\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ folly\+::\+Async\+Transport\+Wrapper\+::\+Read\+Callback$\ast$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::read\+Callback\+\_\+ \{{\bf nullptr}\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a36d981daa5869ffd4b93df34ec0fe34d}


Definition at line 373 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!replay\+Safety\+Callback\+\_\+@{replay\+Safety\+Callback\+\_\+}}
\index{replay\+Safety\+Callback\+\_\+@{replay\+Safety\+Callback\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{replay\+Safety\+Callback\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ folly\+::\+Async\+Transport\+::\+Replay\+Safety\+Callback$\ast$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::replay\+Safety\+Callback\+\_\+ \{{\bf nullptr}\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_af3ea8f6cab67a26770cdda5ace12f5b0}


Definition at line 374 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!session\+Created\+\_\+@{session\+Created\+\_\+}}
\index{session\+Created\+\_\+@{session\+Created\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{session\+Created\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::session\+Created\+\_\+ \{false\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a3f6525ef28b235a3cbb4f82c6bbc7728}


Definition at line 364 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!session\+Destroyed\+\_\+@{session\+Destroyed\+\_\+}}
\index{session\+Destroyed\+\_\+@{session\+Destroyed\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{session\+Destroyed\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::session\+Destroyed\+\_\+ \{false\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a1307c844e81f38400133f53b1d58e8df}


Definition at line 365 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!transactions\+Full\+\_\+@{transactions\+Full\+\_\+}}
\index{transactions\+Full\+\_\+@{transactions\+Full\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{transactions\+Full\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::transactions\+Full\+\_\+ \{false\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a5bcfa3057d82ff368b850c55644f47a2}


Definition at line 367 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!transaction\+Timeouts\+\_\+@{transaction\+Timeouts\+\_\+}}
\index{transaction\+Timeouts\+\_\+@{transaction\+Timeouts\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{transaction\+Timeouts\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ folly\+::\+H\+H\+Wheel\+Timer\+::\+Unique\+Ptr {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::transaction\+Timeouts\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a0ae16155503f6c992a05ff873892f626}


Definition at line 375 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!transport\+\_\+@{transport\+\_\+}}
\index{transport\+\_\+@{transport\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{transport\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ Mock\+Async\+Transport$\ast$ {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::transport\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a25f537c3b9749f72c8454f463e847125}


Definition at line 372 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!transport\+Good\+\_\+@{transport\+Good\+\_\+}}
\index{transport\+Good\+\_\+@{transport\+Good\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{transport\+Good\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::transport\+Good\+\_\+ \{true\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a5907b36aa8d9c7f06a4c10815f746210}


Definition at line 368 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!write\+In\+Loop\+\_\+@{write\+In\+Loop\+\_\+}}
\index{write\+In\+Loop\+\_\+@{write\+In\+Loop\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{write\+In\+Loop\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ bool {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::write\+In\+Loop\+\_\+ \{false\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_a9138768229d24af5745c33a0c64f88d1}


Definition at line 385 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.

\index{H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}!writes\+\_\+@{writes\+\_\+}}
\index{writes\+\_\+@{writes\+\_\+}!H\+T\+T\+P\+Upstream\+Test@{H\+T\+T\+P\+Upstream\+Test}}
\subsubsection[{writes\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class C$>$ I\+O\+Buf\+Queue {\bf H\+T\+T\+P\+Upstream\+Test}$<$ C $>$\+::writes\+\_\+ \{I\+O\+Buf\+Queue\+::cache\+Chain\+Length()\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classHTTPUpstreamTest_afbc6afdd7140041cc1aa4bc38b54b64d}


Definition at line 381 of file H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
proxygen/lib/http/session/test/{\bf H\+T\+T\+P\+Upstream\+Session\+Test.\+cpp}\end{DoxyCompactItemize}
