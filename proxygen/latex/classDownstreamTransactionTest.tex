\section{Downstream\+Transaction\+Test Class Reference}
\label{classDownstreamTransactionTest}\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
Inheritance diagram for Downstream\+Transaction\+Test\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classDownstreamTransactionTest}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf Downstream\+Transaction\+Test} ()
\item 
void {\bf Set\+Up} () override
\item 
void {\bf setup\+Request\+Response\+Flow} ({\bf H\+T\+T\+P\+Transaction} $\ast$txn, uint32\+\_\+t size, bool delay\+Response=false)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
folly\+::\+Event\+Base {\bf event\+Base\+\_\+}
\item 
folly\+::\+H\+H\+Wheel\+Timer\+::\+Unique\+Ptr {\bf transaction\+Timeouts\+\_\+}
\item 
{\bf Mock\+H\+T\+T\+P\+Transaction\+Transport} {\bf transport\+\_\+}
\item 
Strict\+Mock$<$ {\bf Mock\+H\+T\+T\+P\+Handler} $>$ {\bf handler\+\_\+}
\item 
{\bf H\+T\+T\+P2\+Priority\+Queue} {\bf txn\+Egress\+Queue\+\_\+}
\item 
uint32\+\_\+t {\bf received\+\_\+} \{0\}
\item 
uint32\+\_\+t {\bf sent\+\_\+} \{0\}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 30 of file Downstream\+Transaction\+Test.\+cpp.



\subsection{Constructor \& Destructor Documentation}
\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{Downstream\+Transaction\+Test()}]{\setlength{\rightskip}{0pt plus 5cm}Downstream\+Transaction\+Test\+::\+Downstream\+Transaction\+Test (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classDownstreamTransactionTest_a263c12154b7ab0c5b23598f826933f1c}


Definition at line 32 of file Downstream\+Transaction\+Test.\+cpp.


\begin{DoxyCode}
32 \{\}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!Set\+Up@{Set\+Up}}
\index{Set\+Up@{Set\+Up}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{Set\+Up() override}]{\setlength{\rightskip}{0pt plus 5cm}void Downstream\+Transaction\+Test\+::\+Set\+Up (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}\label{classDownstreamTransactionTest_a3c0d7099304bccd5da24c32f9e4485fb}


Definition at line 34 of file Downstream\+Transaction\+Test.\+cpp.


\begin{DoxyCode}
34                         \{
35     EXPECT\_CALL(transport_, describe(\_))
36       .WillRepeatedly(Return());
37   \}
\end{DoxyCode}
\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!setup\+Request\+Response\+Flow@{setup\+Request\+Response\+Flow}}
\index{setup\+Request\+Response\+Flow@{setup\+Request\+Response\+Flow}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{setup\+Request\+Response\+Flow(\+H\+T\+T\+P\+Transaction $\ast$txn, uint32\+\_\+t size, bool delay\+Response=false)}]{\setlength{\rightskip}{0pt plus 5cm}void Downstream\+Transaction\+Test\+::setup\+Request\+Response\+Flow (
\begin{DoxyParamCaption}
\item[{{\bf H\+T\+T\+P\+Transaction} $\ast$}]{txn, }
\item[{uint32\+\_\+t}]{size, }
\item[{bool}]{delay\+Response = {\ttfamily false}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classDownstreamTransactionTest_a9c4bb789e570bc521af6c43ad18d8643}


Definition at line 39 of file Downstream\+Transaction\+Test.\+cpp.



References proxygen\+::\+H\+T\+T\+P\+Message\+::get\+Status\+Code(), proxygen\+::make\+Buf(), proxygen\+::make\+Response(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::on\+Ingress\+Body(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::on\+Ingress\+E\+O\+M(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::on\+Write\+Ready(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::send\+Body(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::send\+E\+O\+M(), proxygen\+::\+H\+T\+T\+P\+Transaction\+::send\+Headers(), and proxygen\+::\+H\+T\+T\+P\+Transaction\+::set\+Handler().


\begin{DoxyCode}
40                                                           \{
41     EXPECT\_CALL(handler_, setTransaction(txn));
42     EXPECT\_CALL(handler_, detachTransaction());
43     EXPECT\_CALL(transport_, detach(txn));
44     \textcolor{keywordflow}{if} (delayResponse) \{
45       EXPECT\_CALL(handler_, onHeadersComplete(\_));
46     \} \textcolor{keywordflow}{else} \{
47       EXPECT\_CALL(handler_, onHeadersComplete(\_))
48           .WillOnce(Invoke([=](std::shared\_ptr<HTTPMessage> \textcolor{comment}{/*msg*/}) \{
49             \textcolor{keyword}{auto} response = makeResponse(200);
50             txn->sendHeaders(*response.get());
51             txn->sendBody(makeBuf(size));
52             txn->sendEOM();
53           \}));
54     \}
55     EXPECT\_CALL(transport_, sendHeaders(txn, \_, \_, \_))
56       .WillOnce(Invoke([=](Unused, \textcolor{keyword}{const} HTTPMessage& headers, Unused, Unused) \{
57             EXPECT\_EQ(headers.getStatusCode(), 200);
58           \}));
59     EXPECT\_CALL(transport_, sendBody(txn, \_, \textcolor{keyword}{false}, \textcolor{keyword}{false}))
60       .WillRepeatedly(Invoke([=](Unused, std::shared\_ptr<folly::IOBuf> body,
61                                  Unused, Unused) \{
62                                \textcolor{keyword}{auto} cur = body->computeChainDataLength();
63                                sent_ += cur;
64                                \textcolor{keywordflow}{return} cur;
65                              \}));
66     \textcolor{keywordflow}{if} (delayResponse) \{
67       EXPECT\_CALL(transport_, sendEOM(txn, \_));
68     \} \textcolor{keywordflow}{else} \{
69       EXPECT\_CALL(transport_, sendEOM(txn, \_))
70           .WillOnce(InvokeWithoutArgs([=]() \{
71             CHECK\_EQ(sent_, size);
72             txn->onIngressBody(makeBuf(size), 0);
73             txn->onIngressEOM();
74             \textcolor{keywordflow}{return} 5;
75           \}));
76     \}
77     EXPECT\_CALL(handler_, onBody(\_))
78       .WillRepeatedly(Invoke([=](std::shared\_ptr<folly::IOBuf> body) \{
79             received_ += body->computeChainDataLength();
80           \}));
81     EXPECT\_CALL(handler_, onEOM())
82       .WillOnce(InvokeWithoutArgs([=] \{
83             CHECK\_EQ(received_, size);
84           \}));
85     EXPECT\_CALL(transport_, notifyPendingEgress())
86       .WillOnce(InvokeWithoutArgs([=] \{
87             txn->onWriteReady(size, 1);
88           \}))
89       .WillOnce(DoDefault()); \textcolor{comment}{// The second call is for sending the eom}
90 
91     txn->setHandler(&handler_);
92   \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!event\+Base\+\_\+@{event\+Base\+\_\+}}
\index{event\+Base\+\_\+@{event\+Base\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{event\+Base\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}folly\+::\+Event\+Base Downstream\+Transaction\+Test\+::event\+Base\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_a583e720341c5bc14423eedb3bd94ddc4}


Definition at line 95 of file Downstream\+Transaction\+Test.\+cpp.

\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!handler\+\_\+@{handler\+\_\+}}
\index{handler\+\_\+@{handler\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{handler\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}Strict\+Mock$<${\bf Mock\+H\+T\+T\+P\+Handler}$>$ Downstream\+Transaction\+Test\+::handler\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_a6f6aef3fff49be0c80669d2574c3b4df}


Definition at line 103 of file Downstream\+Transaction\+Test.\+cpp.

\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!received\+\_\+@{received\+\_\+}}
\index{received\+\_\+@{received\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{received\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t Downstream\+Transaction\+Test\+::received\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_ab91964c2c5c84ab7b28e8d713f339fa3}


Definition at line 105 of file Downstream\+Transaction\+Test.\+cpp.

\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!sent\+\_\+@{sent\+\_\+}}
\index{sent\+\_\+@{sent\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{sent\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t Downstream\+Transaction\+Test\+::sent\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_aef38dfbd014f1c282f955e208b75cf6b}


Definition at line 106 of file Downstream\+Transaction\+Test.\+cpp.

\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!transaction\+Timeouts\+\_\+@{transaction\+Timeouts\+\_\+}}
\index{transaction\+Timeouts\+\_\+@{transaction\+Timeouts\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{transaction\+Timeouts\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}folly\+::\+H\+H\+Wheel\+Timer\+::\+Unique\+Ptr Downstream\+Transaction\+Test\+::transaction\+Timeouts\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_a2206e5db44b6e7f1aca3b8bb27dba3f5}
{\bfseries Initial value\+:}
\begin{DoxyCode}
\{
      folly::HHWheelTimer::newTimer(
          &eventBase_,
          std::chrono::milliseconds(folly::HHWheelTimer::DEFAULT\_TICK\_INTERVAL),
          folly::AsyncTimeout::InternalEnum::NORMAL,
          std::chrono::milliseconds(500))\}
\end{DoxyCode}


Definition at line 96 of file Downstream\+Transaction\+Test.\+cpp.

\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!transport\+\_\+@{transport\+\_\+}}
\index{transport\+\_\+@{transport\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{transport\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Mock\+H\+T\+T\+P\+Transaction\+Transport} Downstream\+Transaction\+Test\+::transport\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_af3cd2dc4330358012a25ee2f6dc544d8}


Definition at line 102 of file Downstream\+Transaction\+Test.\+cpp.

\index{Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}!txn\+Egress\+Queue\+\_\+@{txn\+Egress\+Queue\+\_\+}}
\index{txn\+Egress\+Queue\+\_\+@{txn\+Egress\+Queue\+\_\+}!Downstream\+Transaction\+Test@{Downstream\+Transaction\+Test}}
\subsubsection[{txn\+Egress\+Queue\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}{\bf H\+T\+T\+P2\+Priority\+Queue} Downstream\+Transaction\+Test\+::txn\+Egress\+Queue\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\label{classDownstreamTransactionTest_a949d1091b816665e2552186c5199f4d8}


Definition at line 104 of file Downstream\+Transaction\+Test.\+cpp.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
proxygen/lib/http/session/test/{\bf Downstream\+Transaction\+Test.\+cpp}\end{DoxyCompactItemize}
