\section{proxygen\+:\+:H\+P\+A\+C\+K\+Queue Class Reference}
\label{classproxygen_1_1HPACKQueue}\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}


{\ttfamily \#include $<$H\+P\+A\+C\+K\+Queue.\+h$>$}

Inheritance diagram for proxygen\+:\+:H\+P\+A\+C\+K\+Queue\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classproxygen_1_1HPACKQueue}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf H\+P\+A\+C\+K\+Queue} ({\bf H\+P\+A\+C\+K\+Codec} \&codec)
\item 
void {\bf enqueue\+Header\+Block} (uint32\+\_\+t seqn, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ block, size\+\_\+t length, {\bf H\+P\+A\+C\+K\+::\+Streaming\+Callback} $\ast$streaming\+Cb, bool ooo\+Ok)
\item 
uint64\+\_\+t {\bf get\+Hol\+Block\+Count} () const 
\item 
uint64\+\_\+t {\bf get\+Queued\+Bytes} () const 
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
bool {\bf decode\+Block} (int32\+\_\+t seqn, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ block, size\+\_\+t length, {\bf H\+P\+A\+C\+K\+::\+Streaming\+Callback} $\ast$cb, bool ooo)
\item 
void {\bf drain\+Queue} ()
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
size\+\_\+t {\bf next\+Seqn\+\_\+} \{0\}
\item 
uint64\+\_\+t {\bf hol\+Block\+Count\+\_\+} \{0\}
\item 
uint64\+\_\+t {\bf queued\+Bytes\+\_\+} \{0\}
\item 
std\+::deque$<$ std\+::tuple$<$ uint32\+\_\+t, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$, size\+\_\+t, {\bf H\+P\+A\+C\+K\+::\+Streaming\+Callback} $\ast$ $>$ $>$ {\bf queue\+\_\+}
\item 
{\bf H\+P\+A\+C\+K\+Codec} \& {\bf codec\+\_\+}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 21 of file H\+P\+A\+C\+K\+Queue.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!H\+P\+A\+C\+K\+Queue@{H\+P\+A\+C\+K\+Queue}}
\index{H\+P\+A\+C\+K\+Queue@{H\+P\+A\+C\+K\+Queue}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{H\+P\+A\+C\+K\+Queue(\+H\+P\+A\+C\+K\+Codec \&codec)}]{\setlength{\rightskip}{0pt plus 5cm}proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::\+H\+P\+A\+C\+K\+Queue (
\begin{DoxyParamCaption}
\item[{{\bf H\+P\+A\+C\+K\+Codec} \&}]{codec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [explicit]}}\label{classproxygen_1_1HPACKQueue_aec13ae8a735a833bd6be4da4eed65433}


Definition at line 23 of file H\+P\+A\+C\+K\+Queue.\+h.


\begin{DoxyCode}
24     : codec_(codec) \{\}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!decode\+Block@{decode\+Block}}
\index{decode\+Block@{decode\+Block}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{decode\+Block(int32\+\_\+t seqn, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ block, size\+\_\+t length, H\+P\+A\+C\+K\+::\+Streaming\+Callback $\ast$cb, bool ooo)}]{\setlength{\rightskip}{0pt plus 5cm}bool proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::decode\+Block (
\begin{DoxyParamCaption}
\item[{int32\+\_\+t}]{seqn, }
\item[{std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$}]{block, }
\item[{size\+\_\+t}]{length, }
\item[{{\bf H\+P\+A\+C\+K\+::\+Streaming\+Callback} $\ast$}]{cb, }
\item[{bool}]{ooo}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_a64e64d8c4fa5adfed2b51c7c7900d434}


Definition at line 85 of file H\+P\+A\+C\+K\+Queue.\+h.



References codec\+\_\+, proxygen\+::\+H\+P\+A\+C\+K\+Codec\+::decode\+Streaming(), and next\+Seqn\+\_\+.



Referenced by drain\+Queue(), and enqueue\+Header\+Block().


\begin{DoxyCode}
87                              \{
88     \textcolor{keywordflow}{if} (length > 0) \{
89       VLOG(5) << \textcolor{stringliteral}{"decodeBlock for block="} << seqn << \textcolor{stringliteral}{" len="} << length;
90       folly::io::Cursor c(block.get());
91       folly::DestructorCheck::Safety safety(*\textcolor{keyword}{this});
92       codec_.decodeStreaming(c, length, cb);
93       \textcolor{keywordflow}{if} (safety.destroyed()) \{
94         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
95       \}
96     \}
97     \textcolor{keywordflow}{if} (!ooo) \{
98       nextSeqn_++;
99     \}
100     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
101   \}
\end{DoxyCode}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!drain\+Queue@{drain\+Queue}}
\index{drain\+Queue@{drain\+Queue}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{drain\+Queue()}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::drain\+Queue (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_a1804058b5705e14b33bccfd4701bcd32}


Definition at line 103 of file H\+P\+A\+C\+K\+Queue.\+h.



References decode\+Block(), next\+Seqn\+\_\+, queue\+\_\+, and queued\+Bytes\+\_\+.



Referenced by enqueue\+Header\+Block().


\begin{DoxyCode}
103                     \{
104     \textcolor{keywordflow}{while} (!queue_.empty() && nextSeqn_ == std::get<0>(queue_.front())) \{
105       \textcolor{keyword}{auto}& next = queue_.front();
106       \textcolor{keyword}{auto} length = std::get<2>(next);
107       \textcolor{keywordflow}{if} (decodeBlock(std::get<0>(next), std::move(std::get<1>(next)),
108                       length, std::get<3>(next),
109                       \textcolor{keyword}{false} \textcolor{comment}{/* in order */})) \{
110         \textcolor{keywordflow}{return};
111       \}
112       DCHECK\_LE(length, queuedBytes_);
113       queuedBytes_ -= length;
114       queue_.pop\_front();
115     \}
116   \}
\end{DoxyCode}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!enqueue\+Header\+Block@{enqueue\+Header\+Block}}
\index{enqueue\+Header\+Block@{enqueue\+Header\+Block}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{enqueue\+Header\+Block(uint32\+\_\+t seqn, std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$ block, size\+\_\+t length, H\+P\+A\+C\+K\+::\+Streaming\+Callback $\ast$streaming\+Cb, bool ooo\+Ok)}]{\setlength{\rightskip}{0pt plus 5cm}void proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::enqueue\+Header\+Block (
\begin{DoxyParamCaption}
\item[{uint32\+\_\+t}]{seqn, }
\item[{std\+::unique\+\_\+ptr$<$ folly\+::\+I\+O\+Buf $>$}]{block, }
\item[{size\+\_\+t}]{length, }
\item[{{\bf H\+P\+A\+C\+K\+::\+Streaming\+Callback} $\ast$}]{streaming\+Cb, }
\item[{bool}]{ooo\+Ok}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1HPACKQueue_a0a93f54563cfd97359ba46658ce9f746}


Definition at line 26 of file H\+P\+A\+C\+K\+Queue.\+h.



References proxygen\+::\+H\+P\+A\+C\+K\+::\+B\+A\+D\+\_\+\+S\+E\+Q\+U\+E\+N\+C\+E\+\_\+\+N\+U\+M\+B\+ER, decode\+Block(), drain\+Queue(), hol\+Block\+Count\+\_\+, next\+Seqn\+\_\+, proxygen\+::\+H\+P\+A\+C\+K\+::\+Streaming\+Callback\+::on\+Decode\+Error(), queue\+\_\+, and queued\+Bytes\+\_\+.



Referenced by proxygen\+::compress\+::\+H\+P\+A\+C\+K\+Scheme\+::decode().


\begin{DoxyCode}
29                                       \{
30     \textcolor{keywordflow}{if} (seqn < nextSeqn_) \{
31       streamingCb->onDecodeError(HPACK::DecodeError::BAD_SEQUENCE_NUMBER);
32       \textcolor{keywordflow}{return};
33     \}
34     \textcolor{keywordflow}{if} (nextSeqn_ == seqn) \{
35       \textcolor{comment}{// common case, decode immediately}
36       \textcolor{keywordflow}{if} (decodeBlock(seqn, std::move(block), length, streamingCb,
37                       \textcolor{keyword}{false} \textcolor{comment}{/* in order */})) \{
38         \textcolor{keywordflow}{return};
39       \}
40       drainQueue();
41     \} \textcolor{keywordflow}{else} \{
42       \textcolor{comment}{// there's a gap, have to queue}
43       \textcolor{keyword}{auto} it = queue_.begin();
44       \textcolor{keywordflow}{while} (it != queue_.end()) \{
45         \textcolor{keyword}{auto} qSeqn = std::get<0>(*it);
46         \textcolor{keywordflow}{if} (seqn == qSeqn) \{
47           streamingCb->onDecodeError(HPACK::DecodeError::BAD_SEQUENCE_NUMBER);
48           \textcolor{keywordflow}{return};
49         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (seqn < qSeqn) \{
50           \textcolor{keywordflow}{break};
51         \}
52         it++;
53       \}
54       \textcolor{keywordflow}{if} (oooOk) \{
55         \textcolor{comment}{// out-of-order allowed.  Decode the block, but make an empty entry in}
56         \textcolor{comment}{// the queue}
57         \textcolor{keywordflow}{if} (decodeBlock(seqn, std::move(block), length, streamingCb,
58                         \textcolor{keyword}{true} \textcolor{comment}{/* ooo */})) \{
59           \textcolor{keywordflow}{return};
60         \}
61         length = 0;
62         streamingCb = \textcolor{keyword}{nullptr};
63       \} \textcolor{keywordflow}{else} \{
64         holBlockCount_++;
65       \}
66       VLOG(5) << \textcolor{stringliteral}{"queued block="} << seqn << \textcolor{stringliteral}{" len="} << length <<
67         \textcolor{stringliteral}{" placeholder="} << int32\_t(oooOk);
68       queuedBytes_ += length;
69       queue_.emplace(it, seqn, std::move(block), length, streamingCb);
70     \}
71   \}
\end{DoxyCode}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!get\+Hol\+Block\+Count@{get\+Hol\+Block\+Count}}
\index{get\+Hol\+Block\+Count@{get\+Hol\+Block\+Count}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{get\+Hol\+Block\+Count() const }]{\setlength{\rightskip}{0pt plus 5cm}uint64\+\_\+t proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::get\+Hol\+Block\+Count (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1HPACKQueue_a8b39697af17586828e9d8751d1c1274d}


Definition at line 73 of file H\+P\+A\+C\+K\+Queue.\+h.



References hol\+Block\+Count\+\_\+.



Referenced by proxygen\+::compress\+::\+H\+P\+A\+C\+K\+Scheme\+::get\+Hol\+Block\+Count().


\begin{DoxyCode}
73                                     \{
74     \textcolor{keywordflow}{return} holBlockCount_;
75   \}
\end{DoxyCode}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!get\+Queued\+Bytes@{get\+Queued\+Bytes}}
\index{get\+Queued\+Bytes@{get\+Queued\+Bytes}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{get\+Queued\+Bytes() const }]{\setlength{\rightskip}{0pt plus 5cm}uint64\+\_\+t proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::get\+Queued\+Bytes (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classproxygen_1_1HPACKQueue_a0c083fb8e7cb8dd7814b59340adaefd7}


Definition at line 77 of file H\+P\+A\+C\+K\+Queue.\+h.



References queued\+Bytes\+\_\+.



Referenced by proxygen\+::compress\+::\+H\+P\+A\+C\+K\+Scheme\+::decode(), and proxygen\+::compress\+::\+H\+P\+A\+C\+K\+Scheme\+::$\sim$\+H\+P\+A\+C\+K\+Scheme().


\begin{DoxyCode}
77                                   \{
78     \textcolor{keywordflow}{return} queuedBytes_;
79   \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!codec\+\_\+@{codec\+\_\+}}
\index{codec\+\_\+@{codec\+\_\+}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{codec\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}{\bf H\+P\+A\+C\+K\+Codec}\& proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::codec\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_a95606f2da1cc90c4215470d9d47f43ab}


Definition at line 123 of file H\+P\+A\+C\+K\+Queue.\+h.



Referenced by decode\+Block().

\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!hol\+Block\+Count\+\_\+@{hol\+Block\+Count\+\_\+}}
\index{hol\+Block\+Count\+\_\+@{hol\+Block\+Count\+\_\+}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{hol\+Block\+Count\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}uint64\+\_\+t proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::hol\+Block\+Count\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_a597ceed04054f616de959effd66f9eb5}


Definition at line 119 of file H\+P\+A\+C\+K\+Queue.\+h.



Referenced by enqueue\+Header\+Block(), and get\+Hol\+Block\+Count().

\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!next\+Seqn\+\_\+@{next\+Seqn\+\_\+}}
\index{next\+Seqn\+\_\+@{next\+Seqn\+\_\+}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{next\+Seqn\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::next\+Seqn\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_ad78415262df9b4f7cda48dceaf18d42b}


Definition at line 118 of file H\+P\+A\+C\+K\+Queue.\+h.



Referenced by decode\+Block(), drain\+Queue(), and enqueue\+Header\+Block().

\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!queue\+\_\+@{queue\+\_\+}}
\index{queue\+\_\+@{queue\+\_\+}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{queue\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}std\+::deque$<$std\+::tuple$<$uint32\+\_\+t, std\+::unique\+\_\+ptr$<$folly\+::\+I\+O\+Buf$>$, size\+\_\+t, {\bf H\+P\+A\+C\+K\+::\+Streaming\+Callback}$\ast$$>$ $>$ proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::queue\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_a0485192d4d5e484bbcb9043ed6a35dc7}


Definition at line 122 of file H\+P\+A\+C\+K\+Queue.\+h.



Referenced by drain\+Queue(), and enqueue\+Header\+Block().

\index{proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}!queued\+Bytes\+\_\+@{queued\+Bytes\+\_\+}}
\index{queued\+Bytes\+\_\+@{queued\+Bytes\+\_\+}!proxygen\+::\+H\+P\+A\+C\+K\+Queue@{proxygen\+::\+H\+P\+A\+C\+K\+Queue}}
\subsubsection[{queued\+Bytes\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}uint64\+\_\+t proxygen\+::\+H\+P\+A\+C\+K\+Queue\+::queued\+Bytes\+\_\+ \{0\}\hspace{0.3cm}{\ttfamily [private]}}\label{classproxygen_1_1HPACKQueue_aea91338bb2954aa5bfc5f340e51169fc}


Definition at line 120 of file H\+P\+A\+C\+K\+Queue.\+h.



Referenced by drain\+Queue(), enqueue\+Header\+Block(), and get\+Queued\+Bytes().



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
proxygen/lib/http/codec/compress/{\bf H\+P\+A\+C\+K\+Queue.\+h}\end{DoxyCompactItemize}
