\section{proxygen/httpserver/samples/static/\+Static\+Server.cpp File Reference}
\label{StaticServer_8cpp}\index{proxygen/httpserver/samples/static/\+Static\+Server.\+cpp@{proxygen/httpserver/samples/static/\+Static\+Server.\+cpp}}
{\ttfamily \#include $<$folly/\+Memory.\+h$>$}\\*
{\ttfamily \#include $<$folly/executors/\+Global\+Executor.\+h$>$}\\*
{\ttfamily \#include $<$folly/executors/\+C\+P\+U\+Thread\+Pool\+Executor.\+h$>$}\\*
{\ttfamily \#include $<$folly/init/\+Init.\+h$>$}\\*
{\ttfamily \#include $<$folly/io/async/\+Event\+Base\+Manager.\+h$>$}\\*
{\ttfamily \#include $<$folly/portability/\+G\+Flags.\+h$>$}\\*
{\ttfamily \#include $<$folly/portability/\+Unistd.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+H\+T\+T\+P\+Server.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+Request\+Handler\+Factory.\+h$>$}\\*
{\ttfamily \#include \char`\"{}Static\+Handler.\+h\char`\"{}}\\*
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
using {\bf Protocol} = {\bf H\+T\+T\+P\+Server\+::\+Protocol}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (http\+\_\+port, 11000,\char`\"{}Port to listen on with H\+T\+TP protocol\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (h2\+\_\+port, 11002,\char`\"{}Port to listen on with H\+T\+TP/2 protocol\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (ip,\char`\"{}localhost\char`\"{},\char`\"{}IP/Hostname to bind to\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (threads, 0,\char`\"{}Number of threads to listen on. Numbers $<$= 0 \char`\"{}\char`\"{}will use the number of cores on this machine.\char`\"{})
\item 
int {\bf main} (int argc, char $\ast$argv[$\,$])
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\index{Static\+Server.\+cpp@{Static\+Server.\+cpp}!Protocol@{Protocol}}
\index{Protocol@{Protocol}!Static\+Server.\+cpp@{Static\+Server.\+cpp}}
\subsubsection[{Protocol}]{\setlength{\rightskip}{0pt plus 5cm}using {\bf Protocol} =  {\bf H\+T\+T\+P\+Server\+::\+Protocol}}\label{StaticServer_8cpp_a0c4543274a4aa8135167669efe8688c7}


Definition at line 30 of file Static\+Server.\+cpp.



\subsection{Function Documentation}
\index{Static\+Server.\+cpp@{Static\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Static\+Server.\+cpp@{Static\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(http\+\_\+port, 11000,""Port to listen on with H\+T\+T\+P protocol"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{http\+\_\+port}]{, }
\item[{11000}]{, }
\item[{\char`\"{}Port to listen on with H\+T\+TP protocol\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{StaticServer_8cpp_ae695d59a814b6f82a613e2a1b2ecf174}
\index{Static\+Server.\+cpp@{Static\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Static\+Server.\+cpp@{Static\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(h2\+\_\+port, 11002,""Port to listen on with H\+T\+T\+P/2 protocol"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{h2\+\_\+port}]{, }
\item[{11002}]{, }
\item[{\char`\"{}Port to listen on with H\+T\+TP/2 protocol\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{StaticServer_8cpp_a169356b0b07b254cb75ef6c6f0e78a92}
\index{Static\+Server.\+cpp@{Static\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Static\+Server.\+cpp@{Static\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(threads, 0,""Number of threads to listen on. Numbers $<$= 0 """"will use the number of cores on this machine."")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{threads}]{, }
\item[{0}]{, }
\item[{\char`\"{}Number of threads to listen on. Numbers $<$= 0 \char`\"{}\char`\"{}will use the number of cores on this machine.\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{StaticServer_8cpp_a19bae5ae436a5e6c508c6af9279fa6ff}
\index{Static\+Server.\+cpp@{Static\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Static\+Server.\+cpp@{Static\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(ip,""localhost"",""I\+P/\+Hostname to bind to"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{ip}]{, }
\item[{\char`\"{}localhost\char`\"{}}]{, }
\item[{\char`\"{}IP/Hostname to bind to\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{StaticServer_8cpp_a9b3b3d9e62cd9f4d4950f95b83b7ad2e}
\index{Static\+Server.\+cpp@{Static\+Server.\+cpp}!main@{main}}
\index{main@{main}!Static\+Server.\+cpp@{Static\+Server.\+cpp}}
\subsubsection[{main(int argc, char $\ast$argv[])}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv[$\,$]}
\end{DoxyParamCaption}
)}\label{StaticServer_8cpp_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 53 of file Static\+Server.\+cpp.



References proxygen\+::\+Request\+Handler\+Chain\+::add\+Then(), proxygen\+::\+H\+T\+T\+P\+Server\+::bind(), proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::enable\+Content\+Compression, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::h2c\+Enabled, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::handler\+Factories, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::idle\+Timeout, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::shutdown\+On, proxygen\+::\+H\+T\+T\+P\+Server\+::start(), and proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::threads.


\begin{DoxyCode}
53                                  \{
54   folly::init(&argc, &argv, \textcolor{keyword}{true});
55 
56   std::vector<HTTPServer::IPConfig> IPs = \{
57     \{SocketAddress(FLAGS\_ip, FLAGS\_http\_port, \textcolor{keyword}{true}), Protocol::HTTP\},
58     \{SocketAddress(FLAGS\_ip, FLAGS\_h2\_port, \textcolor{keyword}{true}), Protocol::HTTP2\},
59   \};
60 
61   \textcolor{keywordflow}{if} (FLAGS\_threads <= 0) \{
62     FLAGS\_threads = sysconf(\_SC\_NPROCESSORS\_ONLN);
63     CHECK\_GT(FLAGS\_threads, 0);
64   \}
65 
66   HTTPServerOptions options;
67   options.threads = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(FLAGS\_threads);
68   options.idleTimeout = std::chrono::milliseconds(60000);
69   options.shutdownOn = \{SIGINT, SIGTERM\};
70   options.enableContentCompression = \textcolor{keyword}{false};
71   options.handlerFactories = RequestHandlerChain()
72       .addThen<StaticHandlerFactory>()
73       .build();
74   options.h2cEnabled = \textcolor{keyword}{true};
75 
76   \textcolor{keyword}{auto} diskIOThreadPool = std::make\_shared<folly::CPUThreadPoolExecutor>(
77     FLAGS\_threads,
78     std::make\_shared<folly::NamedThreadFactory>(\textcolor{stringliteral}{"StaticDiskIOThread"}));
79   folly::setCPUExecutor(diskIOThreadPool);
80 
81   HTTPServer server(std::move(options));
82   server.bind(IPs);
83 
84   \textcolor{comment}{// Start HTTPServer mainloop in a separate thread}
85   std::thread t([&] () \{
86     server.start();
87   \});
88 
89   t.join();
90   \textcolor{keywordflow}{return} 0;
91 \}
\end{DoxyCode}
