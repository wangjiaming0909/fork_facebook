\section{proxygen/httpserver/filters/tests/\+Zlib\+Server\+Filter\+Test.cpp File Reference}
\label{ZlibServerFilterTest_8cpp}\index{proxygen/httpserver/filters/tests/\+Zlib\+Server\+Filter\+Test.\+cpp@{proxygen/httpserver/filters/tests/\+Zlib\+Server\+Filter\+Test.\+cpp}}
{\ttfamily \#include $<$folly/\+Conv.\+h$>$}\\*
{\ttfamily \#include $<$folly/\+Scope\+Guard.\+h$>$}\\*
{\ttfamily \#include $<$folly/io/\+I\+O\+Buf.\+h$>$}\\*
{\ttfamily \#include $<$folly/portability/\+G\+Mock.\+h$>$}\\*
{\ttfamily \#include $<$folly/portability/\+G\+Test.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/filters/\+Zlib\+Server\+Filter.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/lib/utils/\+Zlib\+Stream\+Compressor.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+Mocks.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+Response\+Builder.\+h$>$}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class {\bf Zlib\+Server\+Filter\+Test}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\bf M\+A\+T\+C\+H\+E\+R\+\_\+P} (I\+O\+Buf\+Equals, expected, folly\+::to$<$ std\+::string $>$(\char`\"{}I\+O\+Buf is \char`\"{}, negation?\char`\"{}not \char`\"{}\+:\char`\"{}\char`\"{},\char`\"{}\textquotesingle{}\char`\"{}, expected,\char`\"{}\textquotesingle{}\char`\"{}))
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Nonchunked\+Compression)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Chunked\+Compression)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Parameterized\+Contenttype)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Mixedcase\+Contenttype)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Multiple\+Accepted\+Encodings)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Multiple\+Accepted\+Encodings\+Qvalues)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, No\+Compressible\+Accepted\+Encodings)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Missing\+Accepted\+Encodings)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Uncompressible\+Contenttype)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Uncompressible\+Contenttype\+Param)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Too\+Small\+To\+Compress)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Small\+Chunks\+Compress)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, Minimum\+Compress\+Size\+Equal\+To\+Request\+Size)
\item 
{\bf T\+E\+S\+T\+\_\+F} ({\bf Zlib\+Server\+Filter\+Test}, No\+Response\+Body)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!M\+A\+T\+C\+H\+E\+R\+\_\+P@{M\+A\+T\+C\+H\+E\+R\+\_\+P}}
\index{M\+A\+T\+C\+H\+E\+R\+\_\+P@{M\+A\+T\+C\+H\+E\+R\+\_\+P}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{M\+A\+T\+C\+H\+E\+R\+\_\+\+P(\+I\+O\+Buf\+Equals, expected, folly\+::to$<$ std\+::string $>$(""I\+O\+Buf is "", negation?""not ""\+:"""",""\textquotesingle{}"", expected,""\textquotesingle{}""))}]{\setlength{\rightskip}{0pt plus 5cm}M\+A\+T\+C\+H\+E\+R\+\_\+P (
\begin{DoxyParamCaption}
\item[{I\+O\+Buf\+Equals}]{, }
\item[{expected}]{, }
\item[{folly\+::to$<$ std\+::string $>$}]{\char`\"{}\+I\+O\+Buf is \char`\"{}, negation?\char`\"{}not \char`\"{}\+:\char`\"{}\char`\"{},\char`\"{}\textquotesingle{}\char`\"{}, expected,\char`\"{}\textquotesingle{}\char`\"{}}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_ac619fd79aaed392dde57876a86845681}


Definition at line 24 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
27                                              : \textcolor{stringliteral}{""}, \textcolor{stringliteral}{"'"}, expected, \textcolor{stringliteral}{"'"})) \{
28   \textcolor{keyword}{auto} iob = arg->clone();
29   \textcolor{keyword}{auto} br = iob->coalesce();
30   std::string actual(br.begin(), br.end());
31   *result\_listener << \textcolor{stringliteral}{"'"} << actual << \textcolor{stringliteral}{"'"};
32   \textcolor{keywordflow}{return} actual == expected;
33 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Nonchunked\+Compression)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Nonchunked\+Compression}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a6c4cb48a6f454d541803797d101123eb}


Definition at line 212 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
212                                                     \{
213   ASSERT\_NO\_FATAL\_FAILURE(\{
214     exercise\_compression(\textcolor{keyword}{true},
215                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
216                          std::string(\textcolor{stringliteral}{"gzip"}),
217                          std::string(\textcolor{stringliteral}{"gzip"}),
218                          std::string(\textcolor{stringliteral}{"Hello World"}),
219                          std::string(\textcolor{stringliteral}{"text/html"}),
220                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
221   \});
222 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Chunked\+Compression)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Chunked\+Compression}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a4ce3a7f41a50ccb79860d14b01be22b9}


Definition at line 224 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
224                                                  \{
225   std::vector<std::string> chunks = \{\textcolor{stringliteral}{"Hello"}, \textcolor{stringliteral}{" World"}\};
226   ASSERT\_NO\_FATAL\_FAILURE(\{
227     exercise\_compression(\textcolor{keyword}{true},
228                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
229                          std::string(\textcolor{stringliteral}{"gzip"}),
230                          std::string(\textcolor{stringliteral}{"gzip"}),
231                          std::string(\textcolor{stringliteral}{"Hello World"}),
232                          std::string(\textcolor{stringliteral}{"text/html"}),
233                          createResponseChain(chunks));
234   \});
235 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Parameterized\+Contenttype)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Parameterized\+Contenttype}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_aa638741ed898555f5f565d621de062a8}


Definition at line 237 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
237                                                        \{
238   ASSERT\_NO\_FATAL\_FAILURE(\{
239     exercise\_compression(\textcolor{keyword}{true},
240                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
241                          std::string(\textcolor{stringliteral}{"gzip"}),
242                          std::string(\textcolor{stringliteral}{"gzip"}),
243                          std::string(\textcolor{stringliteral}{"Hello World"}),
244                          std::string(\textcolor{stringliteral}{"text/html; param1"}),
245                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
246   \});
247 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Mixedcase\+Contenttype)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Mixedcase\+Contenttype}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a75d6e7ec208f829b58f6f1db0f04a9da}


Definition at line 249 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
249                                                    \{
250   ASSERT\_NO\_FATAL\_FAILURE(\{
251     exercise\_compression(\textcolor{keyword}{true},
252                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
253                          std::string(\textcolor{stringliteral}{"gzip"}),
254                          std::string(\textcolor{stringliteral}{"gzip"}),
255                          std::string(\textcolor{stringliteral}{"Hello World"}),
256                          std::string(\textcolor{stringliteral}{"Text/Html; param1"}),
257                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
258   \});
259 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Multiple\+Accepted\+Encodings)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Multiple\+Accepted\+Encodings}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a028eceeaa59ec8cefb0363842057d570}


Definition at line 262 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
262                                                         \{
263   ASSERT\_NO\_FATAL\_FAILURE(\{
264     exercise\_compression(\textcolor{keyword}{true},
265                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
266                          std::string(\textcolor{stringliteral}{"gzip, identity, deflate"}),
267                          std::string(\textcolor{stringliteral}{"gzip"}),
268                          std::string(\textcolor{stringliteral}{"Hello World"}),
269                          std::string(\textcolor{stringliteral}{"text/html"}),
270                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
271   \});
272 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Multiple\+Accepted\+Encodings\+Qvalues)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Multiple\+Accepted\+Encodings\+Qvalues}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a95266761e950324e3789e1f5ca911198}


Definition at line 274 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
274                                                                \{
275   ASSERT\_NO\_FATAL\_FAILURE(\{
276     exercise\_compression(\textcolor{keyword}{true},
277                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
278                          std::string(\textcolor{stringliteral}{"gzip; q=.7;, identity"}),
279                          std::string(\textcolor{stringliteral}{"gzip"}),
280                          std::string(\textcolor{stringliteral}{"Hello World"}),
281                          std::string(\textcolor{stringliteral}{"text/html"}),
282                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
283   \});
284 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, No\+Compressible\+Accepted\+Encodings)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{No\+Compressible\+Accepted\+Encodings}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_aa0f8c30f039969465c79b0dff4c3655c}


Definition at line 286 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
286                                                               \{
287   ASSERT\_NO\_FATAL\_FAILURE(\{
288     exercise\_compression(\textcolor{keyword}{false},
289                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
290                          std::string(\textcolor{stringliteral}{"identity; q=.7;"}),
291                          std::string(\textcolor{stringliteral}{""}),
292                          std::string(\textcolor{stringliteral}{"Hello World"}),
293                          std::string(\textcolor{stringliteral}{"text/html"}),
294                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
295   \});
296 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Missing\+Accepted\+Encodings)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Missing\+Accepted\+Encodings}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a16ae140ce2f0567cd5f57dc301be38f7}


Definition at line 298 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
298                                                        \{
299   ASSERT\_NO\_FATAL\_FAILURE(\{
300     exercise\_compression(\textcolor{keyword}{false},
301                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
302                          std::string(\textcolor{stringliteral}{""}),
303                          std::string(\textcolor{stringliteral}{""}),
304                          std::string(\textcolor{stringliteral}{"Hello World"}),
305                          std::string(\textcolor{stringliteral}{"text/html"}),
306                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
307   \});
308 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Uncompressible\+Contenttype)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Uncompressible\+Contenttype}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a44b5d0628779cd24b24d1edf585ec6e1}


Definition at line 311 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
311                                                         \{
312   ASSERT\_NO\_FATAL\_FAILURE(\{
313     exercise\_compression(\textcolor{keyword}{false},
314                          std::string(\textcolor{stringliteral}{"http://locahost/foo.nocompress"}),
315                          std::string(\textcolor{stringliteral}{"gzip"}),
316                          std::string(\textcolor{stringliteral}{""}),
317                          std::string(\textcolor{stringliteral}{"Hello World"}),
318                          std::string(\textcolor{stringliteral}{"image/jpeg"}),
319                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
320   \});
321 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Uncompressible\+Contenttype\+Param)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Uncompressible\+Contenttype\+Param}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_adde1aeef02b0976368379b6103f3e88e}


Definition at line 323 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
323                                                              \{
324   ASSERT\_NO\_FATAL\_FAILURE(\{
325     exercise\_compression(\textcolor{keyword}{false},
326                          std::string(\textcolor{stringliteral}{"http://locahost/foo.nocompress"}),
327                          std::string(\textcolor{stringliteral}{"gzip"}),
328                          std::string(\textcolor{stringliteral}{""}),
329                          std::string(\textcolor{stringliteral}{"Hello World"}),
330                          std::string(\textcolor{stringliteral}{"application/jpeg; param1"}),
331                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}));
332   \});
333 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Too\+Small\+To\+Compress)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Too\+Small\+To\+Compress}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a602a34bf3e75ee355e969a3266c6e66b}


Definition at line 336 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
336                                                  \{
337   ASSERT\_NO\_FATAL\_FAILURE(\{
338     exercise\_compression(\textcolor{keyword}{false},
339                          std::string(\textcolor{stringliteral}{"http://locahost/foo.smallfry"}),
340                          std::string(\textcolor{stringliteral}{"gzip"}),
341                          std::string(\textcolor{stringliteral}{""}),
342                          std::string(\textcolor{stringliteral}{"Hello World"}),
343                          std::string(\textcolor{stringliteral}{"text/html"}),
344                          folly::IOBuf::copyBuffer(\textcolor{stringliteral}{"Hello World"}),
345                          4,
346                          1000);
347   \});
348 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Small\+Chunks\+Compress)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Small\+Chunks\+Compress}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_a552edf3910e70a55a0e971c61897aa03}


Definition at line 350 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
350                                                   \{
351   \textcolor{comment}{// Expect this to compress despite being small because can't tell the content}
352   \textcolor{comment}{// length when we're chunked}
353   std::vector<std::string> chunks = \{\textcolor{stringliteral}{"Hello"}, \textcolor{stringliteral}{" World"}\};
354   ASSERT\_NO\_FATAL\_FAILURE(\{
355     exercise\_compression(\textcolor{keyword}{true},
356                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
357                          std::string(\textcolor{stringliteral}{"gzip"}),
358                          std::string(\textcolor{stringliteral}{"gzip"}),
359                          std::string(\textcolor{stringliteral}{"Hello World"}),
360                          std::string(\textcolor{stringliteral}{"text/html"}),
361                          createResponseChain(chunks),
362                          4,
363                          1000);
364   \});
365 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, Minimum\+Compress\+Size\+Equal\+To\+Request\+Size)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{Minimum\+Compress\+Size\+Equal\+To\+Request\+Size}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_abbb0c8cf1915554affe2e252e9ae1d65}


Definition at line 367 of file Zlib\+Server\+Filter\+Test.\+cpp.


\begin{DoxyCode}
367                                                                    \{
368   \textcolor{keyword}{auto} requestBody = std::string(\textcolor{stringliteral}{"Hello World"});
369   ASSERT\_NO\_FATAL\_FAILURE(\{
370     exercise\_compression(\textcolor{keyword}{true},
371                          std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"}),
372                          std::string(\textcolor{stringliteral}{"gzip"}),
373                          std::string(\textcolor{stringliteral}{"gzip"}),
374                          requestBody,
375                          std::string(\textcolor{stringliteral}{"text/html"}),
376                          folly::IOBuf::copyBuffer(requestBody),
377                          4,
378                          requestBody.length());
379   \});
380 \}
\end{DoxyCode}
\index{Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}!T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}}
\index{T\+E\+S\+T\+\_\+F@{T\+E\+S\+T\+\_\+F}!Zlib\+Server\+Filter\+Test.\+cpp@{Zlib\+Server\+Filter\+Test.\+cpp}}
\subsubsection[{T\+E\+S\+T\+\_\+\+F(\+Zlib\+Server\+Filter\+Test, No\+Response\+Body)}]{\setlength{\rightskip}{0pt plus 5cm}T\+E\+S\+T\+\_\+F (
\begin{DoxyParamCaption}
\item[{{\bf Zlib\+Server\+Filter\+Test}}]{, }
\item[{No\+Response\+Body}]{}
\end{DoxyParamCaption}
)}\label{ZlibServerFilterTest_8cpp_ad81edfd509525b97db7788d17e46d99c}


Definition at line 382 of file Zlib\+Server\+Filter\+Test.\+cpp.



References proxygen\+::\+H\+T\+T\+P\+Message\+::check\+For\+Header\+Token(), proxygen\+::\+H\+T\+T\+P\+Message\+::get\+Headers(), proxygen\+::\+H\+T\+T\+P\+Message\+::get\+Is\+Chunked(), proxygen\+::\+Response\+Builder\+::header(), proxygen\+::\+Response\+Builder\+::send(), proxygen\+::\+Response\+Builder\+::send\+With\+E\+O\+M(), proxygen\+::\+H\+T\+T\+P\+Headers\+::set(), proxygen\+::\+H\+T\+T\+P\+Message\+::set\+U\+R\+L(), and proxygen\+::\+Response\+Builder\+::status().


\begin{DoxyCode}
382                                             \{
383   std::string acceptedEncoding = \textcolor{stringliteral}{"gzip"};
384   std::string expectedEncoding = \textcolor{stringliteral}{"gzip"};
385   std::string url = std::string(\textcolor{stringliteral}{"http://locahost/foo.compressme"});
386   std::string responseContentType = std::string(\textcolor{stringliteral}{"text/html"});
387   int32\_t compressionLevel = 4;
388   uint32\_t minimumCompressionSize = 0;
389 
390   ASSERT\_NO\_FATAL\_FAILURE(\{
391     \textcolor{comment}{// Request Handler Expectations}
392     EXPECT\_CALL(*requestHandler\_, onEOM()).Times(1);
393 
394     \textcolor{comment}{// Need to capture whatever the filter is for ResponseBuilder later}
395     EXPECT\_CALL(*requestHandler\_, setResponseHandler(\_))
396         .WillOnce(DoAll(SaveArg<0>(&downstream\_), Return()));
397 
398     \textcolor{comment}{// Response Handler Expectations}
399     \textcolor{comment}{// Headers are only sent once}
400     EXPECT\_CALL(*responseHandler\_, sendHeaders(\_)).WillOnce(DoAll(
401         Invoke([&](HTTPMessage& msg) \{
402           \textcolor{keyword}{auto}& headers = msg.getHeaders();
403           EXPECT\_TRUE(msg.checkForHeaderToken(
404             HTTP\_HEADER\_CONTENT\_ENCODING, expectedEncoding.c\_str(), \textcolor{keyword}{false}));
405           \textcolor{keywordflow}{if} (msg.getIsChunked()) \{
406             EXPECT\_FALSE(headers.exists(\textcolor{stringliteral}{"Content-Length"}));
407           \} \textcolor{keywordflow}{else} \{
408             \textcolor{comment}{//Content-Length is not set on chunked messages}
409             EXPECT\_TRUE(headers.exists(\textcolor{stringliteral}{"Content-Length"}));
410           \}
411         \}),
412         Return()));
413 
414     EXPECT\_CALL(*responseHandler\_, sendEOM()).Times(1);
415 
416     \textcolor{comment}{/* Simulate Request/Response where no body message received */}
417     HTTPMessage msg;
418     msg.setURL(url);
419     msg.getHeaders().set(HTTP\_HEADER\_ACCEPT\_ENCODING, acceptedEncoding);
420 
421     std::set<std::string> compressibleTypes = \{\textcolor{stringliteral}{"text/html"}\};
422     \textcolor{keyword}{auto} filterFactory = std::make\_unique<ZlibServerFilterFactory>(
423         compressionLevel, minimumCompressionSize, compressibleTypes);
424 
425     \textcolor{keyword}{auto} filter = filterFactory->onRequest(requestHandler\_, &msg);
426     filter->setResponseHandler(responseHandler\_.get());
427 
428     \textcolor{comment}{// Send fake request}
429     filter->onEOM();
430 
431     ResponseBuilder(downstream\_)
432       .status(200, \textcolor{stringliteral}{"OK"})
433       .header(HTTP\_HEADER\_CONTENT\_TYPE, responseContentType)
434       .send();
435 
436     ResponseBuilder(downstream\_).sendWithEOM();
437 
438     filter->requestComplete();
439   \});
440 \}
\end{DoxyCode}
