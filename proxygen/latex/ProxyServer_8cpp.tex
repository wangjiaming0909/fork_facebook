\section{proxygen/httpserver/samples/proxy/\+Proxy\+Server.cpp File Reference}
\label{ProxyServer_8cpp}\index{proxygen/httpserver/samples/proxy/\+Proxy\+Server.\+cpp@{proxygen/httpserver/samples/proxy/\+Proxy\+Server.\+cpp}}
{\ttfamily \#include $<$folly/portability/\+G\+Flags.\+h$>$}\\*
{\ttfamily \#include $<$folly/\+Memory.\+h$>$}\\*
{\ttfamily \#include $<$folly/io/async/\+Event\+Base\+Manager.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+H\+T\+T\+P\+Server.\+h$>$}\\*
{\ttfamily \#include $<$proxygen/httpserver/\+Request\+Handler\+Factory.\+h$>$}\\*
{\ttfamily \#include \char`\"{}Proxy\+Handler.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Proxy\+Stats.\+h\char`\"{}}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class {\bf Proxy\+Handler\+Factory}
\item 
struct {\bf Proxy\+Handler\+Factory\+::\+Timer\+Wrapper}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
using {\bf Protocol} = {\bf H\+T\+T\+P\+Server\+::\+Protocol}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (http\+\_\+port, 11000,\char`\"{}Port to listen on with H\+T\+TP protocol\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (h2\+\_\+port, 11002,\char`\"{}Port to listen on with H\+T\+TP/2 protocol\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+string} (ip,\char`\"{}localhost\char`\"{},\char`\"{}IP/Hostname to bind to\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (threads, 0,\char`\"{}Number of threads to listen on. Numbers $<$= 0 \char`\"{}\char`\"{}will use the number of cores on this machine.\char`\"{})
\item 
{\bf D\+E\+F\+I\+N\+E\+\_\+int32} (server\+\_\+timeout, 60,\char`\"{}How long to wait for a server response (sec)\char`\"{})
\item 
int {\bf main} (int argc, char $\ast$argv[$\,$])
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!Protocol@{Protocol}}
\index{Protocol@{Protocol}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{Protocol}]{\setlength{\rightskip}{0pt plus 5cm}using {\bf Protocol} =  {\bf H\+T\+T\+P\+Server\+::\+Protocol}}\label{ProxyServer_8cpp_a0c4543274a4aa8135167669efe8688c7}


Definition at line 27 of file Proxy\+Server.\+cpp.



\subsection{Function Documentation}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(http\+\_\+port, 11000,""Port to listen on with H\+T\+T\+P protocol"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{http\+\_\+port}]{, }
\item[{11000}]{, }
\item[{\char`\"{}Port to listen on with H\+T\+TP protocol\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{ProxyServer_8cpp_ae695d59a814b6f82a613e2a1b2ecf174}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(h2\+\_\+port, 11002,""Port to listen on with H\+T\+T\+P/2 protocol"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{h2\+\_\+port}]{, }
\item[{11002}]{, }
\item[{\char`\"{}Port to listen on with H\+T\+TP/2 protocol\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{ProxyServer_8cpp_a169356b0b07b254cb75ef6c6f0e78a92}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(threads, 0,""Number of threads to listen on. Numbers $<$= 0 """"will use the number of cores on this machine."")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{threads}]{, }
\item[{0}]{, }
\item[{\char`\"{}Number of threads to listen on. Numbers $<$= 0 \char`\"{}\char`\"{}will use the number of cores on this machine.\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{ProxyServer_8cpp_a19bae5ae436a5e6c508c6af9279fa6ff}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}}
\index{D\+E\+F\+I\+N\+E\+\_\+int32@{D\+E\+F\+I\+N\+E\+\_\+int32}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+int32(server\+\_\+timeout, 60,""How long to wait for a server response (sec)"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+int32 (
\begin{DoxyParamCaption}
\item[{server\+\_\+timeout}]{, }
\item[{60}]{, }
\item[{\char`\"{}How long to wait for a server response (sec)\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{ProxyServer_8cpp_a4263524a5bed5a6c954588708720c1ca}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}}
\index{D\+E\+F\+I\+N\+E\+\_\+string@{D\+E\+F\+I\+N\+E\+\_\+string}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{D\+E\+F\+I\+N\+E\+\_\+string(ip,""localhost"",""I\+P/\+Hostname to bind to"")}]{\setlength{\rightskip}{0pt plus 5cm}D\+E\+F\+I\+N\+E\+\_\+string (
\begin{DoxyParamCaption}
\item[{ip}]{, }
\item[{\char`\"{}localhost\char`\"{}}]{, }
\item[{\char`\"{}IP/Hostname to bind to\char`\"{}}]{}
\end{DoxyParamCaption}
)}\label{ProxyServer_8cpp_a9b3b3d9e62cd9f4d4950f95b83b7ad2e}
\index{Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}!main@{main}}
\index{main@{main}!Proxy\+Server.\+cpp@{Proxy\+Server.\+cpp}}
\subsubsection[{main(int argc, char $\ast$argv[])}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv[$\,$]}
\end{DoxyParamCaption}
)}\label{ProxyServer_8cpp_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 65 of file Proxy\+Server.\+cpp.



References proxygen\+::\+Request\+Handler\+Chain\+::add\+Then(), proxygen\+::\+H\+T\+T\+P\+Server\+::bind(), proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::enable\+Content\+Compression, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::h2c\+Enabled, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::handler\+Factories, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::idle\+Timeout, proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::shutdown\+On, proxygen\+::\+H\+T\+T\+P\+Server\+::start(), proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::supports\+Connect, and proxygen\+::\+H\+T\+T\+P\+Server\+Options\+::threads.


\begin{DoxyCode}
65                                  \{
66   gflags::ParseCommandLineFlags(&argc, &argv, \textcolor{keyword}{true});
67   google::InitGoogleLogging(argv[0]);
68   google::InstallFailureSignalHandler();
69 
70   std::vector<HTTPServer::IPConfig> IPs = \{
71     \{SocketAddress(FLAGS\_ip, FLAGS\_http\_port, \textcolor{keyword}{true}), Protocol::HTTP\},
72     \{SocketAddress(FLAGS\_ip, FLAGS\_h2\_port, \textcolor{keyword}{true}), Protocol::HTTP2\},
73   \};
74 
75   \textcolor{keywordflow}{if} (FLAGS\_threads <= 0) \{
76     FLAGS\_threads = sysconf(\_SC\_NPROCESSORS\_ONLN);
77     CHECK(FLAGS\_threads > 0);
78   \}
79 
80   HTTPServerOptions options;
81   options.threads = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(FLAGS\_threads);
82   options.idleTimeout = std::chrono::milliseconds(60000);
83   options.shutdownOn = \{SIGINT, SIGTERM\};
84   options.enableContentCompression = \textcolor{keyword}{false};
85   options.handlerFactories = RequestHandlerChain()
86       .addThen<ProxyHandlerFactory>()
87       .build();
88   options.h2cEnabled = \textcolor{keyword}{true};
89   options.supportsConnect = \textcolor{keyword}{true};
90 
91   HTTPServer server(std::move(options));
92   server.bind(IPs);
93 
94   \textcolor{comment}{// Start HTTPServer mainloop in a separate thread}
95   std::thread t([&] () \{
96     server.start();
97   \});
98 
99   t.join();
100   \textcolor{keywordflow}{return} 0;
101 \}
\end{DoxyCode}
